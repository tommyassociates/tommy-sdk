!function o(r,s,c){function d(e,t){if(!s[e]){if(!r[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(l)return l(e,!0);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}var i=s[e]={exports:{}};r[e][0].call(i.exports,function(t){return d(r[e][1][t]||t)},i,i.exports,o,r,s,c)}return s[e].exports}for(var l="function"==typeof require&&require,t=0;t<c.length;t++)d(c[t]);return d}({1:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,i=t("./controllers/index"),o=(a=i)&&a.__esModule?a:{default:a};var r={listsLoaded:!1,transactionsLoaded:!1,cache:{},initCache:function(){r.cache={lists:{},transactions:{}}},getOrderedLists:function(){if(!r.cache.lists)return[];var t=Object.values(r.cache.lists);return t.length?t.sort(function(t,e){return t.data.position-e.data.position}):[]},addTransaction:function(t){o.default.invalidateLists=!0,r.cache.transactions[t.id]=t,console.log("transaction added",t)},addTransactions:function(t){if(r.transactionsLoaded=!0,t&&t.length)for(var e=0;e<t.length;e++)Array.isArray(t[e])?r.addTransactions(t[e]):r.addTransaction(t[e])},getListTransactions:function(t){return r.cache.lists[t].transactions},loadListTransactions:function(e){if(!e._transactionsLoaded){e._transactionsLoaded=!0;var t=[window.tommy.config.getCurrentUserName()];if(e.data&&e.filters)for(var n=0;n<e.filters.length;n++)t.push(e.filters[n].name);var a={addon:"accounts",kind:"Transaction",tags:t,with_filters:!0,with_permission_to:!0};return e.data.date_range&&(a.date_range=e.data.date_range),e.data.statuses&&(a.status=e.data.statuses),window.tommy.api.call({endpoint:"wallet/manager/transactions"}).then(function(t){r.addTransactions(t),e.transactions=t})}console.log("transactions already loaded",e)},loadTransactions:function(){console.log("load transactions");var t=[];for(var e in r.cache.lists){var n=r.cache.lists[e],a=r.loadListTransactions(n);a&&t.push(a)}return Promise.all(t).then(r.addTasks)},addTransactionActivity:function(t,e,n){var a=window.tommy.config.getCurrentUser(),i={type:e,text:n,time:new Date,user_id:a.id,user_name:a.first_name};return t.data||(t.data={}),t.data.activity||(t.data.activity=[]),t.data.activity.unshift(i),i},saveTransaction:function(t){if(console.log("save transaction",t),t.name){if(o.default.invalidateLists=!0,t.addon="accounts",t.kind="Transaction",t.with_filters=!0,t.with_permission_to=!0,t.id||r.addTransactionActivity(t,"status",window.tommy.i18n.t("transaction.created_a_transaction")),t.status||(t.status=r.STATUSES[0]),t.start_at||(t.start_at=(new Date).getTime()),!t.id){t.with_permissions=["transaction_create_access","transaction_edit_access"];var e=window.tommy.addons.getCurrentActor();e&&(t.filters||(t.filters=[]),t.filters.push({context:"members",name:e.first_name+" "+e.last_name,user_id:e.user_id}))}var n=Object.assign({},t,{data:JSON.stringify(t.data)});return t.id?window.tommy.api.updateFragment(t.id,n).then(r.addTransaction):window.tommy.api.createFragment(n).then(r.addTransaction)}alert("Transaction name must be set")},addList:function(t){r.cache.lists[t.id]=t,console.log("added transaction list",t)},addLists:function(t){if(r.listsLoaded=!0,t&&t.length)for(var e=0;e<t.length;e++)r.addList(t[e])},loadLists:function(t){return console.log("load transaction lists",t),t=Object.assign({addon:"accounts",kind:"TransactionList",with_filters:!0,with_permission_to:!0},t),window.tommy.api.getFragments(t).then(r.addLists)},deleteList:function(t){return o.default.invalidateLists=!0,delete r.cache.lists[t],console.log("delete list",t),window.tommy.api.deleteFragment(t)},saveList:function(t){console.log("save list",t),r.transactionsLoaded=!1,t._transactionsLoaded=!1,o.default.invalidateLists=!0,t.addon="accounts",t.kind="TransactionList",t.with_filters=!0,t.with_permission_to=!0,t.data||(t.data={}),void 0===t.data.position&&(t.data.position=Object.keys(r.cache.lists).length),void 0===t.data.active&&(t.data.active=!0),void 0===t.data.show_fast_add&&(t.data.show_fast_add=!0),t.id||(t.with_permissions=["transaction_list_read_access","transaction_list_edit_access"]);var e=Object.assign({},t,{data:JSON.stringify(t.data),filters:JSON.stringify(t.filters)});return t.id?window.tommy.api.updateFragment(t.id,e).then(r.addList):window.tommy.api.createFragment(e).then(r.addList)},currentUserTag:function(){return{context:"members",name:window.tommy.config.getCurrentUserName(),user_id:window.tommy.config.getCurrentUserId()}},createDefaultList:function(){console.log("creating deafult transaction list");var t={name:window.tommy.i18n.t("index.default-list-name"),data:{default:!0},filters:[r.currentUserTag()]};return r.saveList(t)},hasDefaultList:function(){return r.cache.lists&&0<Object.values(r.cache.lists).filter(function(t){return t.data.default}).length},initPermissionSelect:function(e,t,n){console.log("init permission selects",t,n);var a={resource_id:n,with_filters:!0};window.tommy.api.getInstalledAddonPermission("accounts",t,a).then(function(t){console.log("installed addon permission",t),t.resource_id=n,window.tommy.tplManager.appendInline("accounts__tagSelectTemplate",t,e.container),r.initTagSelect(e,t)})},initTagSelect:function(t,e){var n=$$(t.container).find('.tag-select[data-permission-name="'+e.name+'"]');console.log("init tag select",e,n.dataset()),window.tommy.tagSelect.initWidget(n,e.filters,function(t){console.log("save permission tags",e,t),window.tommy.api.updateInstalledAddonPermission("accounts",e.name,{resource_id:e.resource_id,with_filters:!0,filters:JSON.stringify(t)})})},isTablet:function(){return 630<=window.innerWidth},STATUSES:["Unassigned","Assigned","Processing","Completed","Closed","Archive Transaction","Cancel"],translateStatus:function(t){if(t)return window.tommy.i18n.t("status."+window.tommy.util.underscore(t),{defaultValue:t})},untranslateStatus:function(t){for(var e=0;e<r.STATUSES.length;e++)if(r.translateStatus(r.STATUSES[e])===t)return r.STATUSES[e]},translatedStatuses:function(){for(var t=[],e=0;e<r.STATUSES.length;e++)t.push(r.translateStatus(r.STATUSES[e]));return t}};n.default=r},{"./controllers/index":3}],2:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,i=t("../api"),o=(a=i)&&a.__esModule?a:{default:a};var r={init:function(t){var e=$$(t.container);$$(t.navbarInnerContainer);window.tommy.tplManager.renderInline("accounts__boardSettingTemplate",null,e),window.tommy.util.isTeamOwnerOrManager()&&(o.default.initPermissionSelect(t,"transaction_create_access"),o.default.initPermissionSelect(t,"transaction_edit_access"))}};n.default=r},{"../api":1}],3:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,i=t("../api"),o=(a=i)&&a.__esModule?a:{default:a};var r={init:function(t){console.log("initialize accounts addon"),o.default.listsLoaded?o.default.transactionsLoaded?r.invalidate(t):r.loadTransactions(t):(o.default.initCache(),o.default.loadLists().then(function(){o.default.hasDefaultList()?r.loadTransactions(t):o.default.createDefaultList().then(function(){r.loadTransactions(t)})})),r.bind(t)},loadTransactions:function(t){o.default.loadTransactions().then(function(){r.invalidate(t)})},uninit:function(){console.log("uninitialize accounts addon"),o.default.cache={}},bind:function(t){$$(t.container).find(".list-content").each(function(){var t=$$(this);t[0].scrollHeight>=t[0].clientHeight&&t.parent().addClass("hasScroll")}),$$(document).on("picker:open",function(t){var e=$$(t.target);if(e.hasClass("tag-select-picker")){var n=window.tommy.config.getCurrentUserName();e.find('input[value="'+n+'"]').parent().parent().addClass("offscreen")}})},invalidate:function(t){console.log("invalidating accounts index");var e=$$(t.container);console.log("rendering transaction lists"),r.invalidateLists=!1,window.tommy.tplManager.renderInline("accounts__listsTemplate",o.default.getOrderedLists(),t.container);window.tommy.app.f7.swiper(".swiper-container",{centeredSlides:!o.default.isTablet(),spaceBetween:0,freeMode:!1,freeModeSticky:!0,slidesPerView:"auto"});for(var n in o.default.cache.lists){var a=e.find('[data-list-id="'+n+'"] .list-content'),i=o.default.getListTransactions(n);window.tommy.tplManager.renderTarget("accounts__listTransactionsTemplate",i,a)}}};n.default=r},{"../api":1}],4:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,i=t("../api"),o=(a=i)&&a.__esModule?a:{default:a};var r={init:function(t){var n=$$(t.container);$$(t.navbarInnerContainer).find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(n.find("form"));r.saveList(e),t.preventDefault()})},saveList:function(t){var e={};e.name=t.name,e.filters=[o.default.currentUserTag()],o.default.saveList(e).then(r.afterSave)},afterSave:function(t){console.log("list saved",t),window.tommy.app.f7view.router.back()}};n.default=r},{"../api":1}],5:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var g=a(t("../api")),_=a(t("../format-date-range"));function a(t){return t&&t.__esModule?t:{default:t}}var w={init:function(e){var n=g.default.cache.lists[e.query.list_fragment_id],a=$$(e.container),t=$$(e.navbarInnerContainer);console.log("edit list",n),window.tommy.tplManager.renderInline("accounts__listEditTemplate",n,a),w.initListFilters(e,n),g.default.initPermissionSelect(e,"transaction_list_read_access",n.id),g.default.initPermissionSelect(e,"transaction_list_edit_access",n.id),t.find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(a.find("form"));w.saveList(n,e),t.preventDefault()}),a.find(".date-range-select").on("click",function(t){w.showDateRangePage(e,n),t.preventDefault()}),a.find('select[name="statuses"]').on("change",function(t){n.data.statuses=$$(t.target).val(),console.log("update statuses",n.data.statuses)}),a.find(".delete-list").on("click",function(t){g.default.deleteList(n.id),window.tommy.app.f7view.router.back(),t.preventDefault()})},showDateRangePage:function(m,p){var t=window.tommy.tplManager.render("accounts__dateRangeSelectTemplate",p.data);$$(window.tommy.f7.views.main.container).once("page:init",'[data-page="accounts__date-range-select"]',function(t){!function(t){var e=$$(t.container),n=$$(t.navbarInnerContainer),a=p.data.date_range,i=Array.isArray(a)&&a[0]?a:(new Date).getTime(),o=Array.isArray(a)&&a[1]?a:(new Date).getTime(),r=e.find('input[name="time_or_created_between"]'),s=e.find(".label-switch input");function c(){n.find(".toggle.save").addClass("active")}"string"==typeof a&&a?(e.find('input[name="time_or_created_between"][value="'+a+'"]').prop("checked",!0),e.find(".date-range-custom-item").hide()):a?Array.isArray(a)&&s.prop("checked",!0):(e.find('input[name="time_or_created_between"][value=""]').prop("checked",!0),e.find(".date-range-custom-item").hide());var d=void 0,l=void 0,u=window.tommy.app.f7.calendar({input:e.find('input[name="start_at"]'),closeOnSelect:!0,value:[i],onChange:function(t,e){d&&c(),d=!0,i=new Date(e[0]).getTime(),Array.isArray(a)&&a[0]&&(a[0]=i),o<i&&f.setValue([i])}}),f=window.tommy.app.f7.calendar({input:e.find('input[name="end_at"]'),closeOnSelect:!0,value:[o],onChange:function(t,e){l&&c(),l=!0,o=new Date(e[0]).getTime(),Array.isArray(a)&&a[1]&&(a[1]=o),o<i&&u.setValue([o])}});s.on("change",function(t){t.target.checked?(e.find(".date-range-custom-item").show(),r.prop("checked",!1),a=[i,o]):(a="",e.find(".date-range-custom-item").hide()),c()}),r.on("change",function(t){t.target.checked&&(s.prop("checked",!1).trigger("change"),a=t.target.value),c()}),n.find(".toggle.save").on("click",function(){p.data.date_range=a,g.default.saveList(p).then(function(t){$$(m.container).find(".date-range-select .item-after").text((0,_.default)(a)),w.afterSave(t)})})}(t.detail.page)}),window.tommy.f7.views.main.loadContent(t)},initListFilters:function(t,e){var n={title:window.tommy.i18n.t("parmissions.filter_transactions.title"),name:"filter_transactions"},a=window.tommy.tplManager.appendInline("accounts__tagSelectTemplate",n,t.container);console.log("init filter select",e.filters),window.tommy.tagSelect.initWidget(a,e.filters,function(t){console.log("save filter tags",t),e.filters=t})},saveList:function(t,e){t.name=e.name,t.data.show_fast_add=!(!e.show_fast_add||!e.show_fast_add.length),g.default.saveList(t).then(w.afterSave)},afterSave:function(t){console.log("list saved",t),window.tommy.app.f7view.router.back()}};n.default=w},{"../api":1,"../format-date-range":10}],6:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,i=t("../api"),o=(a=i)&&a.__esModule?a:{default:a};var r={init:function(n){var a=$$(n.container),t=$$(n.navbarInnerContainer);r.render(n),t.find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(a.find("form"));r.save(n,e),t.preventDefault()}),a.on("change",'input[type="checkbox"]',function(){t.find("a.save").addClass("active")})},render:function(t){var e=$$(t.container);window.tommy.tplManager.renderInline("accounts__listManagementTemplate",o.default.getOrderedLists(),e)},save:function(t,e){var n=$$(t.container),i=!1;n.find(".sortable [data-list-id]").each(function(t){var e=$$(this),n=o.default.cache.lists[e.data("list-id")],a=e.find('input[type="checkbox"]')[0].checked;console.log("save list order",n.name,n.data.position,t,n.data.active,a),n.data.position==t&&n.data.active==a||(n.data.position=t,n.data.active=a,o.default.saveList(n),console.log("updated list",n),i||(i=!0,window.tommy.app.f7view.router.back()))})}};n.default=r},{"../api":1}],7:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,i=t("../api"),o=(a=i)&&a.__esModule?a:{default:a};var r={init:function(t){var n=$$(t.container),e=$$(t.navbarInnerContainer);window.tommy.tplManager.renderInline("accounts__addTransactionTemplate",{},n),e.find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(n.find("form"));e.filters=[o.default.currentUserTag()],r.saveTransaction(e),t.preventDefault()})},saveTransaction:function(t){o.default.saveTransaction(t).then(r.afterSave)},afterSave:function(t){console.log("transaction saved",t),window.tommy.app.f7view.router.back()}};n.default=r},{"../api":1}],8:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,i=t("../api"),o=(a=i)&&a.__esModule?a:{default:a};var r={init:function(t){var e=t.query.id,n=o.default.cache.transactions[e];console.error({transaction:n}),window.tommy.tplManager.renderInline("accounts__transactionDetailsTemplate",n,t.container)},uninit:function(){}};n.default=r},{"../api":1}],9:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){return t&&a[t]?a[t]:""};var a={AED:"د.إ",AFN:"؋",ALL:"L",AMD:"֏",ANG:"ƒ",AOA:"Kz",ARS:"$",AUD:"$",AWG:"ƒ",AZN:"₼",BAM:"KM",BBD:"$",BDT:"৳",BGN:"лв",BHD:".د.ب",BIF:"FBu",BMD:"$",BND:"$",BOB:"$b",BRL:"R$",BSD:"$",BTC:"฿",BTN:"Nu.",BWP:"P",BYR:"Br",BYN:"Br",BZD:"BZ$",CAD:"$",CDF:"FC",CHF:"CHF",CLP:"$",CNY:"¥",COP:"$",CRC:"₡",CUC:"$",CUP:"₱",CVE:"$",CZK:"Kč",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"دج",EEK:"kr",EGP:"£",ERN:"Nfk",ETB:"Br",ETH:"Ξ",EUR:"€",FJD:"$",FKP:"£",GBP:"£",GEL:"₾",GGP:"£",GHC:"₵",GHS:"GH₵",GIP:"£",GMD:"D",GNF:"FG",GTQ:"Q",GYD:"$",HKD:"$",HNL:"L",HRK:"kn",HTG:"G",HUF:"Ft",IDR:"Rp",ILS:"₪",IMP:"£",INR:"₹",IQD:"ع.د",IRR:"﷼",ISK:"kr",JEP:"£",JMD:"J$",JOD:"JD",JPY:"¥",KES:"KSh",KGS:"лв",KHR:"៛",KMF:"CF",KPW:"₩",KRW:"₩",KWD:"KD",KYD:"$",KZT:"лв",LAK:"₭",LBP:"£",LKR:"₨",LRD:"$",LSL:"M",LTC:"Ł",LTL:"Lt",LVL:"Ls",LYD:"LD",MAD:"MAD",MDL:"lei",MGA:"Ar",MKD:"ден",MMK:"K",MNT:"₮",MOP:"MOP$",MRO:"UM",MRU:"UM",MUR:"₨",MVR:"Rf",MWK:"MK",MXN:"$",MYR:"RM",MZN:"MT",NAD:"$",NGN:"₦",NIO:"C$",NOK:"kr",NPR:"₨",NZD:"$",OMR:"﷼",PAB:"B/.",PEN:"S/.",PGK:"K",PHP:"₱",PKR:"₨",PLN:"zł",PYG:"Gs",QAR:"﷼",RMB:"￥",RON:"lei",RSD:"Дин.",RUB:"₽",RWF:"R₣",SAR:"﷼",SBD:"$",SCR:"₨",SDG:"ج.س.",SEK:"kr",SGD:"$",SHP:"£",SLL:"Le",SOS:"S",SRD:"$",SSP:"£",STD:"Db",STN:"Db",SVC:"$",SYP:"£",SZL:"E",THB:"฿",TJS:"SM",TMT:"T",TND:"د.ت",TOP:"T$",TRL:"₤",TRY:"₺",TTD:"TT$",TVD:"$",TWD:"NT$",TZS:"TSh",UAH:"₴",UGX:"USh",USD:"$",UYU:"$U",UZS:"лв",VEF:"Bs",VND:"₫",VUV:"VT",WST:"WS$",XAF:"FCFA",XBT:"Ƀ",XCD:"$",XOF:"CFA",XPF:"₣",YER:"﷼",ZAR:"R",ZWD:"Z$"}},{}],10:[function(t,e,n){"use strict";function a(t){var e=new Date,n=e.getFullYear(),a=e.getMonth()+1,i=e.getDate();return a<10&&(a="0"+a),i<10&&(i="0"+i),n+"-"+a+"-"+i}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t){return t?"string"==typeof t?window.tommy.i18n.t("date_range."+t):Array.isArray(t)?a(t[0])+" - "+a(t[1]):t||"":""}},{}],11:[function(t,e,n){"use strict";var i=m(t("./api")),a=m(t("./controllers/index")),o=m(t("./controllers/transaction-details")),r=m(t("./controllers/transaction-add")),s=m(t("./controllers/list-add")),c=m(t("./controllers/list-edit")),d=m(t("./controllers/list-management")),l=m(t("./controllers/board-settings")),u=m(t("./format-date-range")),f=m(t("./currency-map"));function m(t){return t&&t.__esModule?t:{default:t}}window.tommy.app.f7.onPageInit("accounts__index",a.default.init),window.tommy.app.f7.onPageBack("accounts__index",a.default.uninit),window.tommy.app.f7.onPageAfterAnimation("accounts__index",a.default.invalidate),window.tommy.app.f7.onPageInit("accounts__board-settings",l.default.init),window.tommy.app.f7.onPageInit("accounts__list-add",s.default.init),window.tommy.app.f7.onPageInit("accounts__list-edit",c.default.init),window.tommy.app.f7.onPageInit("accounts__list-management",d.default.init),window.tommy.app.f7.onPageAfterAnimation("accounts__list-management",d.default.render),window.tommy.app.f7.onPageInit("accounts__transaction-add",r.default.init),window.tommy.app.f7.onPageInit("accounts__transaction_details",o.default.init),window.tommy.app.f7.onPageBeforeRemove("accounts__transaction_details",o.default.uninit),window.tommy.app.t7.registerHelper("accounts__checklistNumCompleted",function(t){var e="";t&&t.items&&(e+=t.items.filter(function(t){return t.complete}).length,e+="/",e+=t.items.length);return e}),window.tommy.app.t7.registerHelper("accounts__displayStatus",function(t){return i.default.translateStatus(t)}),window.tommy.app.t7.registerHelper("accounts__displayStatuses",function(t){return t?t.map(function(t){return i.default.translateStatus(t)}).join(", "):""}),window.tommy.app.t7.registerHelper("accounts__statusSelectOptions",function(t){for(var e="",n=0;n<i.default.STATUSES.length;n++){var a=i.default.STATUSES[n];e+='<option value="'+a+'" '+(t&&-1!==t.indexOf(a)?"selected":"")+">"+i.default.translateStatus(a)+"</option>"}return e}),window.tommy.app.t7.registerHelper("accounts__ifCanEditList",function(t,e){window.tommy.config.getCurrentAccount();return-1!==t.permission_to.indexOf("update")?e.fn(t,e.data):e.inverse(t,e.data)}),window.tommy.app.t7.registerHelper("accounts__displayDateRange",function(t){return(0,u.default)(t)}),window.tommy.app.t7.registerHelper("accounts__formatTransactionAmount",function(t){return("paid"===t.status||"failed"===t.status?"-":"+")+" "+(0,f.default)(t.currency)+t.amount}),window.tommy.app.t7.registerHelper("accounts__currencySymbol",function(t){return(0,f.default)(t)}),window.tommy.app.t7.registerHelper("accounts__formatTransactionStatus",function(t){return t[0].toUpperCase()+t.substr(1)}),window.tommy.app.t7.registerHelper("accounts__formatTransactionDate",function(t){if(!t)return"";var e=new Date(t),n=e.getFullYear(),a=e.getMonth()+1;a<10&&(a="0"+a);var i=e.getDate();i<10&&(i="0"+i);var o=e.getHours();o<10&&(o="0"+o);var r=e.getMinutes();return r<10&&(r="0"+r),n+"-"+a+"-"+i+" "+o+":"+r})},{"./api":1,"./controllers/board-settings":2,"./controllers/index":3,"./controllers/list-add":4,"./controllers/list-edit":5,"./controllers/list-management":6,"./controllers/transaction-add":7,"./controllers/transaction-details":8,"./currency-map":9,"./format-date-range":10}]},{},[11]);