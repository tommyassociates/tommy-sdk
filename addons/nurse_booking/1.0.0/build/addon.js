var addon=function(){function d(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{attrs:{name:"nurse_booking__index",id:"nurse_booking__index"},on:{"page:beforein":e.onPageBeforeIn,"page:beforeout":e.onPageBeforeOut}},[a("f7-navbar",[a("tommy-nav-menu"),e._v(" "),a("f7-nav-title",[e._v(e._s(e.$t("nurse_booking.index.title","Nurse Booking")))])],1),e._v(" "),a("f7-swiper",{ref:"swiper",attrs:{pagination:""}},[a("f7-swiper-slide",{staticClass:"swiper-slide",style:"background-image: url("+e.$addonAssetUrl+"demo-slide.jpg)"}),e._v(" "),a("f7-swiper-slide",{staticClass:"swiper-slide",style:"background-image: url("+e.$addonAssetUrl+"demo-slide.jpg)"}),e._v(" "),a("f7-swiper-slide",{staticClass:"swiper-slide",style:"background-image: url("+e.$addonAssetUrl+"demo-slide.jpg)"})],1),e._v(" "),a("div",{staticClass:"sections"},[a("div",{staticClass:"section"},[a("a",{attrs:{href:"/nurse_booking/service-list/?category=Cleaning&masterDetailRoot=true","data-reload-detail":"true"}},[a("img",{attrs:{src:e.$addonAssetUrl+"icon-cleaning.svg"}}),e._v(" "),a("span",[e._v(e._s(e.$t("nurse_booking.index.cleaning_label","Cleaning")))])])]),e._v(" "),a("div",{staticClass:"section"},[a("a",{attrs:{href:"/nurse_booking/service-list/?category=Elderservice&masterDetailRoot=true","data-reload-detail":"true"}},[a("img",{attrs:{src:e.$addonAssetUrl+"icon-elderservice.svg"}}),e._v(" "),a("span",[e._v(e._s(e.$t("nurse_booking.index.elderservice_label","Elders Service")))])])]),e._v(" "),a("div",{staticClass:"section"},[a("a",{attrs:{href:"/nurse_booking/service-list/?category=Extras&masterDetailRoot=true","data-reload-detail":"true"}},[a("img",{attrs:{src:e.$addonAssetUrl+"icon-extras.svg"}}),e._v(" "),a("span",[e._v(e._s(e.$t("nurse_booking.index.extras_label","Accompany to Go Out")))])])]),e._v(" "),a("div",{staticClass:"section"},[a("a",{attrs:{href:"/nurse_booking/service-list/?category=Nursing&masterDetailRoot=true","data-reload-detail":"true"}},[a("img",{attrs:{src:e.$addonAssetUrl+"icon-nursing.svg"}}),e._v(" "),a("span",[e._v(e._s(e.$t("nurse_booking.index.nursing_label","Nursing")))])])]),e._v(" "),a("div",{staticClass:"section"},[a("a",{attrs:{href:"/nurse_booking/service-list/?category=Massage&masterDetailRoot=true","data-reload-detail":"true"}},[a("img",{attrs:{src:e.$addonAssetUrl+"icon-massage.svg"}}),e._v(" "),a("span",[e._v(e._s(e.$t("nurse_booking.index.massage_label","Massage")))])])]),e._v(" "),a("div",{staticClass:"section"},[a("a",{attrs:{href:"/nurse_booking/history/?masterDetailRoot=true","data-reload-detail":"true"}},[a("img",{attrs:{src:e.$addonAssetUrl+"icon-booking.svg"}}),e._v(" "),a("span",[e._v(e._s(e.$t("nurse_booking.index.booking_label","Booking")))])])]),e._v(" "),a("div",{staticClass:"section"},[a("a",{staticClass:"external",attrs:{href:"tommy://addon?package=wallet&back=true"}},[a("img",{attrs:{src:e.$addonAssetUrl+"icon-wallet.svg"}}),e._v(" "),a("span",[e._v(e._s(e.$t("nurse_booking.index.wallet_label","Wallet")))])])])])],1)}function m(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{attrs:{name:"nurse_booking__vip",id:"nurse_booking__vip"},on:{"page:beforein":e.onPageBeforeIn,"page:beforeout":e.onPageBeforeOut}},[a("f7-navbar",[a("tommy-nav-back")],1),e._v(" "),a("div",{staticClass:"vip-header"},[a("div",{staticClass:"avatar",style:"background-image: url("+e.$addonAssetsUrl+"demo-avatar.png"},[a("div",{staticClass:"medal medal-green"})]),e._v(" "),a("div",{staticClass:"name"},[e._v("Allen Zhang")])]),e._v(" "),a("div",{staticClass:"vip-info"},[e._v(e._s(e.$t("nurse_booking.vip.info")))]),e._v(" "),a("div",{staticClass:"vip-plans"},[a("a",{staticClass:"vip-plan vip-plan-green",attrs:{href:"/nurse_booking/vip-details/"}},[a("div",{staticClass:"vip-plan-badge"},[e._v(e._s(e.$t("nurse_booking.vip.current_plan_badge")))]),e._v(" "),a("div",{staticClass:"vip-plan-title"},[e._v(e._s(e.$t("nurse_booking.vip.plan_green")))])]),e._v(" "),a("a",{staticClass:"vip-plan vip-plan-gold",attrs:{href:"/nurse_booking/vip-details/"}},[a("div",{staticClass:"vip-plan-badge"},[e._v(e._s(e.$t("nurse_booking.vip.recommended_plan_badge")))]),e._v(" "),a("div",{staticClass:"vip-plan-title"},[e._v(e._s(e.$t("nurse_booking.vip.plan_gold")))])]),e._v(" "),a("a",{staticClass:"vip-plan vip-plan-platinum",attrs:{href:"/nurse_booking/vip-details/"}},[a("div",{staticClass:"vip-plan-title"},[e._v(e._s(e.$t("nurse_booking.vip.plan_platinum")))])])])],1)}function v(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{attrs:{name:"nurse_booking__vip-details",id:"nurse_booking__vip-details"},on:{"page:beforein":e.onPageBeforeIn,"page:beforeout":e.onPageBeforeOut}},[a("f7-navbar",[a("tommy-nav-back")],1),e._v(" "),a("div",{staticClass:"vip-header"},[a("div",{staticClass:"avatar",style:"background-image: url("+e.$addonAssetsUrl+"demo-avatar.png"},[a("div",{staticClass:"medal medal-green"})]),e._v(" "),a("div",{staticClass:"name"},[e._v("Allen Zhang")])]),e._v(" "),a("div",{staticClass:"vip-plan-details"},[a("div",{staticClass:"vip-plan-current"},[e._v(e._s(e.$t("nurse_booking.vip.plan_green")))]),e._v(" "),a("div",{staticClass:"vip-plan-expiration"},[e._v("Expires 3rd April")])]),e._v(" "),a("div",{staticClass:"list vip-details-list"},[a("ul",[a("li",{staticClass:"item-divider"},[e._v(e._s(e.$t("nurse_booking.vip.details_plan_inclusion")))]),e._v(" "),a("li",{staticClass:"item-content"},[a("div",{staticClass:"item-inner"},[a("div",{staticClass:"item-title"},[a("div",[e._v("Nurse Visit")]),e._v(" "),a("div",{staticClass:"item-subtitle"},[a("b",[e._v("Four")]),e._v(" ("),a("b",[e._v("one")]),e._v(" time left) per month\n            ")])])])]),e._v(" "),a("li",{staticClass:"item-content"},[a("div",{staticClass:"item-inner"},[a("div",{staticClass:"item-title"},[a("div",[e._v("Clean")]),e._v(" "),a("div",{staticClass:"item-subtitle"},[a("b",[e._v("Four+One")]),e._v(" per month\n            ")])])])]),e._v(" "),a("li",{staticClass:"item-content"},[a("div",{staticClass:"item-inner"},[a("div",{staticClass:"item-title"},[a("div",[e._v("Massage")])])])]),e._v(" "),a("li",{staticClass:"item-divider"},[e._v(e._s(e.$t("nurse_booking.vip.details_administration")))]),e._v(" "),a("li",[a("a",{staticClass:"item-content item-link",attrs:{href:"#"}},[a("div",{staticClass:"item-inner"},[a("div",{staticClass:"item-title"},[e._v("Change Subscription")])])])]),e._v(" "),a("li",[a("a",{staticClass:"item-content item-link",attrs:{href:"#"}},[a("div",{staticClass:"item-inner"},[a("div",{staticClass:"item-title"},[e._v("Coupon")]),e._v(" "),a("div",{staticClass:"item-after"},[a("b",[e._v("4 Sheets")])])])])])])])],1)}var e=function normalizeComponent(e,t,a,o,i,s,n,r,d,c){"boolean"!=typeof n&&(d=r,r=n,n=!1);var l,u="function"==typeof a?a.options:a;if(e&&e.render&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0,i&&(u.functional=!0)),o&&(u._scopeId=o),s?(l=function hook(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,d(e)),e&&e._registeredComponents&&e._registeredComponents.add(s)},u._ssrRegister=l):t&&(l=n?function(){t.call(this,c(this.$root.$options.shadowRoot))}:function(e){t.call(this,r(e))}),l)if(u.functional){var v=u.render;u.render=function renderWithStyleInjection(e,t){return l.call(t),v(e,t)}}else{var _=u.beforeCreate;u.beforeCreate=_?[].concat(_,l):[l]}return a},t={beforeDestroy:function beforeDestroy(){this.$f7router.view.$navbarEl.removeClass("nurse-booking-index-navbar")},mounted:function mounted(){var e=this;e.$refs.swiper&&e.$refs.swiper.swiper&&e.$nextTick(function(){e.$refs.swiper.swiper.update()})},methods:{onPageBeforeIn:function onPageBeforeIn(){this.$f7router.view.$navbarEl.addClass("nurse-booking-index-navbar")},onPageBeforeOut:function onPageBeforeOut(){this.$f7router.view.$navbarEl.removeClass("nurse-booking-index-navbar")}}},a=(d._withStripped=!0,e({render:d,staticRenderFns:[]},void 0,t,void 0,!(d._withStripped=!0),void 0,void 0,void 0)),o={beforeDestroy:function beforeDestroy(){this.$f7router.view.$navbarEl.removeClass("nurse-booking-vip-navbar")},methods:{onPageBeforeIn:function onPageBeforeIn(){this.$f7router.view.$navbarEl.addClass("nurse-booking-vip-navbar")},onPageBeforeOut:function onPageBeforeOut(e,t){"previous"!==t.to&&this.$f7router.view.$navbarEl.removeClass("nurse-booking-vip-navbar")}}},i=(m._withStripped=!0,e({render:m,staticRenderFns:[]},void 0,o,void 0,!(m._withStripped=!0),void 0,void 0,void 0)),s={methods:{onPageBeforeIn:function onPageBeforeIn(){},onPageBeforeOut:function onPageBeforeOut(){}}},n=(v._withStripped=!0,e({render:v,staticRenderFns:[]},void 0,s,void 0,!(v._withStripped=!0),void 0,void 0,void 0)),r=window.tommy,c=r.api,$={cache:{services:[],coupons:[],locations:[],booking:{},nurse:{}},getServiceList:function getServiceList(e){return Promise.all([c.call({endpoint:"vendors/"+e+"/products",method:"GET",data:{}}),c.call({endpoint:"vendors/"+e+"/packages",method:"GET",data:{}})]).then(function(e){var t=e[0],a=e[1],o=t.concat(a).filter(function(e){return e.active});return $.cache.services=o})},getServiceDetails:function getServiceDetails(e,t,a){return c.call({endpoint:"vendors/"+e+"/"+("VendorProduct"===a?"products":"packages")+"/"+t,method:"GET"}).then(function(e){return e})},getCouponList:function getCouponList(e){return c.call({endpoint:"vendors/"+e+"/coupons",method:"GET",data:{},cache:!1}).then(function(e){return $.cache.coupons=e})},getLocations:function getLocations(){return c.call({endpoint:"addons/nurse_booking/install/settings/locations",method:"GET"}).then(function(e){return $.cache.locations=e&&e.data&&e.data.locations?e.data.locations:[],$.cache.locations})},getNurseList:function getNurseList(e,t,a){var o=r.moment(new Date(t)).toISOString(!0),i=r.moment(new Date(a)).toISOString(!0);return c.call({endpoint:"teams/"+e+"/members",method:"GET",data:{tags:["Employee"],is_available_between:[o,i],timezone_offset:(new Date).getTimezoneOffset()},cache:!1}).then(function(e){return $.cache.nurses=(e||[]).filter(function(e){return!0===e.is_available}),$.cache.nurses})},saveLocations:function saveLocations(e){return e?$.cache.locations=e:e=$.cache.locations,c.call({endpoint:"addons/nurse_booking/install/settings/locations",method:"PUT",data:{data:JSON.stringify({locations:e})}}).then(function(e){return e.data.locations})},addLocation:function addLocation(e){return e.default?($.cache.locations.forEach(function(e){e.default=!1}),$.cache.locations.unshift(e)):$.cache.locations.push(e),$.saveLocations($.cache.locations)},removeLocation:function removeLocation(e){return $.cache.locations.splice(e,1),$.saveLocations($.cache.locations)},createBookingEvent:function createBookingEvent(e,t){var a,o=t.data.date;return"string"==typeof o&&(o=parseInt(o,10)),t.data.duration&&0<t.data.duration&&(a=o+60*parseInt(t.data.duration,10)*1e3),c.createEvent({addon:"nurse_booking",title:t.name,start_at:new Date(o).toJSON(),end_at:new Date(a).toJSON(),location:t.data.location.city+" "+t.data.location.address,user_id:t.user_id,team_id:null,assignee_id:t.data.nurse.user_id,assignee_team_id:e,kind:"Booking",resource_id:t.id,resource_type:"VendorOrder"})},deleteBookingEvent:function deleteBookingEvent(e){return c.getEvents({addon:"nurse_booking",kind:"Booking",resource_id:e,resource_type:"VendorOrder"}).then(function(e){return Promise.all(e.map(function(e){return c.deleteEvent(e.id)}))})},setAvailabilityLock:function setAvailabilityLock(e){var o=e.data.nurse.user_id,i=new Date(e.data.date),s=i.getHours();i.setHours(0,0,0,0),i=new Date(i.getTime()-60*i.getTimezoneOffset()*1e3);var t=new Date(i.getTime()-864e5),a=new Date(i.getTime()+864e5);return c.call({endpoint:"fragments?addon=availability&kind=Availability",data:{user_id:o,date_range:[t.toJSON(),a.toJSON()]}}).then(function(e){var t;e.forEach(function(e){new Date(e.start_at).toJSON()===i.toJSON()&&(t=e)});var a={};return 7<=s&&s<13?a.lock_am=!0:13<=s&&s<22?a.lock_pm=!0:a.lock_nd=!0,t?(Object.assign(t.data,a),c.updateFragment(t.id,t)):c.createFragment({addon:"availability",kind:"Availability",data:JSON.stringify(Object.assign({},a)),start_at:i.toJSON(),user_id:o})})},deleteAvailabilityLock:function deleteAvailabilityLock(e){var t=e.data.nurse.user_id,o=new Date(parseInt(e.data.date,10)),i=o.getHours();o.setHours(0,0,0,0),o=new Date(o.getTime()-60*o.getTimezoneOffset()*1e3);var a=new Date(o.getTime()-864e5),s=new Date(o.getTime()+864e5);return c.call({endpoint:"fragments?addon=availability&kind=Availability",data:{user_id:t,date_range:[a.toJSON(),s.toJSON()]}}).then(function(e){var t,a;return e.forEach(function(e){new Date(e.start_at).toJSON()===o.toJSON()&&(t=e)}),a=7<=i&&i<13?"lock_am":13<=i&&i<22?"lock_pm":"lock_nd",t&&t.data&&t.data[a]?(delete t.data[a],c.updateFragment(t.id,t)):Promise.resolve("nothing-to-remove")})},sendOrder:function sendOrder(e,t){return c.call({endpoint:"vendors/"+e+"/orders",method:"POST",data:t})},updateOrder:function updateOrder(e,t){return c.call({endpoint:"vendors/"+e+"/orders/"+t.id,method:"PUT",data:t})},getOrdersHistory:function getOrdersHistory(e){return c.call({endpoint:"vendors/"+e+"/orders/",method:"GET",cache:!1}).then(function(e){return $.cache.orders=e})},getOrderDetails:function getOrderDetails(e,t){return c.call({endpoint:"vendors/"+e+"/orders/"+t+"?with_wallet_transaction=true",method:"GET"}).then(function(e){return e})},cancelOrder:function cancelOrder(e,t){return c.call({endpoint:"vendors/"+e+"/orders/"+t,method:"DELETE"})}},l={Massage:"按摩",Cleaning:"常规家政",Nursing:"护理",Elderservice:"老人家政",Extras:"外出陪同"};function couponsForService(t,e,a){void 0===t&&(t={}),void 0===e&&(e=[]);var o=!!t.vendor_package_products,i=e.filter(function(e){return e.category===t.category||t.category===l[e.category]||(o&&e.vendor_package_id===t.id||!o&&e.vendor_product_id===t.id)});return i=i.filter(function(e){return!(e.max_uses&&e.use_count>=e.max_uses)&&((!e.user_id||e.user_id===a)&&!(e.valid_to&&(new Date).getTime()>new Date(e.valid_to).getTime()))})}function I(){var t=this,e=t.$createElement,a=t._self._c||e;return a("f7-page",{attrs:{name:"nurse_booking__service-list",id:"nurse_booking__service-list"}},[a("f7-navbar",[a("tommy-nav-back"),t._v(" "),a("f7-nav-title",[t._v(t._s(t.$t("nurse_booking.service_list."+t.category.toLowerCase()+"_title")))])],1),t._v(" "),t.services&&!t.services.length?a("div",{staticClass:"nurse_booking__empty-placeholder"},[t._v("\n    "+t._s(t.$t("nurse_booking.service_list.empty_label"))+"\n  ")]):t._e(),t._v(" "),t.services&&t.services.length?a("f7-swiper",{staticClass:"service-cards no-swipe-panel",attrs:{params:{centeredSlides:!0,slidesPerView:"auto",touchMoveStopPropagation:!1,on:{tap:t.onSlideClick}}}},t._l(t.services,function(e){return a("f7-swiper-slide",{key:t.serviceType(e)+"-"+e.id,attrs:{"data-url":"/nurse_booking/service-details/"+e.id+"/?type="+t.serviceType(e)}},[a("a",{staticClass:"service-card",attrs:{href:"#"}},[a("div",{staticClass:"service-card-pic",style:"background-image:url("+t.serviceImage(e)+")"}),t._v(" "),a("div",{staticClass:"service-card-content"},[a("div",{staticClass:"service-card-title"},[t._v(t._s(e.name))]),t._v(" "),e.data&&e.data.duration?a("div",{staticClass:"service-card-duration"},[t._v(t._s(e.data.duration)+t._s(t.$t("nurse_booking.service_list.min_label")))]):t._e(),t._v(" "),e.coupons&&e.coupons.length?a("div",{staticClass:"service-card-coupons"},[t._v(t._s(e.coupons.length)+" "+t._s(t.$t("nurse_booking.service_list.coupons_label")))]):a("div",{staticClass:"service-card-price"},[t._v("¥ "+t._s(e.price))])])])])}),1):t._e()],1)}var u={data:function data(){return{services:null,category:this.$f7route.query.category}},methods:{onSlideClick:function onSlideClick(e){var t=this.$$(e.target).closest(".swiper-slide").attr("data-url");t&&this.$f7router.navigate(t)},serviceType:function serviceType(e){return e.vendor_package_products?"package":"product"},serviceImage:function serviceImage(e){return e.image_url?e.image_url:this.$addonAssetsUrl+"demo-package.png"}},mounted:function mounted(){var i=this;if(i.$f7route.query.masterDetailRoot){var e=i.$f7.navbar.getElByPage(i.$el);e&&i.$$(e).addClass("navbar-master-detail-root")}var t=i.$root.team?i.$root.team.id:i.$addons.addons.nurse_booking.data.nursing_team_id;Promise.all([$.getServiceList(t),$.getCouponList(t)]).then(function(e){var t=e[0],a=e[1],o=t.filter(function(e){return e.category===i.category||e.category===l[i.category]});o.forEach(function(e){e.coupons=couponsForService(e,a,i.$root.user.id)}),i.services=o})}},g=(I._withStripped=!0,e({render:I,staticRenderFns:[]},void 0,u,void 0,!(I._withStripped=!0),void 0,void 0,void 0));function formatDate(e,t){var a=window.tommy.moment;return a(a.utc(e).toDate()).format(t)}var p=window.tommy;function couponPicker(t,e,a,o){var i,s,n=window.tommy.app.f7,r=t.map(function(e){return Object.assign({},e,{checked:!!o&&e.id===o.id})}),d=('\n  <div class="nurse_booking-coupon-picker">\n    <div class="coupon-picker-img">\n      <img src="'+p.addons.getAssetsUrl("nurse_booking")+'coupon-picker.svg" height="78">\n    </div>\n    <div class="coupon-picker-text">'+p.i18n.t("nurse_booking.coupon_picker.text")+'</div>\n    <div class="coupon-picker-items">\n      '+r.map(function(e){return('\n      <label>\n        <input type="radio" name="nurse_booking-coupon-picker-radio" value="'+e.id+'" '+(e.checked?"checked":"")+'>\n        <div class="coupon-item-content">\n          '+("percentage"!==e.kind?'\n          <div class="coupon-item-title">¥ '+e.amount+"</div>\n          ":'\n          <div class="coupon-item-title">'+100*e.amount+"%</div>\n          ")+'\n          <div class="coupon-item-name">'+e.name+"</div>\n          "+(e.expires_at||e.valid_to?'\n          <div class="coupon-item-date">'+formatDate(e.expires_at||e.valid_to,"D MMM YYYY")+"</div>\n          ":"")+'\n        </div>\n        <div class="coupon-item-label">'+p.i18n.t("nurse_booking.coupon_picker.use_label")+"</div>\n      </label>\n      ").trim()}).join("")+"\n    </div>\n  </div>\n  ").trim(),c=n.dialog.create({content:d,cssClass:"nurse_booking-coupon-picker-modal",buttons:[{text:p.i18n.t("nurse_booking.coupon_picker.skip_button","Skip"),onClick:function onClick(){a&&a()}},{text:p.i18n.t("nurse_booking.coupon_picker.confirm_button","Confirm"),bold:!0,onClick:function onClick(){e&&e(s)}}]}).open().$el;c.find(".dialog-button-bold").addClass("dialog-button-disabled"),c.find("input").on("change",function(e){c.find(".dialog-button-bold").removeClass("dialog-button-disabled"),e.target.checked&&(i=e.target.value,t.forEach(function(e){e.id===parseInt(i,10)&&(s=e)}))})}function S(){var t=this,e=t.$createElement,a=t._self._c||e;return a("f7-page",{attrs:{name:"nurse_booking__service-details",id:"nurse_booking__service-details"}},[a("f7-navbar",[a("tommy-nav-back"),t._v(" "),a("f7-nav-title",[t._v(t._s(t.service.name))])],1),t._v(" "),a("a",{staticClass:"nurse_booking__toolbar-button",attrs:{slot:"fixed"},on:{click:t.book},slot:"fixed"},[t._v(t._s(t.$t("nurse_booking.service_details.book_button")))]),t._v(" "),a("div",{staticClass:"service-details-header"},[a("f7-swiper",[a("div",{staticClass:"swiper-slide",style:"background-image: url("+t.serviceImage(t.service)+")"})])],1),t._v(" "),a("div",{staticClass:"service-details-meta"},[a("div",{staticClass:"service-details-meta-wrap"},[a("div",{staticClass:"service-details-meta-left"},[a("div",{staticClass:"service-details-title"},[t._v(t._s(t.service.name))]),t._v(" "),t.service.data&&t.service.data.duration?a("div",{staticClass:"service-details-duration"},[t._v(t._s(t.service.data.duration)+"min")]):t._e()]),t._v(" "),a("div",{staticClass:"service-details-price"},[t._v("¥ "+t._s(t.service.price))])]),t._v(" "),t.service.coupons&&t.service.coupons.length?a("a",{staticClass:"service-details-coupons-link",on:{click:t.chooseCoupon}},[a("span",[t._v(t._s(t.$t("nurse_booking.service_details.n_coupons_available",{n:t.service.coupons.length})))])]):t._e()]),t._v(" "),a("div",{staticClass:"service-details-content"},[a("div",{staticClass:"service-details-label"},[t._v(t._s(t.$t("nurse_booking.service_details.service_details_label"))+":")]),t._v(" "),a("div",{staticClass:"service-details-text"},[a("p",[t._v("\n        "+t._s(t.service.description)+"\n      ")])]),t._v(" "),t.products?a("div",{staticClass:"service-details-products"},t._l(t.products,function(e){return a("div",{key:e.id,staticClass:"service-details-product"},[a("div",{staticClass:"service-details-product-image",style:"background-image: url("+t.serviceImage(e)+")"}),t._v(" "),a("div",{staticClass:"service-details-product-name"},[t._v(t._s(e.name))])])}),0):t._e()])],1)}function _(){var o=this,e=o.$createElement,i=o._self._c||e;return i("f7-page",{attrs:{name:"nurse_booking__location",id:"nurse_booking__location"}},[i("f7-navbar",[i("tommy-nav-back"),o._v(" "),i("f7-nav-title",[o._v(o._s(o.$t("nurse_booking.location.title")))])],1),o._v(" "),o._l(o.locations,function(t,a){return o.locations&&o.locations.length?i("div",{key:a,staticClass:"location-card"},[i("i",{staticClass:"location-card-icon"}),o._v(" "),i("div",{staticClass:"location-card-title"},[t.default?i("span",{staticClass:"location-card-default-badge"},[o._v("["+o._s(o.$t("nurse_booking.location.default_label"))+"]")]):o._e(),o._v("\n      "+o._s(t.city)+" "+o._s(t.address)+"\n    ")]),o._v(" "),i("a",{staticClass:"location-delete-button",attrs:{href:"#"},on:{click:function(e){return o.deleteLocation(t,a)}}}),o._v(" "),i("a",{staticClass:"location-card-button location-select-button",attrs:{href:"#"},on:{click:function(e){return o.selectLocation(t,a)}}},[o._v(o._s(o.$t("nurse_booking.location.select_button")))])]):o._e()}),o._v(" "),o.addMode||o.locations&&!o.locations.length?i("div",{staticClass:"location-card location-add-form"},[i("input",{attrs:{type:"text",domProps:{defaultValue:o.defaultCity},placeholder:o.$t("nurse_booking.location.city_placeholder")},domProps:{value:o.city},on:{input:function(e){o.city=e.target.value}}}),o._v(" "),i("textarea",{attrs:{type:"text",placeholder:o.$t("nurse_booking.location.address_placeholder")},domProps:{value:o.address||o.defaultAddress},on:{input:function(e){o.address=e.target.value}}}),o._v(" "),i("label",[i("input",{attrs:{type:"checkbox",name:"default"},domProps:{checked:o.isDefault},on:{change:function(e){o.isDefault=e.target.checked}}}),o._v(" "),i("i",{staticClass:"framework7-icons"},[o._v("check")]),o._v(" "),i("span",[o._v(o._s(o.$t("nurse_booking.location.set_default_label")))])]),o._v(" "),i("a",{staticClass:"location-card-button location-save-button",attrs:{href:"#"},on:{click:function(e){return o.saveLocation()}}},[o._v(o._s(o.$t("nurse_booking.location.save_button")))])]):o._e(),o._v(" "),o.locations&&o.locations.length?i("a",{staticClass:"location-add-button",attrs:{href:"#"},on:{click:function(e){return o.addLocation()}}},[o._v(o._s(o.$t("nurse_booking.location.add_button")))]):o._e()],2)}function ia(){var a=this,e=a.$createElement,o=a._self._c||e;return o("f7-page",{attrs:{name:"nurse_booking__date-time",id:"nurse_booking__date-time"}},[o("f7-navbar",[o("tommy-nav-back"),a._v(" "),o("f7-nav-title",[a._v(a._s(a.$t("nurse_booking.date_time.title")))])],1),a._v(" "),o("a",{staticClass:"nurse_booking__toolbar-button",class:{disabled:!a.selectedDate||!a.selectedHours},attrs:{slot:"fixed",href:"#"},on:{click:a.selectDateTime},slot:"fixed"},[a._v(a._s(a.$t("nurse_booking.date_time.determine_button")))]),a._v(" "),o("div",{staticClass:"date-time-dates"},a._l(a.dates,function(t,e){return o("label",{key:e,staticClass:"date-time-date",class:{"date-time-date-disabled":t.disabled}},[o("input",{attrs:{type:"radio",disabled:t.disabled},domProps:{checked:a.selectedDate===t.value},on:{change:function(e){a.selectedDate=t.value}}}),a._v(" "),o("div",{staticClass:"date-time-date-num"},[a._v(a._s(t.day)+"."+a._s(t.month))]),a._v(" "),t.today?o("div",{staticClass:"date-time-date-day"},[a._v("Today")]):o("div",{staticClass:"date-time-date-day"},[a._v(a._s(t.weekDay))])])}),0),a._v(" "),o("div",{staticClass:"date-time-hours"},a._l(a.hours,function(t,e){return o("label",{key:e,staticClass:"date-time-hour",class:{disabled:t.disabled}},[o("input",{attrs:{type:"radio",disabled:t.disabled},domProps:{checked:a.selectedHours===t.value},on:{change:function(e){a.selectedHours=t.value}}}),a._v(" "),o("span",[a._v(a._s(t.hour))])])}),0)],1)}function ra(){var a=this,e=a.$createElement,o=a._self._c||e;return o("f7-page",{attrs:{name:"nurse_booking__nurse-list",id:"nurse_booking__nurse-list"}},[o("f7-navbar",[o("tommy-nav-back"),a._v(" "),o("f7-nav-title",[a._v(a._s(a.$t("nurse_booking.nurse_list.title")))])],1),a._v(" "),a.nurses?o("div",{staticClass:"nurse-list"},[o("ul",a._l(a.nurses,function(t){return o("li",{key:t.id,class:{"nurse-selected":a.selectedNurseId===t.user_id}},[o("a",{staticClass:"nurse-content-wrap",on:{click:function(e){return a.selectNurse(t)}}},[o("div",{staticClass:"nurse-media",style:"background-image: url("+(t.icon_url||"")+")"}),a._v(" "),o("div",{staticClass:"nurse-content"},[o("div",{staticClass:"nurse-name"},[a._v(a._s(t.last_name)+" "+a._s(t.first_name))])])])])}),0)]):a._e()],1)}var f={props:{id:[Number,String]},data:function data(){var a=this,o=a.$f7route.query.type||"product",i={},e=null;return($.cache.services||[]).forEach(function(e){var t=e.vendor_package_products?"package":"product";e.id===parseInt(a.id,10)&&t===o&&((i=e).coupons=couponsForService(i,$.cache.coupons,a.$root.user.id))}),i.vendor_package_products&&i.vendor_package_products.length&&(e=i.vendor_package_products.map(function(t){return($.cache.services||[]).filter(function(e){return e.id===t.vendor_product_id&&!e.vendor_package_products})[0]})),{service:i,selectedCoupon:null,type:o,products:e}},mounted:function mounted(){},methods:{serviceImage:function serviceImage(e){return e.image_url?e.image_url:this.$addonAssetsUrl+"demo-package.png"},book:function book(){var t=this,a=t.service;$.cache.booking.services=[a],$.cache.booking.serviceType=t.type,a.coupons&&a.coupons.length?couponPicker(a.coupons,function(e){t.selectedCoupon=e,$.cache.booking.services=[a],$.cache.booking.coupon=t.selectedCoupon,t.$f7router.navigate("/nurse_booking/order-select-location/")},function(){$.cache.booking.coupon=null,delete $.cache.booking.coupon,t.selectedCoupon=null,t.$f7router.navigate("/nurse_booking/order-select-location/")}):($.cache.booking.coupon=null,delete $.cache.booking.coupon,t.selectedCoupon=null,t.$f7router.navigate("/nurse_booking/order-select-location/"))},chooseCoupon:function chooseCoupon(){var t=this;couponPicker(t.service.coupons,function(e){t.selectedCoupon=e,$.cache.booking.services=[t.service],$.cache.booking.coupon=t.selectedCoupon,t.$f7router.navigate("/nurse_booking/order-select-location/")},function(){t.selectedCoupon=null})}}},b=(S._withStripped=!0,e({render:S,staticRenderFns:[]},void 0,f,void 0,!(S._withStripped=!0),void 0,void 0,void 0)),h={data:function data(){return{service:$.cache.booking.services[0],locations:null,addMode:!1,city:this.$root.user.location||this.$root.user.city||"",address:this.$root.user.address||"",isDefault:!1}},mounted:function mounted(){var e=this;$.getLocations().then(function(){e.locations=[].concat($.cache.locations||[])})},methods:{deleteLocation:function deleteLocation(e,t){var a=this;$.removeLocation(t).then(function(){a.locations.splice(t,1)})},selectLocation:function selectLocation(e){var t=this,a=e.city,o=e.address;0<=a.indexOf("山缘")||0<=o.indexOf("山缘")?($.cache.booking.location=e,t.$f7route.query.back?t.$f7router.back():t.$f7router.navigate("/nurse_booking/order-select-date/")):t.$f7.dialog.alert(t.$t("nurse_booking.location.not_available"))},saveLocation:function saveLocation(){var e=this,t=e.city,a=e.address,o=e.isDefault;t&&a&&$.addLocation({city:t,address:a,default:o}).then(function(){e.locations=[].concat($.cache.locations||[]),e.addMode=!1,e.city="",e.address="",e.isDefault=!1})},addLocation:function addLocation(){this.addMode=!0}}},k=(_._withStripped=!0,e({render:_,staticRenderFns:[]},void 0,h,void 0,!(_._withStripped=!0),void 0,void 0,void 0)),C={data:function data(){for(var e,t=new Date,a=t.getTime(),o=[],i=0;i<=13;i+=1){var s=new Date(a+24*i*60*60*1e3),n=s.getMonth()+1,r=s.getDate();r<10&&(r="0"+r),n<10&&(n="0"+n);var d=s.getDay(),c=0===i&&19<=t.getHours();c&&(e=!0),o.push({disabled:c,value:new Date(s.getFullYear(),s.getMonth(),s.getDate()).getTime(),day:r,month:n,weekDay:this.$t("nurse_booking.date_time.week_days."+d)})}var l,u,v=this.$f7route.query.date&&new Date(parseInt(this.$f7route.query.date,10));return v&&(l=new Date(v.getFullYear(),v.getMonth(),v.getDate()).getTime(),u=v.getHours()),{dates:o,selectedDate:l||(e?o[1].value:o[0].value),selectedHours:u||null}},watch:{selectedDate:function selectedDate(){this.selectedHours=null}},computed:{hours:function hours(){var e,t=new Date(this.selectedDate),hours=[],a=new Date;a.getFullYear()===t.getFullYear()&&a.getMonth()===t.getMonth()&&a.getDate()===t.getDate()&&(e=!0);for(var o=10;o<=19;o+=1){var i=!!e&&a.getHours()>=o;hours.push({value:o,disabled:i,hour:o+":00"})}return hours}},methods:{selectDateTime:function selectDateTime(){var e=this,t=e.selectedDate,a=e.selectedHours;$.cache.booking.date=new Date(parseInt(t,10)).getTime()+60*a*60*1e3,e.$f7route.query.back?e.$f7router.back():e.$f7router.navigate("/nurse_booking/order-select-nurse/")}}},y=(ia._withStripped=!0,e({render:ia,staticRenderFns:[]},void 0,C,void 0,!(ia._withStripped=!0),void 0,void 0,void 0)),w={data:function data(){return{nurses:null,selectedNurseId:this.$f7route.query.nurse_id?parseInt(this.$f7route.query.nurse_id,10):void 0}},mounted:function mounted(){var t=this,e=t.$root.team?t.$root.team.id:t.$addons.addons.nurse_booking.data.nursing_team_id,a=$.cache.booking.date,o=a+36e5;if($.cache.booking.services&&$.cache.booking.services.length){var i=0;$.cache.booking.services.forEach(function(e){e.data&&e.data.duration&&(i+=parseInt(e.data.duration,10))}),i&&(o=a+6e4*i)}$.getNurseList(e,new Date(a),new Date(o)).then(function(e){t.$root.teamMembers&&e.length===t.$root.teamMembers.length?t.nurses=t.$root.teamMembers.filter(function(e){return 0<=e.tags.indexOf("Available For Work")}):t.nurses=e})},methods:{selectNurse:function selectNurse(e){this.selectedNurseId=e.user_id,$.cache.booking.nurse=e,this.$f7route.query.back?this.$f7router.back():this.$f7router.navigate("/nurse_booking/order-confirm/")}}},D=(ra._withStripped=!0,e({render:ra,staticRenderFns:[]},void 0,w,void 0,!(ra._withStripped=!0),void 0,void 0,void 0)),O=!1;function payOrder(e,t){if(void 0===t&&(t=!0),!O){var o,i;O=!0;var s=window.tommy,n=s.app.f7,r=e.teamId,d=e.productName,c=e.total,a=e.discount;void 0===a&&(a=0);var l,u=e.location,v=e.date,_=e.couponId,g=e.orderId,p=e.nurse,m=e.vendor_order_items_attributes,f=e.duration,b="/nurse_booking/order-success/",h="/nurse_booking/order-error/",k={vendor_order_items_attributes:m,vendor_coupon_id:_||null,name:d,status:"pending",comment:"",assignee_id:p.user_id,assignee_team_id:r,data:{location:u,date:v,nurse:p,duration:f},discount:a,total:c},C=k.data.date;"string"==typeof C&&(C=parseInt(C,10)),l=k.data.duration&&0<k.data.duration?C+60*parseInt(k.data.duration,10)*1e3:C+36e5,k.event_attributes={addon:"nurse_booking",title:k.name,start_at:new Date(C).toJSON(),end_at:new Date(l).toJSON(),location:k.data.location.city+" "+k.data.location.address,user_id:k.user_id,team_id:null,assignee_id:k.data.nurse.user_id,assignee_team_id:r,kind:"Booking",resource_id:k.id,resource_type:"VendorOrder"},t?$.sendOrder(r,k).then(pay).catch(function(){O=!1}):pay(Object.assign({},{id:g},k))}function pay(a){if(0===c)return $.cache.booking.transaction={},a.status="paid",void $.updateOrder(r,a).then(function(){O=!1,n.views.main.router.navigate(b+"?id="+a.id)}).catch(function(){O=!1});s.initWalletTransaction({addon:"nurse_booking",payee_name:d,currency:"CNY",amount:c,order_id:a.id},function(e,t){void 0===t&&(t={}),o=!(O=!1),i||($.cache.booking.transaction=e,a.status="paid",a.wallet_transaction_id=e.id,a.payment_method=t.paymentMethod||"card",a.data.payment_method=t.paymentMethod||"card",$.updateOrder(r,a).then(function(){n.views.main.router.navigate(b+"?id="+a.id)}).catch(function(){O=!1}))},function(e,t){void 0===t&&(t={}),i=!(O=!1),o||$.cancelOrder(r,a.id).then(function(){n.views.main.router.navigate(h+"?id="+a.id)}).catch(function(){n.views.main.router.navigate(h+"?id="+a.id)})})}}function Ba(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{attrs:{name:"nurse_booking__order-confirm",id:"nurse_booking__order-confirm"},on:{"page:beforein":e.onPageBeforeIn}},[a("f7-navbar",[a("tommy-nav-back"),e._v(" "),a("f7-nav-title",[e._v(e._s(e.$t("nurse_booking.order_confirm.title")))])],1),e._v(" "),a("a",{staticClass:"nurse_booking__toolbar-button service-book-button",attrs:{slot:"fixed",href:"#"},on:{click:e.payOrder},slot:"fixed"},[e._v(e._s(e.$t("nurse_booking.order_confirm.pay_button")))]),e._v(" "),a("div",{staticClass:"service-details-block"},[a("div",{staticClass:"service-image",style:"background-image: url("+e.serviceImage+")"}),e._v(" "),a("div",{staticClass:"service-details"},[a("div",{staticClass:"service-title"},[e._v(e._s(e.serviceName))]),e._v(" "),a("div",{staticClass:"service-price"},[e._v("¥"+e._s(e.servicePrice))])])]),e._v(" "),a("f7-list",{attrs:{"no-hairlines":""}},[e.nurse?a("f7-list-item",{attrs:{title:e.nurse.last_name+" "+e.nurse.first_name,link:"/nurse_booking/order-select-nurse/?nurse_id="+e.nurse.id+"&back=true"}},[a("img",{attrs:{slot:"media",src:e.$addonAssetsUrl+"icon-nurse.svg"},slot:"media"})]):e._e(),e._v(" "),a("f7-list-item",{attrs:{title:e.formatDate(e.date,"MMMM D, YYYY HH:mm"),link:"/nurse_booking/order-select-date/?date="+new Date(e.date).getTime()+"&back=true"}},[a("img",{attrs:{slot:"media",src:e.$addonAssetsUrl+"icon-time.svg"},slot:"media"})])],1),e._v(" "),a("f7-list",{attrs:{"no-hairlines":""}},[a("f7-list-item",{attrs:{title:e.user.first_name+" "+e.user.last_name}},[a("img",{attrs:{slot:"media",src:e.$addonAssetsUrl+"icon-user.svg"},slot:"media"})]),e._v(" "),e.user.mobile?a("f7-list-item",{attrs:{title:e.user.mobile}},[a("img",{attrs:{slot:"media",src:e.$addonAssetsUrl+"icon-phone.svg"},slot:"media"})]):e._e(),e._v(" "),a("f7-list-item",{attrs:{link:"/nurse_booking/order-select-location/?back=true"}},[a("span",{staticClass:"location-default-badge",attrs:{slot:"title"},slot:"title"},[e._v("["+e._s(e.$t("nurse_booking.location.default_label"))+"]")]),e._v(" "),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.location.city)+" "+e._s(e.location.address))]),e._v(" "),a("img",{attrs:{slot:"media",src:e.$addonAssetsUrl+"icon-location.svg"},slot:"media"})])],1),e._v(" "),a("f7-list",{staticClass:"list-prices",attrs:{"no-hairlines":""}},[e.coupon?a("f7-list-item",{attrs:{link:"#",title:e.$t("nurse_booking.order_confirm.coupons_label"),after:"percentage"!==e.coupon.kind?"-¥"+e.couponDiscount:"-"+100*e.coupon.amount+"%"},on:{click:e.selectCoupon}}):e._e(),e._v(" "),a("f7-list-item",{staticClass:"item-total-price",attrs:{title:e.$t("nurse_booking.order_confirm.total_label"),after:"¥"+e.total}})],1)],1)}function Ka(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{attrs:{name:"nurse_booking__order-details",id:"nurse_booking__order-details"}},[a("f7-navbar",[e.$f7route.query.backToHome?a("tommy-nav-back",{attrs:{href:"/nurse_booking/",force:""}}):a("tommy-nav-back"),e._v(" "),a("f7-nav-title",[e._v(e._s(e.$t("nurse_booking.order_details.title")))])],1),e._v(" "),e.status?[e.status.canceled?a("div",{staticClass:"order-details-status"},[a("div",{staticClass:"order-details-status-title"},[e._v(e._s(e.$t("nurse_booking.order_details.status_canceled")))]),e._v(" "),a("div",{staticClass:"order-details-status-date"},[e._v(e._s(e.formatDate(e.date,"D MMM. YYYY")))]),e._v(" "),a("img",{attrs:{src:e.$addonAssetsUrl+"icon-status-canceled.svg"}})]):e._e(),e._v(" "),e.status.pending?a("div",{staticClass:"order-details-status"},[a("div",{staticClass:"order-details-status-title"},[e._v(e._s(e.$t("nurse_booking.order_details.status_pending")))]),e._v(" "),a("div",{staticClass:"order-details-status-date"},[e._v(e._s(e.formatDate(e.date,"D MMM. YYYY")))]),e._v(" "),a("img",{attrs:{src:e.$addonAssetsUrl+"icon-status-pending.svg"}})]):e._e(),e._v(" "),e.status.progress?a("div",{staticClass:"order-details-status"},[a("div",{staticClass:"order-details-status-title"},[e._v(e._s(e.$t("nurse_booking.order_details.status_progress")))]),e._v(" "),a("div",{staticClass:"order-details-status-date"},[e._v(e._s(e.formatDate(e.date,"D MMM. YYYY")))]),e._v(" "),a("img",{attrs:{src:e.$addonAssetsUrl+"icon-status-progress.svg"}})]):e._e(),e._v(" "),e.status.complete?a("div",{staticClass:"order-details-status"},[a("div",{staticClass:"order-details-status-title"},[e._v(e._s(e.$t("nurse_booking.order_details.status_complete")))]),e._v(" "),a("div",{staticClass:"order-details-status-date"},[e._v(e._s(e.formatDate(e.date,"D MMM. YYYY")))]),e._v(" "),a("img",{attrs:{src:e.$addonAssetsUrl+"icon-status-complete.svg"}})]):e._e()]:e._e(),e._v(" "),e.services?a("f7-list",{staticClass:"order-details-list",attrs:{"no-hairlines":""}},[e.nurse?a("f7-list-item",{attrs:{title:e.nurse.first_name+" "+e.nurse.last_name}},[a("span",{staticClass:"order-details-list-nurse-avatar",style:"background-image: url("+(e.nurse.icon_url||"")+")",attrs:{slot:"media"},slot:"media"})]):e._e(),e._v(" "),a("f7-list-item",{attrs:{title:e.$t("nurse_booking.order_details.service_label")+":",after:e.serviceName}}),e._v(" "),a("f7-list-item",{attrs:{title:e.$t("nurse_booking.order_details.time_label")+":",after:e.formatDate(e.date,"MMMM D, YYYY HH:mm")}}),e._v(" "),e.coupon?a("li",{staticClass:"item-content"},[a("div",{staticClass:"item-inner"},[a("div",{staticClass:"item-title"},[e._v(e._s(e.$t("nurse_booking.order_details.coupons_label"))+":")]),e._v(" "),a("div",{staticClass:"item-after price"},[e._v("-¥"+e._s(e.coupon.amount))])])]):e._e(),e._v(" "),a("li",{staticClass:"item-content item-total-price"},[a("div",{staticClass:"item-inner"},[a("div",{staticClass:"item-title"},[e._v(e._s(e.$t("nurse_booking.order_details.total_label"))+":")]),e._v(" "),a("div",{staticClass:"item-after price"},[e._v("¥"+e._s(e.total))])])]),e._v(" "),a("f7-list-item",{staticClass:"item-total-price",attrs:{title:e.$t("nurse_booking.order_details.payment_label")+":",after:e.transaction&&e.transaction.card_name?e.transaction.card_name:null}}),e._v(" "),e.status?[e.status.progress?a("a",{staticClass:"order-details-white-button",attrs:{href:"#"},on:{click:e.cancelOrder}},[e._v(e._s(e.$t("nurse_booking.order_details.cancel_button")))]):e._e(),e._v(" "),e.status.pending?a("a",{staticClass:"order-details-red-button",attrs:{href:"#"},on:{click:e.payOrder}},[e._v(e._s(e.$t("nurse_booking.order_details.pay_button")))]):e._e(),e._v(" "),e.status.complete||e.status.canceled?a("a",{staticClass:"order-details-red-button",attrs:{href:"#"},on:{click:e.repeatOrder}},[e._v(e._s(e.$t("nurse_booking.order_details.repeat_button")))]):e._e()]:e._e()],2):e._e()],2)}function Ta(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{attrs:{name:"nurse_booking__order-canceled",id:"nurse_booking__order-canceled","no-navbar":""}},[a("div",{staticClass:"order-status-title"},[e._v(e._s(e.$t("nurse_booking.order_canceled.title")))]),e._v(" "),a("div",{staticClass:"order-status-img"},[a("img",{attrs:{src:e.$addonAssetsUrl+"order-canceled.svg"}})]),e._v(" "),a("div",{staticClass:"order-status-message"},[e._v(e._s(e.$t("nurse_booking.order_canceled.message")))]),e._v(" "),a("div",{staticClass:"order-status-buttons no-master-detail"},[a("a",{attrs:{href:"/nurse_booking/","data-clear-previous-history":"true"}},[e._v(e._s(e.$t("nurse_booking.order_canceled.home_button")))])])])}function ab(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{attrs:{name:"nurse_booking__order-error",id:"nurse_booking__order-error","no-navbar":""}},[a("div",{staticClass:"order-status-title"},[e._v(e._s(e.$t("nurse_booking.order_error.title")))]),e._v(" "),a("div",{staticClass:"order-status-img"},[a("img",{attrs:{src:e.$addonAssetsUrl+"order-success.svg"}})]),e._v(" "),a("div",{staticClass:"order-status-buttons"},[a("a",{attrs:{href:"/nurse_booking/order-details/?backToHome=true&id="+e.$f7route.query.id+"&masterDetailRoot=true"}},[e._v(e._s(e.$t("nurse_booking.order_error.details_button")))]),e._v(" "),a("a",{staticClass:"no-master-detail",attrs:{href:"/nurse_booking/","data-clear-previous-history":"true"}},[e._v(e._s(e.$t("nurse_booking.order_error.home_button")))])])])}function jb(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{attrs:{name:"nurse_booking__order-success",id:"nurse_booking__order-success","no-navbar":""},on:{"page:afterin":e.onPageAfterIn}},[a("div",{staticClass:"order-status-title"},[e._v(e._s(e.$t("nurse_booking.order_success.title")))]),e._v(" "),a("div",{staticClass:"order-status-img"},[a("img",{attrs:{src:e.$addonAssetsUrl+"order-success.svg"}})]),e._v(" "),a("div",{staticClass:"order-status-buttons"},[a("a",{attrs:{href:"/nurse_booking/order-details/?backToHome=true&id="+e.$f7route.query.id+"&masterDetailRoot=true"}},[e._v(e._s(e.$t("nurse_booking.order_success.details_button")))]),e._v(" "),a("a",{staticClass:"no-master-detail",attrs:{href:"/nurse_booking/","data-clear-previous-history":"true"}},[e._v(e._s(e.$t("nurse_booking.order_success.home_button")))])])])}function sb(){var a=this,e=a.$createElement,o=a._self._c||e;return o("f7-page",{attrs:{name:"nurse_booking__history",id:"nurse_booking__history"}},[o("f7-navbar",[o("tommy-nav-back"),a._v(" "),o("f7-nav-title",[a._v(a._s(a.$t("nurse_booking.history.title")))])],1),a._v(" "),a.ordersSorted?o("div",{staticClass:"orders-list"},a._l(a.ordersSorted,function(e,t){return o("a",{key:t,staticClass:"order-item",attrs:{href:"/nurse_booking/order-details/?id="+e.id}},[o("div",{staticClass:"order-item-header"},[e.data?o("div",{staticClass:"order-item-date"},[a._v(a._s(a.formatDate(e.data.date,"D MMM YYYY")))]):a._e(),a._v(" "),o("div",{staticClass:"order-item-status"},[a._v(a._s(a.$t(e.statusKey)))])]),a._v(" "),o("div",{staticClass:"order-item-content"},[o("div",{staticClass:"order-item-details"},[o("div",{staticClass:"order-item-details-row"},[a._v(a._s(e.name))]),a._v(" "),e.data?o("div",{staticClass:"order-item-details-row order-item-details-date"},[a._v(a._s(a.formatDate(e.data.date,"MMM D, YYYY H:mm")))]):a._e()]),a._v(" "),o("div",{staticClass:"order-item-amount"},[a._v("¥"+a._s(e.total))])])])}),0):a._e()],1)}var E={data:function data(){return{services:$.cache.booking.services,coupon:$.cache.booking.coupon,user:this.$root.user,location:$.cache.booking.location,date:$.cache.booking.date,nurse:$.cache.booking.nurse}},computed:{couponDiscount:function couponDiscount(){var e=this.coupon,t=0;return e&&(t="percentage"!==e.kind?e.amount:e.amount*this.servicePrice),t>this.servicePrice&&(t=this.servicePrice),t},total:function total(){return Math.max(this.servicePrice-this.couponDiscount,0)},servicePrice:function servicePrice(){var e=this.services,t=0;return e.forEach(function(e){t+=e.price}),t},serviceImage:function serviceImage(){var e=this.services[0];return e.image_url?e.image_url:this.$addonAssetsUrl+"demo-package.png"},serviceName:function serviceName(){return this.services.map(function(e){return e.name}).join(", ")}},methods:{formatDate:formatDate,selectCoupon:function selectCoupon(){var t=this;couponPicker(t.services[0].coupons,function(e){$.cache.booking.coupon=e,t.coupon=e},function(){},t.coupon)},onPageBeforeIn:function onPageBeforeIn(e,t){"previous"===t.from&&(this.location=$.cache.booking.location,this.date=$.cache.booking.date,this.nurse=$.cache.booking.nurse)},payOrder:function payOrder$1(){var e=this,t=e.services,a=e.coupon,o=e.location,i=e.date,s=e.total,n=e.nurse,r=e.services.map(function(e){return{orderable_id:e.id,orderable_type:e.vendor_package_products?"VendorPackage":"VendorProduct",quantity:e.quantity||1}}),d=e.$root.team?e.$root.team.id:e.$addons.addons.nurse_booking.data.nursing_team_id,c=0;t.forEach(function(e){e.data&&e.data.duration&&(c+=parseInt(e.data.duration,10))}),c=c||60;var l=0;a&&(l=e.couponDiscount),payOrder({vendor_order_items_attributes:r,teamId:d,productName:t.map(function(e){return e.name}).join(", "),productId:t[0].id,total:s,couponId:a?a.id:null,discount:l,location:o,date:i,nurse:n,duration:c})}}},P=(Ba._withStripped=!0,e({render:Ba,staticRenderFns:[]},void 0,E,void 0,!(Ba._withStripped=!0),void 0,void 0,void 0)),B={data:function data(){var e=$.cache.booking,t=e.transaction,a=e.services,o=e.coupon,i=e.location,s=e.date,n=e.nurse,data={teamId:this.$root.team?this.$root.team.id:this.$addons.addons.nurse_booking.data.nursing_team_id,transaction:null,services:null,coupon:null,location:null,date:null,order:null,status:null,total:null,preventCancel:!1,nurse:null};return this.$f7route.query.id||Object.assign(data,{transaction:t,services:a,coupon:o,location:i,date:s,nurse:n}),data},computed:{totalComputed:function totalComputed(){var e=this.services,t=this.coupon,a=this.total,o=0;e.forEach(function(e){o+=e.price});var i=0;return t&&(i="percentage"!==t.kind?t.amount:t.amount*o),a||Math.max(o-i,0)},serviceName:function serviceName(){return this.services.map(function(e){return e.name}).join(", ")}},mounted:function mounted(){var a=this;if(a.$f7route.query.masterDetailRoot){var e=a.$f7.navbar.getElByPage(a.$el);e&&a.$$(e).addClass("navbar-master-detail-root")}a.$f7route.query.id&&$.getOrderDetails(a.teamId,a.$f7route.query.id).then(function(e){var t=(a.order=e).canceled;a.status={pending:!t&&"pending"===e.status,canceled:t,progress:!t&&("paid"===e.status||"processing"===e.status),complete:!t&&"complete"===e.status},a.date=parseInt(e.data.date,10),a.nurse=e.data.nurse,a.transaction={card_name:e.wallet_transaction?e.wallet_transaction.card_name:null},a.total=e.total,e.vendor_coupon_id&&(a.coupon={id:e.vendor_coupon_id,kind:"fixed",amount:e.discount}),Promise.all(e.vendor_order_items.map(function(t){return $.getServiceDetails(a.teamId,t.orderable_id,t.orderable_type).then(function(e){return e.quantity=t.quantity,Promise.resolve(e)})})).then(function(e){a.services=e})})},methods:{formatDate:formatDate,repeatOrder:function repeatOrder(){var e=this.order,t=this.services;e&&($.cache.booking.date=parseInt(e.data.date,10),$.cache.booking.location=e.data.location,$.cache.booking.nurse=e.data.nurse,$.cache.booking.vendor_order_items_attributes=e.vendor_order_items.map(function(e){return{vendor_product_id:e.vendor_product_id,orderable_id:e.vendor_product_id,orderable_type:e.vendor_package_products?"VendorPackage":"VendorProduct",quantity:e.quantity}}),delete $.cache.booking.coupon,$.cache.booking.services=t,this.$f7router.navigate("/nurse_booking/order-confirm/"))},cancelOrder:function cancelOrder(){var e=this,t=e.order;t&&(e.preventCancel||(e.preventCancel=!0,e.$f7.dialog.confirm('\n        <div class="order-details-cancel-order-icon"></div>\n        <div>'+e.$t("nurse_booking.order_details.cancel_confirm")+"</div>\n        ",function(){$.cancelOrder(e.teamId,t.id,t.wallet_transaction_id,t).then(function(){e.preventCancel=!1,e.$f7router.navigate("/nurse_booking/order-canceled/")}).catch(function(){e.preventCancel=!1})},function(){e.preventCancel=!1})))},payOrder:function payOrder$1(){var e=this.order;payOrder({teamId:this.teamId,vendor_order_items_attributes:(e.vendor_order_items||[]).map(function(e){return{orderable_id:e.vendor_product_id,orderable_type:e.vendor_package_products?"VendorPackage":"VendorProduct",quantity:e.quantity}}),orderId:e.id,productName:e.name,productId:e.vendor_product_id||e.vendor_order_items[0],total:e.total,couponId:e.vendor_coupon_id,discount:e.discount,location:e.data.location,date:e.data.date,nurse:e.data.nurse,duration:e.data.duration},!1)}}},T=(Ka._withStripped=!0,e({render:Ka,staticRenderFns:[]},void 0,B,void 0,!(Ka._withStripped=!0),void 0,void 0,void 0)),M={mounted:function mounted(){document.addEventListener("backbutton",this.onBackButton)},beforeDestroy:function beforeDestroy(){document.removeEventListener("backbutton",this.onBackButton)},methods:{onBackButton:function onBackButton(){this.$f7router.back("/nurse_booking/",{force:!0})},onPageAfterIn:function onPageAfterIn(){var e=this;setTimeout(function(){e.$f7router.clearPreviousHistory()},500)}}},x=(Ta._withStripped=!0,e({render:Ta,staticRenderFns:[]},void 0,M,void 0,!(Ta._withStripped=!0),void 0,void 0,void 0)),A={mounted:function mounted(){document.addEventListener("backbutton",this.onBackButton)},beforeDestroy:function beforeDestroy(){document.removeEventListener("backbutton",this.onBackButton)},methods:{onBackButton:function onBackButton(){this.$f7router.back("/nurse_booking/",{force:!0})},onPageAfterIn:function onPageAfterIn(){var e=this;setTimeout(function(){e.$f7router.clearPreviousHistory()},500)}}},L=(ab._withStripped=!0,e({render:ab,staticRenderFns:[]},void 0,A,void 0,!(ab._withStripped=!0),void 0,void 0,void 0)),N={mounted:function mounted(){document.addEventListener("backbutton",this.onBackButton)},beforeDestroy:function beforeDestroy(){document.removeEventListener("backbutton",this.onBackButton)},methods:{onBackButton:function onBackButton(){this.$f7router.back("/nurse_booking/",{force:!0})},onPageAfterIn:function onPageAfterIn(){var e=this;setTimeout(function(){e.$f7router.clearPreviousHistory()},500)}}},Y=(jb._withStripped=!0,e({render:jb,staticRenderFns:[]},void 0,N,void 0,!(jb._withStripped=!0),void 0,void 0,void 0)),U={data:function data(){return{orders:null}},computed:{ordersSorted:function ordersSorted(){return this.orders?this.orders.sort(function(e,t){return t.id>e.id?1:t.id<e.id?-1:0}):null}},mounted:function mounted(){var t=this;if(t.$f7route.query.masterDetailRoot){var e=t.$f7.navbar.getElByPage(t.$el);e&&t.$$(e).addClass("navbar-master-detail-root")}var a=t.$root.team?t.$root.team.id:t.$addons.addons.nurse_booking.data.nursing_team_id;$.getOrdersHistory(a).then(function(e){e.forEach(function(e){e.statusKey="nurse_booking.history.status_"+(e.canceled?"canceled":e.status),e.data&&e.data.date&&(Number.isNaN(parseInt(e.data.date,10))||(e.data.date=parseInt(e.data.date,10)))}),t.orders=e})},methods:{formatDate:formatDate}};sb._withStripped=!0;return[{path:"/nurse_booking/",component:a,master:!0},{path:"/nurse_booking/vip/",component:i},{path:"/nurse_booking/vip-details/",component:n},{path:"/nurse_booking/service-list/",component:g},{path:"/nurse_booking/service-details/:id/",component:b},{path:"/nurse_booking/order-select-location/",component:k},{path:"/nurse_booking/order-select-date/",component:y},{path:"/nurse_booking/order-select-nurse/",component:D},{path:"/nurse_booking/order-confirm/",component:P},{path:"/nurse_booking/order-details/",component:T},{path:"/nurse_booking/order-canceled/",component:x},{path:"/nurse_booking/order-error/",component:L},{path:"/nurse_booking/order-success/",component:Y},{path:"/nurse_booking/history/",component:e({render:sb,staticRenderFns:[]},void 0,U,void 0,!(sb._withStripped=!0),void 0,void 0,void 0)}]}();