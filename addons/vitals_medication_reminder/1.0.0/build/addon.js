var addon=function(){var r=window.tommy.api,a=function takeMedication(t,e,a,n){var i=(new Date).toJSON(),s={addon:"vitals_medication_reminder",kind:"VitalsMedicationReminderTaken",with_filters:!0,start_at:i,tags:[{context:"members",name:t.first_name+" "+t.last_name,user_id:t.id}],filters:[{context:"members",name:t.first_name+" "+t.last_name,user_id:t.id}],data:JSON.stringify({medication_id:e,taken:n,time:a,date:i})};return r.createFragment(s)},i=function getTaken(t,e){void 0===e&&(e={});var a,n=e.dateFrom,i=e.dateTo;return n&&i&&(a=[new Date(n).toJSON(),new Date(i).toJSON()]),r.getFragments({addon:"vitals_medication_reminder",kind:"VitalsMedicationReminderTaken",with_filters:!0,with_permission_to:!0,user_id:t.id,date_range:a},{cache:!1})},t=function getMedication(t,e){return r.getFragment(e,{addon:"vitals_medication_reminder",kind:"VitalsMedicationReminderMedication",with_filters:!0,with_permission_to:!0,user_id:t.id},{cache:!1})},s=function getMedications(t){return r.getFragments({addon:"vitals_medication_reminder",kind:"VitalsMedicationReminderMedication",with_filters:!0,with_permission_to:!0,user_id:t.id},{cache:!1})},o=function addMedication(t,e){var a={addon:"vitals_medication_reminder",kind:"VitalsMedicationReminderMedication",with_filters:!0,start_at:new Date(e.startDate).toJSON(),end_at:new Date(e.endDate).toJSON(),tags:[{context:"members",name:t.first_name+" "+t.last_name,user_id:t.id}],filters:[{context:"members",name:t.first_name+" "+t.last_name,user_id:t.id}],data:JSON.stringify(e)};return r.createFragment(a)},d=function updateMedication(t,e,a){var n={addon:"vitals_medication_reminder",kind:"VitalsMedicationReminderMedication",with_filters:!0,start_at:new Date(a.startDate).toJSON(),tags:[{context:"members",name:t.first_name+" "+t.last_name,user_id:t.id}],filters:[{context:"members",name:t.first_name+" "+t.last_name,user_id:t.id}],data:JSON.stringify(a)};return r.updateFragment(e,n)},e=function deleteMedication(t,e){return r.deleteFragment(e)},n=function getSettings(t){return r.call({endpoint:"addons/"+t+"/install/settings/addonSettings",method:"GET",cache:!1}).then(function(t){return t?t.data?t.data:null:t})},c=function saveSettings(t,e){return void 0===e&&(e={}),r.call({endpoint:"addons/"+t+"/install/settings/addonSettings",method:"PUT",data:{data:JSON.stringify(e)}})},l={render:function(){var a=this,t=a.$createElement,n=a._self._c||t;return n("f7-page",{class:"vitals-elment-index-page vitals-"+a.vitalsElement+"-index-page",attrs:{id:"vitals_element__index"},on:{"page:beforein":a.onPageBeforeIn,"page:beforeout":a.onPageBeforeOut},nativeOn:{"!scroll":function(t){return a.onPageScroll(t)}}},[n("f7-navbar",[n("tommy-nav-menu"),a._v(" "),n("f7-nav-title",[a._v(a._s(a.t("title")))]),a._v(" "),n("f7-nav-right",[n("f7-link",{attrs:{href:"/"+a.addon+"/settings/","icon-only":""}},[n("i",{class:"icon vitals-element-icon-settings vitals-"+a.vitalsElement+"-icon-settings"})]),a._v(" "),n("f7-link",{attrs:{href:"/"+a.addon+"/history/","icon-only":"","route-props":{goalValue:a.settings?a.settings.goal_value:0}}},[n("i",{class:"icon vitals-element-icon-chart vitals-"+a.vitalsElement+"-icon-chart"})])],1)],1),a._v(" "),n("f7-fab",{class:"vitals-element-fab vitals-"+a.vitalsElement+"-fab",attrs:{href:"/"+a.addon+"/plan/"}},[n("f7-icon",{attrs:{f7:"add"}})],1),a._v(" "),n("div",{class:"vitals-element-index-header vitals-"+a.vitalsElement+"-index-header"},[n("div",{staticClass:"vitals-medicaton_reminder-header-date"},[n("span",{staticClass:"month"},[a._v(a._s(a.$moment().format("MMMM")))]),a._v(" "),n("span",{staticClass:"day"},[a._v(a._s(a.$moment().format("D")))])])]),a._v(" "),a.data&&!a.todayData?n("div",{class:"vitals-element-index-no-data vitals-"+a.vitalsElement+"-index-no-data"},[n("i",{class:"vitals-element-index-no-data-img vitals-"+a.vitalsElement+"-index-no-data-img"}),a._v(" "),n("span",[a._v(a._s(a.t("not_available")))])]):a._e(),a._v(" "),a.data&&a.todayData?n("div",{staticClass:"medication-index-cards"},a._l(a.todayData,function(t,e){return n("div",{key:e,staticClass:"medication-index-card"},[n("div",{staticClass:"medication-index-card-icon",class:{taken:a.isTaken(t),"not-taken":a.isNotTaken(t),"need-to-take":a.isNeedToTake(t)}}),a._v(" "),n("div",{staticClass:"medication-index-card-content"},[n("div",{staticClass:"medication-index-card-name"},[a._v(a._s(t.name))]),a._v(" "),n("div",{staticClass:"medication-index-card-dosage"},[a._v(a._s(t.value)+" "+a._s(a.t("dosage_unit."+t.unit)))])]),a._v(" "),n("div",{staticClass:"medication-index-card-time"},[a._v(a._s(t.time))])])})):a._e()],1)},staticRenderFns:[],props:{addon:String,vitalsElement:String},data:function data(){return{data:null,takenData:null}},mounted:function mounted(){var t=this;t.getData(),t.$events.$on(t.addon+":updateRecords",t.getData)},beforeDestroy:function beforeDestroy(){var t=this;t.$events.$off(t.addon+":updateRecords",t.getData)},computed:{todayData:function todayData(){if(!this.data)return null;var n=(new Date).getTime(),todayData=[];return this.data.forEach(function(e){if(e.data.reminder){var t=new Date(e.data.startDate).getTime(),a=new Date(e.data.endDate).getTime();t<=n&&n<=a&&e.data.dosage.forEach(function(t){todayData.push({id:e.id,name:e.data.name,time:t.time,unit:t.unit,value:t.value})})}}),todayData.sort(function(t,e){return 60*parseInt(t.time.split(":")[0],10)+parseInt(t.time.split(":")[1],10)<60*parseInt(e.time.split(":")[0],10)+parseInt(e.time.split(":")[1],10)?-1:1}),todayData.length?todayData:null}},methods:{t:function t(e,a){return this.$t(this.addon+".index."+e,a)},getData:function getData(){var n=this,t=new Date;function getData(){return new Promise(function(e,a){s(n.$root.user).then(function(t){e(t)}).catch(function(t){a(t)})})}t.setHours(0,0,0,0),Promise.all([getData(),function getTaken(){return new Promise(function(e,a){i(n.$root.user,{dateFrom:t,dateTo:new Date(t.getTime()+864e5)}).then(function(t){e(t)}).catch(function(t){a(t)})})}()]).then(function(t){var e=t[0],a=t[1];n.takenData=a,n.data=e,n.checkReminders()}).catch(function(t){console.log(t)})},isNeedToTake:function isNeedToTake(t){if(!this.todayData)return!1;if(this.isTaken(t)||this.isNotTaken(t))return!1;var e,a=t.time.split(":").map(function(t){return parseInt(t,10)}),n=new Date,i=n.getHours(),s=n.getMinutes();return i>a[0]?e=!0:i===a[0]&&s>=a[1]&&(e=!0),e},isTaken:function isTaken(a){var n;if(!this.takenData)return!1;var i=new Date;return i.setHours(0,0,0,0),this.takenData.forEach(function(t){if(!n){var e=new Date(t.data.date||t.start_at);e.setHours(0,0,0,0),a.id===t.data.medication_id&&a.time===t.data.time&&i.getTime()===e.getTime()&&t.data.taken&&(n=!0)}}),n},isNotTaken:function isNotTaken(a){var n;if(!this.takenData)return!1;var i=new Date;return i.setHours(0,0,0,0),this.takenData.forEach(function(t){if(!n){var e=new Date(t.data.date||t.start_at);e.setHours(0,0,0,0),a.id!==t.data.medication_id||a.time!==t.data.time||i.getTime()!==e.getTime()||t.data.taken||(n=!0)}}),n},checkReminders:function checkReminders(){var e=this;e.todayData&&e.todayData.forEach(function(t){e.isNeedToTake(t)&&e.$f7.dialog.create({text:'\n            <div class="text-align-center">\n              <img src="'+e.$addonAssetsUrl+'remind.svg" height="80"/>\n            </div>\n            <p class="text-align-center">'+e.$t("vitals_medication_reminder.medication_time.text")+" "+t.name+"</p>\n          ",buttons:[{text:e.$t("vitals_medication_reminder.medication_time.snooze_button"),onClick:function onClick(){a(e.$root.user,t.id,t.time,!1).then(function(){e.getData()})}},{text:e.$t("vitals_medication_reminder.medication_time.confirm_button"),bold:!0,onClick:function onClick(){a(e.$root.user,t.id,t.time,!0).then(function(){e.getData()})}}]}).open()})},onPageScroll:function onPageScroll(t){var e=this,a=e.$$(t.target).closest(".page-content");a.length&&(100<a[0].scrollTop?e.$f7router.view.$navbarEl.removeClass("vitals-element-index-navbar vitals-"+e.vitalsElement+"-index-navbar"):e.$f7router.view.$navbarEl.addClass("vitals-element-index-navbar vitals-"+e.vitalsElement+"-index-navbar"))},onPageBeforeIn:function onPageBeforeIn(){this.$f7router.view.$navbarEl.addClass("vitals-element-index-navbar vitals-"+this.vitalsElement+"-index-navbar")},onPageBeforeOut:function onPageBeforeOut(){this.$f7router.view.$navbarEl.removeClass("vitals-element-index-navbar vitals-"+this.vitalsElement+"-index-navbar")}}},u={render:function(){var a=this,t=a.$createElement,n=a._self._c||t;return n("f7-page",{class:"vitals-element-manual-add-page vitals-"+a.vitalsElement+"-manual-add-page",attrs:{id:"vitals_element__add"}},[n("f7-navbar",[n("tommy-nav-back"),a._v(" "),n("f7-nav-title",[a._v(a._s(a.t("title")))]),a._v(" "),n("f7-nav-right",[a.allowSave?n("f7-link",{attrs:{href:"#","icon-only":""},on:{click:a.save}},[n("i",{staticClass:"icon f7-icons"},[a._v("check")])]):a._e()],1)],1),a._v(" "),n("f7-list",{attrs:{"no-hairlines":""}},[n("f7-list-input",{attrs:{type:"text","inline-label":"",value:a.name,label:a.t("vital_label")},on:{input:function(t){a.name=t.target.value}}}),a._v(" "),n("f7-list-input",{attrs:{type:"text","inline-label":"","input-id":"date-input-start",label:a.t("startdate_label")}}),a._v(" "),n("f7-list-input",{attrs:{type:"text","inline-label":"","input-id":"date-input-end",label:a.t("enddate_label")}}),a._v(" "),n("f7-list-item",{attrs:{"smart-select":"","smart-select-params":{openIn:"popover",closeOnSelect:!0},title:a.t("frequency_label"),after:a.t("frequency_units.0")}},[n("select",{domProps:{value:a.frequency},on:{change:function(t){a.frequency=parseInt(t.target.value,10)}}},a._l(8,function(t){return n("option",{key:t,domProps:{value:t}},[a._v(a._s(a.t("frequency_units."+(t-1))))])}))]),a._v(" "),a._l(a.frequency,function(e){return n("f7-list-item",{key:e,staticClass:"vitals-medication_reminder-dosage-input"},[n("div",{staticClass:"input"},[n("input",{staticClass:"time-input",attrs:{type:"text"},domProps:{value:a.dosage[e-1].time}})]),a._v(" "),n("div",{staticClass:"input",staticStyle:{width:"100px"}},[n("input",{attrs:{type:"number",placeholder:a.t("dosage_label")},domProps:{value:a.dosage[e-1].value},on:{input:function(t){a.dosage[e-1].value=t.target.value}}})]),a._v(" "),n("div",{staticClass:"input input-dropdown"},[n("select",{domProps:{value:a.dosage[e-1].unit||"bag"},on:{change:function(t){a.dosage[e-1].unit=t.target.value}}},[n("option",{attrs:{value:"bag"}},[a._v(a._s(a.t("dosage_unit.bag")))]),a._v(" "),n("option",{attrs:{value:"ml"}},[a._v(a._s(a.t("dosage_unit.ml")))]),a._v(" "),n("option",{attrs:{value:"pill"}},[a._v(a._s(a.t("dosage_unit.pill")))]),a._v(" "),n("option",{attrs:{value:"mg"}},[a._v(a._s(a.t("dosage_unit.mg")))]),a._v(" "),n("option",{attrs:{value:"drop"}},[a._v(a._s(a.t("dosage_unit.drop")))])])])])})],2)],1)},staticRenderFns:[],props:{addon:String,vitalsElement:String},data:function data(){var t=new Date;return t.setHours(0,0,0,0),{name:"",frequency:1,startDate:t,endDate:new Date(t.getTime()+864e6),dosage:[{value:"",unit:"bag",time:"10:00"}]}},computed:{allowSave:function allowSave(){if(this.name&&this.name.trim().length){var e=!0;if(this.dosage.forEach(function(t){(!t.value||t.value<1)&&(e=!1)}),e)return!0}return!1}},watch:{frequency:function frequency(){for(var t=this,e=t.dosage[t.dosage.length-1].value,a=t.dosage[t.dosage.length-1].unit,n=t.dosage[t.dosage.length-1].time,i=0;i<t.frequency;i+=1)t.dosage[i]||(t.dosage[i]={value:e,unit:a,time:n});t.$nextTick(function(){t.createPickers()})}},mounted:function mounted(){var a,n=this;n.$f7.calendar.create({inputEl:n.$el.querySelector("#date-input-start"),value:[n.startDate],minDate:new Date,on:{change:function change(t,e){(n.startDate=new Date(e[0]),n.startDate.setHours(0,0,0,0),a)&&(a.params.minDate=n.startDate,new Date(a.value[0]).getTime()<new Date(n.startDate).getTime()&&a.setValue([n.startDate]))}}}),a=n.$f7.calendar.create({inputEl:n.$el.querySelector("#date-input-end"),value:[n.endDate],on:{change:function change(t,e){n.endDate=new Date(e[0]),n.endDate.setHours(0,0,0,0)}}}),n.createPickers()},methods:{t:function t(e,a){return this.$t(this.addon+".medication_add."+e,a)},createPickers:function createPickers(){var n=this;n.$$(n.$el).find(".vitals-medication_reminder-dosage-input .time-input").each(function(a,t){t.f7PickerCreated||(t.f7PickerCreated=!0,n.$f7.picker.create({inputEl:t,value:[n.dosage[a].time.split(":")[0],n.dosage[a].time.split(":")[1]],formatValue:function formatValue(t){return t[0]+":"+t[1]},cols:[{values:function(){for(var t=[],e=0;e<24;e+=1)e<10?t.push("0"+e):t.push(e.toString());return t}()},{divider:!0,content:":"},{values:function(){for(var t=[],e=0;e<60;e+=1)e<10?t.push("0"+e):t.push(e.toString());return t}()}],on:{change:function change(t,e){n.dosage[a].time=e.join(":")}}}))})},save:function save(){var t=this,e=t.name,a=t.startDate,n=t.endDate,i=t.dosage,s=t.frequency;o(t.$root.user,{name:e,startDate:new Date(a).toJSON(),endDate:new Date(n).toJSON(),dosage:i.filter(function(t,e){return e<s}),frequency:s,reminder:!0}).then(function(){t.$events.$emit(t.addon+":updateRecords"),t.$f7router.back()})}}},m={render:function(){var a=this,t=a.$createElement,n=a._self._c||t;return n("f7-page",{class:"vitals-element-manual-add-page vitals-"+a.vitalsElement+"-manual-add-page",attrs:{id:"vitals_element__add"}},[n("f7-navbar",[n("tommy-nav-back"),a._v(" "),n("f7-nav-title",[a._v(a._s(a.t("title")))]),a._v(" "),n("f7-nav-right",[a.allowSave?n("f7-link",{attrs:{href:"#","icon-only":""},on:{click:a.save}},[n("i",{staticClass:"icon f7-icons"},[a._v("check")])]):a._e()],1)],1),a._v(" "),a.loaded?n("div",{staticClass:"medication-toolbar",attrs:{slot:"fixed"},slot:"fixed"},[n("a",{attrs:{href:"#"},on:{click:a.deleteMedication}},[a._v(a._s(a.t("delete_button")))]),a._v(" "),n("a",{attrs:{href:"#"},on:{click:function(){return a.reminder?a.stopReminder():a.startReminder()}}},[a._v(a._s(a.t(a.reminder?"pause_button":"start_button")))])]):a._e(),a._v(" "),a.loaded?n("f7-list",{attrs:{"no-hairlines":""}},[n("f7-list-input",{attrs:{type:"text","inline-label":"",value:a.name,label:a.t("vital_label")},on:{input:function(t){a.name=t.target.value}}}),a._v(" "),n("f7-list-input",{attrs:{type:"text","inline-label":"","input-id":"date-input-start",label:a.t("startdate_label")}}),a._v(" "),n("f7-list-input",{attrs:{type:"text","inline-label":"","input-id":"date-input-end",label:a.t("enddate_label")}}),a._v(" "),n("f7-list-item",{attrs:{"smart-select":"","smart-select-params":{openIn:"popover",closeOnSelect:!0},title:a.t("frequency_label"),after:a.t("frequency_units.0")}},[n("select",{domProps:{value:a.frequency},on:{change:function(t){a.frequency=parseInt(t.target.value,10)}}},a._l(8,function(t){return n("option",{key:t,domProps:{value:t}},[a._v(a._s(a.t("frequency_units."+(t-1))))])}))]),a._v(" "),a._l(a.frequency,function(e){return n("f7-list-item",{key:e,staticClass:"vitals-medication_reminder-dosage-input"},[n("div",{staticClass:"input"},[n("input",{staticClass:"time-input",attrs:{type:"text"},domProps:{value:a.dosage[e-1].time}})]),a._v(" "),n("div",{staticClass:"input",staticStyle:{width:"100px"}},[n("input",{attrs:{type:"number",placeholder:a.t("dosage_label")},domProps:{value:a.dosage[e-1].value},on:{input:function(t){a.dosage[e-1].value=t.target.value}}})]),a._v(" "),n("div",{staticClass:"input input-dropdown"},[n("select",{domProps:{value:a.dosage[e-1].unit||"bag"},on:{change:function(t){a.dosage[e-1].unit=t.target.value}}},[n("option",{attrs:{value:"bag"}},[a._v(a._s(a.t("dosage_unit.bag")))]),a._v(" "),n("option",{attrs:{value:"ml"}},[a._v(a._s(a.t("dosage_unit.ml")))]),a._v(" "),n("option",{attrs:{value:"pill"}},[a._v(a._s(a.t("dosage_unit.pill")))]),a._v(" "),n("option",{attrs:{value:"mg"}},[a._v(a._s(a.t("dosage_unit.mg")))]),a._v(" "),n("option",{attrs:{value:"drop"}},[a._v(a._s(a.t("dosage_unit.drop")))])])])])})],2):a._e()],1)},staticRenderFns:[],props:{id:String,addon:String,vitalsElement:String},data:function data(){var t=new Date;return t.setHours(0,0,0,0),{loaded:!1,name:"",frequency:1,startDate:t,endDate:new Date(t.getTime()+864e6),reminder:!0,dosage:[{value:"",unit:"bag",time:"10:00"}]}},computed:{allowSave:function allowSave(){if(this.name&&this.name.trim().length){var e=!0;if(this.dosage.forEach(function(t){(!t.value||t.value<1)&&(e=!1)}),e)return!0}return!1}},watch:{frequency:function frequency(){for(var t=this,e=t.dosage[t.dosage.length-1].value,a=t.dosage[t.dosage.length-1].unit,n=t.dosage[t.dosage.length-1].time,i=0;i<t.frequency;i+=1)t.dosage[i]||(t.dosage[i]={value:e,unit:a,time:n});t.$nextTick(function(){t.createPickers()})}},mounted:function mounted(){var a,n=this;t(n.$root.user,n.id).then(function(t){n.name=t.data.name,n.frequency=t.data.frequency,n.startDate=t.data.startDate,n.endDate=t.data.endDate,n.dosage=t.data.dosage,n.reminder=t.data.reminder,n.loaded=!0,n.$nextTick(function(){n.$f7.calendar.create({inputEl:n.$el.querySelector("#date-input-start"),value:[n.startDate],minDate:new Date,on:{change:function change(t,e){(n.startDate=new Date(e[0]),n.startDate.setHours(0,0,0,0),a)&&(a.params.minDate=n.startDate,new Date(a.value[0]).getTime()<new Date(n.startDate).getTime()&&a.setValue([n.startDate]))}}}),a=n.$f7.calendar.create({inputEl:n.$el.querySelector("#date-input-end"),value:[n.endDate],on:{change:function change(t,e){n.endDate=new Date(e[0]),n.endDate.setHours(0,0,0,0)}}}),n.createPickers()})})},methods:{t:function t(e,a){return this.$t(this.addon+".medication_edit."+e,a)},createPickers:function createPickers(){var n=this;n.$$(n.$el).find(".vitals-medication_reminder-dosage-input .time-input").each(function(a,t){t.f7PickerCreated||(t.f7PickerCreated=!0,n.$f7.picker.create({inputEl:t,value:[n.dosage[a].time.split(":")[0],n.dosage[a].time.split(":")[1]],formatValue:function formatValue(t){return t[0]+":"+t[1]},cols:[{values:function(){for(var t=[],e=0;e<24;e+=1)e<10?t.push("0"+e):t.push(e.toString());return t}()},{divider:!0,content:":"},{values:function(){for(var t=[],e=0;e<60;e+=1)e<10?t.push("0"+e):t.push(e.toString());return t}()}],on:{change:function change(t,e){n.dosage[a].time=e.join(":")}}}))})},deleteMedication:function deleteMedication(){var t=this;e(t.$root.user,t.id).then(function(){t.$events.$emit(t.addon+":updateRecords"),t.$f7router.back()})},stopReminder:function stopReminder(){var t=this,e=t.name,a=t.startDate,n=t.endDate,i=t.dosage,s=t.frequency;d(t.$root.user,t.id,{name:e,startDate:new Date(a).toJSON(),endDate:new Date(n).toJSON(),dosage:i,frequency:s,reminder:!1}).then(function(){t.$events.$emit(t.addon+":updateRecords"),t.$f7router.back()})},startReminder:function startReminder(){var t=this,e=t.name,a=t.startDate,n=t.endDate,i=t.dosage,s=t.frequency;d(t.$root.user,t.id,{name:e,startDate:new Date(a).toJSON(),endDate:new Date(n).toJSON(),dosage:i,frequency:s,reminder:!0}).then(function(){t.$events.$emit(t.addon+":updateRecords"),t.$f7router.back()})},save:function save(){var t=this,e=t.name,a=t.startDate,n=t.endDate,i=t.dosage,s=t.frequency,r=t.reminder;void 0===r&&(r=!0),d(t.$root.user,t.id,{name:e,startDate:new Date(a).toJSON(),endDate:new Date(n).toJSON(),dosage:i,frequency:s,reminder:r}).then(function(){t.$events.$emit(t.addon+":updateRecords"),t.$f7router.back()})}}},v={receiveMessage:!1},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("f7-page",{class:"vitals-element-settings-page vitals-"+t.vitalsElement+"-settings-page",attrs:{id:"vitals_element__settings"}},[a("f7-navbar",[a("tommy-nav-back"),t._v(" "),a("f7-nav-title",[t._v(t._s(t.t("title")))])],1),t._v(" "),a("div",{class:"vitals-element-settings-header vitals-"+t.vitalsElement+"-settings-header"},[a("div",{class:"vitals-element-settings-center-icon vitals-"+t.vitalsElement+"-settings-center-icon"})]),t._v(" "),a("div",{class:"vitals-element-settings-text vitals-"+t.vitalsElement+"-settings-text"},[a("p",[t._v(t._s(t.t("vital_text")))])]),t._v(" "),a("f7-list",{staticClass:"no-hairlines"},[a("f7-list-item",{attrs:{title:t.t("chat_label")}},[a("f7-toggle",{attrs:{slot:"after",checked:t.settings.receiveMessage},on:{"toggle:change":t.onMessagesChanges},slot:"after"})],1)],1)],1)},staticRenderFns:[],props:{addon:String,vitalsElement:String},data:function data(){return{settings:v}},mounted:function mounted(){var e=this;n(e.addon).then(function(t){t&&(e.settings=t,v=e.settings)})},methods:{t:function t(e,a){return this.$t(this.addon+".settings."+e,a)},onMessagesChanges:function onMessagesChanges(t){this.settings.receiveMessage=t,v=this.settings,c(this.addon,this.settings)}}},_={render:function(){var n=this,t=n.$createElement,i=n._self._c||t;return i("f7-page",{class:"vitals-"+n.vitalsElement+"-history-page",attrs:{id:"vitals_element__history"}},[i("f7-navbar",[i("tommy-nav-back"),n._v(" "),i("f7-nav-title",[n._v(n._s(n.t("title")))])],1),n._v(" "),i("div",{staticClass:"medication-history-header"},[n.data&&n.takenData?[i("div",{staticClass:"medication-history-header-icon",class:{"not-taken":!n.isLastDayTaken}}),n._v(" "),i("div",{staticClass:"medication-history-header-text"},[n._v(n._s(n.isLastDayTaken?n.t("notice_text.0"):n.t("notice_text.1")))])]:n._e()],2),n._v(" "),n._l(n.orderedData,function(t,a){return i("div",{key:a,staticClass:"medication-history-card",on:{click:function(t){n.toggleCard(a)}}},[i("div",{staticClass:"medication-history-card-date"},[i("span",[n._v(n._s(n.$moment(a).format("DD MMM YYYY")))]),n._v(" "),n.isOpenedCard(a)?i("span",[n._v(n._s(n.percentageTaken(t,a))+"%")]):n._e(),n._v(" "),i("f7-icon",{attrs:{f7:n.isOpenedCard(a)?"chevron_up":"chevron_right",size:"16"}})],1),n._v(" "),n.isOpenedCard(a)?n._l(t,function(t,e){return i("div",{key:e,staticClass:"medication-history-card-content"},[i("div",{staticClass:"medication-history-card-icon",class:{taken:n.isTaken(t,a),"not-taken":n.isNotTaken(t,a)}}),n._v(" "),i("div",{staticClass:"medication-history-card-title"},[n._v(n._s(t.name))]),n._v(" "),i("div",{staticClass:"medication-history-card-value"},[n._v(n._s(t.time))])])}):i("div",{staticClass:"medication-history-card-content"},[100===n.percentageTaken(t,a)?i("div",{staticClass:"medication-history-card-icon taken"}):i("f7-gauge",{attrs:{size:46,value:n.percentageTaken(t,a)/100,"border-bg-color":"#FAE1C9","border-color":"#FF4500","border-width":8}}),n._v(" "),i("div",{staticClass:"medication-history-card-title"},[n._v(n._s(n.t("dosage_status")))]),n._v(" "),i("div",{staticClass:"medication-history-card-value"},[n._v(n._s(n.percentageTaken(t,a))+"%")])],1)],2)})],2)},staticRenderFns:[],props:{addon:String,vitalsElement:String},data:function data(){return{data:null,takenData:null,openedCards:[]}},mounted:function mounted(){this.getData()},computed:{isLastDateTaken:function isLastDateTaken(){var t=this,e=t.$moment().format("YYYY-MM-DD");return!t.orderedData||(!t.orderedData[e]||100===t.percentageTaken(t.orderedData[e]))},orderedData:function orderedData(){var d=this;if(d.data){var c={};d.data.forEach(function(e){var t,a=new Date(e.data.startDate);if(!(a.getTime()>(new Date).getTime())){var n=new Date(e.data.endDate);n.getTime()>(new Date).getTime()&&(n=new Date).setHours(0,0,0,0);for(var i=(n.getTime()-a.getTime())/864e5+1,s=0;s<i;s+=1){var r=new Date(a).getTime()+864e5*s,o=d.$moment(r).format("YYYY-MM-DD");c[o]||(c[o]=[]),(t=c[o]).push.apply(t,e.data.dosage.map(function(t){return{id:e.id,name:e.data.name,time:t.time}}))}}}),Object.keys(c).forEach(function(t){c[t].sort(function(t,e){return 60*parseInt(t.time.split(":")[0],10)+parseInt(t.time.split(":")[1],10)<60*parseInt(e.time.split(":")[0],10)+parseInt(e.time.split(":")[1],10)?-1:1})});var t=Object.keys(c).sort(function(t,e){var a=new Date(t).getTime();return new Date(e).getTime()<a?-1:1}),e={};return t.forEach(function(t){e[t]=c[t]}),e}}},methods:{isOpenedCard:function isOpenedCard(t){return 0<=this.openedCards.indexOf(t)},toggleCard:function toggleCard(t){0<=this.openedCards.indexOf(t)?this.openedCards.splice(this.openedCards.indexOf(t),1):this.openedCards.push(t)},percentageTaken:function percentageTaken(t,e){var a=this,n=t.filter(function(t){return a.isTaken(t,e)});return Math.round(n.length/t.length*100)},isTaken:function isTaken(a,t){var n;if(!this.takenData)return!1;var i=new Date(t);return i.setHours(0,0,0,0),this.takenData.forEach(function(t){if(!n){var e=new Date(t.data.date||t.start_at);e.setHours(0,0,0,0),a.id===t.data.medication_id&&a.time===t.data.time&&i.getTime()===e.getTime()&&t.data.taken&&(n=!0)}}),n},isNotTaken:function isNotTaken(a,t){var n;if(!this.takenData)return!1;var i=new Date(t);return i.setHours(0,0,0,0),this.takenData.forEach(function(t){if(!n){var e=new Date(t.data.date||t.start_at);e.setHours(0,0,0,0),a.id!==t.data.medication_id||a.time!==t.data.time||i.getTime()!==e.getTime()||t.data.taken||(n=!0)}}),n},getData:function getData(){var n=this;function getData(){return new Promise(function(e,a){s(n.$root.user).then(function(t){e(t)}).catch(function(t){a(t)})})}Promise.all([getData(),function getTaken(){return new Promise(function(e,a){i(n.$root.user).then(function(t){e(t)}).catch(function(t){a(t)})})}()]).then(function(t){var e=t[0],a=t[1];n.takenData=a,n.data=e}).catch(function(t){console.log(t)})},t:function t(e,a){return this.$t(this.addon+".history."+e,a)}}},g=[{path:"/vitals_medication_reminder/",component:l},{path:"/vitals_medication_reminder/plan/",component:{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{class:"vitals-"+e.vitalsElement+"-plan-page"},[a("f7-navbar",[a("tommy-nav-back"),e._v(" "),a("f7-nav-title",[e._v(e._s(e.t("title")))])],1),e._v(" "),a("f7-fab",{class:"vitals-element-fab vitals-"+e.vitalsElement+"-fab",attrs:{href:"/"+e.addon+"/add/"}},[a("f7-icon",{attrs:{f7:"add"}})],1),e._v(" "),e._l(e.medications,function(t){return a("a",{key:t.id,staticClass:"medication-card",attrs:{href:"/"+e.addon+"/edit/"+t.id+"/"}},[a("div",{staticClass:"medication-card-date"},[e._v(e._s(e.$moment(t.data.startDate).format("D MMM YYYY"))+" - "+e._s(e.$moment(t.data.endDate).format("D MMM YYYY")))]),e._v(" "),a("div",{staticClass:"medication-card-content"},[a("div",{staticClass:"medication-card-icon"}),e._v(" "),a("div",{staticClass:"medication-card-name"},[e._v(e._s(t.data.name))])])])})],2)},staticRenderFns:[],props:{addon:String,vitalsElement:String},data:function data(){return{medications:null}},mounted:function mounted(){this.getMedications(),this.$events.$on(this.addon+":updateRecords",this.getMedications)},beforeDestroy:function beforeDestroy(){this.$events.$off(this.addon+":updateRecords",this.getMedications)},methods:{t:function t(e,a){return this.$t(this.addon+".medication_plan."+e,a)},getMedications:function getMedications(){var e=this;s(e.$root.user).then(function(t){e.medications=t})}}}},{path:"/vitals_medication_reminder/add/",component:u},{path:"/vitals_medication_reminder/edit/:id/",component:m},{path:"/vitals_medication_reminder/settings/",component:f},{path:"/vitals_medication_reminder/history/",component:_}];return g.forEach(function(t){t.options={props:{addon:"vitals_medication_reminder",vitalsElement:"medication_reminder"}}}),g}();