var addon=function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([,function(e,t,a){"use strict";function r(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{attrs:{id:"availability__index"},on:{"page:afterin":e.onPageAfterIn,"page:beforeout":e.onPageBeforeOut}},[a("f7-navbar",[a("tommy-nav-menu"),e._v(" "),a("f7-nav-title",[e._v(e._s(e.$t("availability.index.title","Availabilities")))]),e._v(" "),e.formChanged?a("f7-nav-right",[a("f7-link",{attrs:{"icon-f7":"check"},on:{click:e.save}})],1):e._e()],1),e._v(" "),e.showRefreshPanel?a("div",{staticClass:"refresh-panel"},[e._v("\n    "+e._s(e.$t("availability.index.last_updated","Last updated"))+":\n    "),a("span",{staticClass:"time"},[e._v(e._s(e.refreshPanelText))]),e._v(" "),a("a",{staticClass:"refresh",attrs:{href:"#"},on:{click:e.loadAvailabilities}},[e._v(e._s(e.$t("availability.index.refresh","Refresh")))])]):e._e(),e._v(" "),e.isNurse?e._e():a("f7-list",{staticClass:"no-margin-top",attrs:{"no-hairlines":""}},[a("f7-list-item",{attrs:{title:e.$t("availability.index.available_button")}},[a("f7-toggle",{attrs:{slot:"after",checked:e.availableForWork},on:{change:function(t){return e.changeAvailableForWork(t.target.checked)}},slot:"after"})],1)],1),e._v(" "),e.items?a("f7-list",{staticClass:"no-margin",attrs:{"no-hairlines":""}},e._l(e.items,(function(t,r){return a("f7-list-item",{key:r},[a("div",{staticClass:"availability__list-date"},[a("strong",[e._v(e._s(e.dayOrToday(t.date)))]),e._v(" "),a("span",[e._v(e._s(e.formatDate(t.date,"Do MMM")))])]),e._v(" "),a("div",{staticClass:"availability__toggle-container"},[a("a",{staticClass:"availability__toggle-availability",class:e.availabilityClass("am",t),attrs:{href:"#"},on:{click:function(a){return e.toggle(t,r,"am")}}},[a("span",{domProps:{innerHTML:e._s(e.$t("availability.word.am","am"))}})]),e._v(" "),a("a",{staticClass:"availability__toggle-availability",class:e.availabilityClass("pm",t),attrs:{href:"#"},on:{click:function(a){return e.toggle(t,r,"pm")}}},[a("span",{domProps:{innerHTML:e._s(e.$t("availability.word.pm","pm"))}})]),e._v(" "),a("a",{staticClass:"availability__toggle-availability",class:e.availabilityClass("nd",t),attrs:{href:"#"},on:{click:function(a){return e.toggle(t,r,"nd")}}},[a("span",{domProps:{innerHTML:e._s(e.$t("availability.word.nd","nd"))}})])])])})),1):e._e()],1)}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.r(t),r._withStripped=!0;var o=function(e,t,a,r,n,i,o,l){var s,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=[],c._compiled=!0),s)if(c.functional){c._injectStyles=s;var f=c.render;c.render=function(e,t){return s.call(t),f(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,s):[s]}return{exports:e,options:c}}({data:function(){for(var e=this,t={},a=e.$moment().subtract(1,"day").startOf("day"),r=e.$moment().add(2,"weeks").endOf("week"),n=a.clone(),i=e.$root.account.roles,o=!i||i&&0===i.length||i&&(0<=i.indexOf("Nurse")||0<=i.indexOf("Employee"));n.add(1,"day")<r;){var l=n.format("YYYY-MM-DD");t[l]||(t[l]={date:n.format(),data:{}})}var s=e.$f7route.query.actor_id,c=!1;return e.$root.teamMembers&&e.$root.teamMembers.forEach((function(t){var a=s||e.$root.user.id;t.user_id===parseInt(a,10)&&(c=0<=t.tags.indexOf("Available For Work"))})),{startAt:a,endAt:r,items:t,formChanged:!1,lastUpdated:null,showRefreshPanel:!1,refreshPanelTimeout:null,refreshPanelInterval:null,refreshPanelText:"1 min ago",actor_id:s,availableForWork:c,isNurse:o}},methods:{changeAvailableForWork:function(e){var t=this;t.availableForWork=!0;var a=t.actor_id||t.$root.user.id,r=t.$root.teamMembers.filter((function(e){return e.user_id===parseInt(a,10)}))[0];if(r){var n=function(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(r.tags);e?n.push("Available For Work"):n.splice(n.indexOf("Available For Work"),1),t.$api.updateCurrentTeamMember(a,{tags:n.length?n:[""]})}},onPageAfterIn:function(){var e=this;e.loadAvailabilities(),e.refreshPanelInterval=setInterval((function(){e.refreshPanelText=e.$moment(e.lastUpdated).fromNow()}),2e4)},onPageBeforeOut:function(){clearTimeout(this.refreshPanelTimeout),clearInterval(this.refreshPanelInterval)},toggle:function(e,t,a){if("true"!==e["".concat(a,"_locked")]&&!0!==e["".concat(a,"_locked")]){var r=e[a];r&&"0"!==r||(e[a]=1),1!==r&&"1"!==r||(e[a]=-1),-1!==r&&"-1"!==r||(e[a]=0),e.changed=!0,this.items[t]=e,this.formChanged=!0,this.$forceUpdate()}},dayOrToday:function(e){var t=this.$moment(e);return t.isSame(this.$moment(),"day")?"Today":t.format("dddd")},formatDate:function(e,t){var a=this.$moment.utc(e).toDate();return this.$moment(a).format(t)},availabilityClass:function(e,t){return t&&"true"===t["".concat(e,"_locked")]||!0===t["".concat(e,"_locked")]?"locked":!t||-1!==t[e]&&"-1"!==t[e]?!t||1!==t[e]&&"1"!==t[e]?"":"available":"unavailable"},loadAvailabilities:function(){var e=this,t={user_id:e.actor_id||e.$root.user.id,date_range:[e.startAt.utc().format(),e.endAt.utc().format()]};e.actor_id&&(t.actor_id=e.actor_id),e.showRefreshPanel=!1,e.$api.call({endpoint:"/workforce/availabilities/",cache:!1,data:t}).then((function(t){e.lastUpdated=new Date,e.refreshPanelTimeout=setTimeout((function(){e.showRefreshPanel=!0}),41e3),t.forEach((function(t){var a=e.$moment(t.date).format("YYYY-MM-DD");e.items[a]=t,e.$forceUpdate()}))}))},save:function(){var e=this;e.formChanged=!1,Object.keys(e.items).forEach((function(t){var a=e.items[t];if(a.changed){a.changed=!1;var r=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},a,{},{am:a.am||0,pm:a.pm||0,nd:a.nd||0},{user_id:e.actor_id||e.$root.user.id});e.actor_id&&(r.actor_id=e.actor_id),console.log("save coupon",r),e.$api.call({method:"PUT",endpoint:"/workforce/availabilities/"+t,data:r})}}))}}},r);o.options.__file="addons/availability/1.0.0/src/pages/index.vue";var l=[{path:"/availability/",component:o.exports}];t.default=l}]).default;