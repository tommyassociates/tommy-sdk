var addon=[{path:"/availability/",component:{render:function(){var i=this,a=i.$createElement,n=i._self._c||a;return n("f7-page",{attrs:{id:"availability__index"},on:{"page:afterin":i.onPageAfterIn,"page:beforeout":i.onPageBeforeOut}},[n("f7-navbar",[n("tommy-nav-menu"),i._v(" "),n("f7-nav-title",[i._v(i._s(i.$t("availability.index.title","Availabilities")))]),i._v(" "),i.formChanged?n("f7-nav-right",[n("a",{staticClass:"save link",attrs:{href:"#"},on:{click:i.save}},[i._v(i._s(i.$t("common.save","Save")))])]):i._e()],1),i._v(" "),i.showRefreshPanel?n("div",{staticClass:"refresh-panel"},[i._v(" "+i._s(i.$t("common.last_updated","Last updated"))+": "),n("span",{staticClass:"time"},[i._v(i._s(i.refreshPanelText))]),i._v(" "),n("a",{staticClass:"refresh",attrs:{href:"#"},on:{click:i.loadAvailabilities}},[i._v(i._s(i.$t("common.save","Refresh")))])]):i._e(),i._v(" "),i.items?n("f7-list",{staticClass:"no-margin",attrs:{"no-hairlines":""}},i._l(i.items,function(t,e){return n("f7-list-item",{key:e},[n("div",{staticClass:"availability__list-date"},[n("strong",[i._v(i._s(i.dayOrToday(t.start_at)))]),i._v(" "),n("span",[i._v(i._s(i.formatDate(t.start_at,"Do MMM")))])]),i._v(" "),n("div",{staticClass:"availability__toggle-container"},[n("a",{staticClass:"availability__toggle-availability",class:i.availabilityClass("am",t.data),attrs:{href:"#"},on:{click:function(a){i.toggle(t,e,"am")}}},[n("span",[i._v(i._s(i.$t("word.am","am")))])]),i._v(" "),n("a",{staticClass:"availability__toggle-availability",class:i.availabilityClass("pm",t.data),attrs:{href:"#"},on:{click:function(a){i.toggle(t,e,"pm")}}},[n("span",[i._v(i._s(i.$t("word.pm","pm")))])]),i._v(" "),n("a",{staticClass:"availability__toggle-availability",class:i.availabilityClass("nd",t.data),attrs:{href:"#"},on:{click:function(a){i.toggle(t,e,"nd")}}},[n("span",[i._v(i._s(i.$t("word.nd","nd")))])])])])})):i._e()],1)},staticRenderFns:[],data:function data(){for(var a={},t=this.$moment().subtract(1,"day").startOf("day"),e=this.$moment().add(2,"weeks").endOf("week"),i=t.clone();i.add(1,"day")<e;){var n=i.format("YYYY-MM-DD");a[n]||(a[n]={start_at:i.format(),data:{}})}return{startAt:t,endAt:e,items:a,formChanged:!1,lastUpdated:null,showRefreshPanel:!1,refreshPanelTimeout:null,refreshPanelInterval:null,refreshPanelText:"1 min ago"}},methods:{onPageAfterIn:function onPageAfterIn(){var a=this;a.loadAvailabilities(),a.refreshPanelInterval=setInterval(function(){a.refreshPanelText=a.$moment(a.lastUpdated).fromNow()},2e4)},onPageBeforeOut:function onPageBeforeOut(){clearTimeout(this.refreshPanelTimeout),clearInterval(this.refreshPanelInterval)},toggle:function toggle(a,t,e){var i=this,n=a.data[e];n||(a.data[e]=1),1===n&&(a.data[e]=-1),-1===n&&(a.data[e]=0),a.changed=!0,i.items[t]=a,i.formChanged=!0,i.$forceUpdate()},dayOrToday:function dayOrToday(a){var t=this.$moment(a);return t.isSame(this.$moment(),"day")?"Today":t.format("dddd")},formatDate:function formatDate(a,t){var e=this.$moment.utc(a).toDate();return this.$moment(e).format(t)},availabilityClass:function availabilityClass(a,t){return!t||-1!==t[a]&&"-1"!==t[a]?!t||1!==t[a]&&"1"!==t[a]?"":"available":"unavailable"},loadAvailabilities:function loadAvailabilities(){var e=this,a={addon:"availability",kind:"Availability",user_id:e.$f7route.query.actor_id||e.$root.user.id,date_range:[e.startAt.utc().format(),e.endAt.utc().format()]};return e.showRefreshPanel=!1,e.$api.getFragments(a,{cache:!1}).then(function(a){e.lastUpdated=new Date,e.refreshPanelTimeout=setTimeout(function(){e.showRefreshPanel=!0},41e3),a.forEach(function(a){var t=e.$moment(a.start_at).format("YYYY-MM-DD");a.data||(a.data={}),e.items[t]=a,e.$forceUpdate()})})},save:function save(){var i=this;i.formChanged=!1,Object.keys(i.items).forEach(function(t){var a=i.items[t];if(a.changed){a.changed=!1;var e=Object.assign({},a,{addon:"availability",kind:"Availability",data:JSON.stringify({am:a.data.am||0,pm:a.data.pm||0,nd:a.data.nd||0}),start_at:t,user_id:i.$f7route.query.actor_id||i.$root.user.id});a.id?i.$api.updateFragment(a.id,e).then(function(a){i.items[t]=a,i.$forceUpdate()}):i.$api.createFragment(e).then(function(a){i.items[t]=a,i.$forceUpdate()})}})}}}}];