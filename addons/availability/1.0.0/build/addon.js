var addon=function(t){var e={};function a(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,a),i.l=!0,i.exports}return a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(r,i,function(e){return t[e]}.bind(null,i));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=1)}([,function(t,e,a){"use strict";function r(){var t=this,e=t.$createElement,a=t._self._c||e;return a("f7-page",{attrs:{id:"availability__index"},on:{"page:afterin":t.onPageAfterIn,"page:beforeout":t.onPageBeforeOut}},[a("f7-navbar",[a("tommy-nav-menu"),t._v(" "),a("f7-nav-title",[t._v(t._s(t.$t("availability.index.title","Availabilities")))]),t._v(" "),t.formChanged?a("f7-nav-right",[a("f7-link",{attrs:{"icon-f7":"check"},on:{click:t.save}})],1):t._e()],1),t._v(" "),t.showRefreshPanel?a("div",{staticClass:"refresh-panel"},[t._v("\n    "+t._s(t.$t("availability.index.last_updated","Last updated"))+":\n    "),a("span",{staticClass:"time"},[t._v(t._s(t.refreshPanelText))]),t._v(" "),a("a",{staticClass:"refresh",attrs:{href:"#"},on:{click:t.loadAvailabilities}},[t._v(t._s(t.$t("availability.index.refresh","Refresh")))])]):t._e(),t._v(" "),t.isNurse?t._e():a("f7-list",{staticClass:"no-margin-top",attrs:{"no-hairlines":""}},[a("f7-list-item",{attrs:{title:t.$t("availability.index.available_button")}},[a("f7-toggle",{attrs:{slot:"after",checked:t.availableForWork},on:{change:function(e){return t.changeAvailableForWork(e.target.checked)}},slot:"after"})],1)],1),t._v(" "),t.items?a("f7-list",{staticClass:"no-margin",attrs:{"no-hairlines":""}},t._l(t.items,(function(e,r){return a("f7-list-item",{key:r},[a("div",{staticClass:"availability__list-date"},[a("strong",[t._v(t._s(t.dayOrToday(e.start_at)))]),t._v(" "),a("span",[t._v(t._s(t.formatDate(e.start_at,"Do MMM")))])]),t._v(" "),a("div",{staticClass:"availability__toggle-container"},[a("a",{staticClass:"availability__toggle-availability",class:t.availabilityClass("am",e.data),attrs:{href:"#"},on:{click:function(a){return t.toggle(e,r,"am")}}},[a("span",{domProps:{innerHTML:t._s(t.$t("availability.word.am","am"))}})]),t._v(" "),a("a",{staticClass:"availability__toggle-availability",class:t.availabilityClass("pm",e.data),attrs:{href:"#"},on:{click:function(a){return t.toggle(e,r,"pm")}}},[a("span",{domProps:{innerHTML:t._s(t.$t("availability.word.pm","pm"))}})]),t._v(" "),a("a",{staticClass:"availability__toggle-availability",class:t.availabilityClass("nd",e.data),attrs:{href:"#"},on:{click:function(a){return t.toggle(e,r,"nd")}}},[a("span",{domProps:{innerHTML:t._s(t.$t("availability.word.nd","nd"))}})])])])})),1):t._e()],1)}function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}a.r(e),r._withStripped=!0;var n=function(t,e,a,r,i,n,o,l){var s,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=[],c._compiled=!0),s)if(c.functional){c._injectStyles=s;var d=c.render;c.render=function(t,e){return s.call(e),d(t,e)}}else{var f=c.beforeCreate;c.beforeCreate=f?[].concat(f,s):[s]}return{exports:t,options:c}}({data:function(){for(var t=this,e={},a=t.$moment().subtract(1,"day").startOf("day"),r=t.$moment().add(2,"weeks").endOf("week"),i=a.clone(),n=t.$root.account.roles,o=!n||n&&0===n.length||n&&(0<=n.indexOf("Nurse")||0<=n.indexOf("Employee"));i.add(1,"day")<r;){var l=i.format("YYYY-MM-DD");e[l]||(e[l]={start_at:i.format(),data:{}})}var s=t.$f7route.query.actor_id,c=!1;return t.$root.teamMembers&&t.$root.teamMembers.forEach((function(e){var a=s||t.$root.user.id;e.user_id===parseInt(a,10)&&(c=0<=e.tags.indexOf("Available For Work"))})),{startAt:a,endAt:r,items:e,formChanged:!1,lastUpdated:null,showRefreshPanel:!1,refreshPanelTimeout:null,refreshPanelInterval:null,refreshPanelText:"1 min ago",actor_id:s,availableForWork:c,isNurse:o}},methods:{changeAvailableForWork:function(t){var e=this;e.availableForWork=!0;var a=e.actor_id||e.$root.user.id,r=e.$root.teamMembers.filter((function(t){return t.user_id===parseInt(a,10)}))[0];if(r){var i=function(t){return function(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(r.tags);t?i.push("Available For Work"):i.splice(i.indexOf("Available For Work"),1),e.$api.updateCurrentTeamMember(a,{tags:i.length?i:[""]})}},onPageAfterIn:function(){var t=this;t.loadAvailabilities(),t.refreshPanelInterval=setInterval((function(){t.refreshPanelText=t.$moment(t.lastUpdated).fromNow()}),2e4)},onPageBeforeOut:function(){clearTimeout(this.refreshPanelTimeout),clearInterval(this.refreshPanelInterval)},toggle:function(t,e,a){if("true"!==t.data["".concat(a,"_locked")]&&!0!==t.data["".concat(a,"_locked")]){var r=t.data[a];r&&"0"!==r||(t.data[a]=1),1!==r&&"1"!==r||(t.data[a]=-1),-1!==r&&"-1"!==r||(t.data[a]=0),t.changed=!0,this.items[e]=t,this.formChanged=!0,this.$forceUpdate()}},dayOrToday:function(t){var e=this.$moment(t);return e.isSame(this.$moment(),"day")?"Today":e.format("dddd")},formatDate:function(t,e){var a=this.$moment.utc(t).toDate();return this.$moment(a).format(e)},availabilityClass:function(t,e){return e&&"true"===e["".concat(t,"_locked")]||!0===e["".concat(t,"_locked")]?"locked":!e||-1!==e[t]&&"-1"!==e[t]?!e||1!==e[t]&&"1"!==e[t]?"":"available":"unavailable"},loadAvailabilities:function(){var t=this,e={addon:"availability",kind:"Availability",user_id:t.actor_id||t.$root.user.id,date_range:[t.startAt.utc().format(),t.endAt.utc().format()]};return t.actor_id&&(e.actor_id=t.actor_id),t.showRefreshPanel=!1,t.$api.getFragments(e,{cache:!1}).then((function(e){t.lastUpdated=new Date,t.refreshPanelTimeout=setTimeout((function(){t.showRefreshPanel=!0}),41e3),e.forEach((function(e){var a=t.$moment(e.start_at).format("YYYY-MM-DD");e.data||(e.data={}),t.items[a]&&new Date(e.created_at).getTime()<new Date(t.items[a].created_at).getTime()||(t.items[a]=e,t.$forceUpdate())}))}))},save:function(){var t=this;t.formChanged=!1,Object.keys(t.items).forEach((function(e){var a=t.items[e];if(a.changed){a.changed=!1;var r={am:a.data.am||0,pm:a.data.pm||0,nd:a.data.nd||0};!0!==a.data.am_locked&&"true"!==a.data.am_locked||(r.am_locked=!0),!0!==a.data.pm_locked&&"true"!==a.data.pm_locked||(r.pm_locked=!0),!0!==a.data.nd_locked&&"true"!==a.data.nd_locked||(r.nd_locked=!0);var n=function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable})))),r.forEach((function(e){i(t,e,a[e])}))}return t}({},a,{addon:"availability",kind:"Availability",data:JSON.stringify(r),start_at:e,user_id:t.actor_id||t.$root.user.id});t.actor_id&&(n.actor_id=t.actor_id),a.id?t.$api.updateFragment(a.id,Object.assign(n)).then((function(a){t.items[e]=a,t.$forceUpdate()})):t.$api.createFragment(n).then((function(a){t.items[e]=a,t.$forceUpdate()}))}}))}}},r);n.options.__file="addons/availability/1.0.0/src/pages/index.vue";var o=[{path:"/availability/",component:n.exports}];e.default=o}]);