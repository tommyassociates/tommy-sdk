!function r(i,l,c){function u(t,e){if(!l[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(s)return s(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var o=l[t]={exports:{}};i[t][0].call(o.exports,function(e){return u(i[t][1][e]||e)},o,o.exports,r,i,l,c)}return l[t].exports}for(var s="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("./controllers/index");(a=o)&&a.__esModule;var r=window.tommy.api,i={wallet:{},getWallet:function(){return r.call({endpoint:"wallet",method:"GET",data:{}}).then(function(e){return i.wallet=e})},updateWalletSettings:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(t).forEach(function(e){i.wallet[e]=t[e]}),r.call({endpoint:"wallet",method:"PUT",data:t})},getWalletCards:function(){return r.call({endpoint:"wallet/cards",method:"GET",data:{}})},getWalletTransactions:function(e){return r.call({endpoint:"wallet/transactions",method:"GET",data:{card_id:e}})},getWalletTransaction:function(e){return r.call({endpoint:"wallet/transactions/"+e,method:"GET",data:{}})},getBalanceHistory:function(){},createWalletTransaction:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return r.call({endpoint:"wallet/transactions",method:"POST",data:e})}};n.default=i},{"./controllers/index":3}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),r=(a=o)&&a.__esModule?a:{default:a};var i={init:function(t){var e=t.query,n=e.id,a=e.name;a&&$$(t.navbarInnerContainer).find(".center").text(a),r.default.getWalletTransactions(n).then(function(e){window.tommy.tplManager.renderInline("wallet__transactionsListTemplate",{items:e},t.container)})},uninit:function(){}};n.default=i},{"../api":1}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),r=(a=o)&&a.__esModule?a:{default:a};var i={init:function(e){console.log("initialize wallet addon"),i.bind(e),i.loadWalletInfo(),i.loadWallets(),i.loadTransactions(),i.loadBalanceHistory()},loadWalletInfo:function(){r.default.getWallet().then(function(e){e.show_balance&&$$(i.page.container).find(".wallet-balance-value").text(e.balance)})},loadWallets:function(){r.default.getWalletCards().then(function(e){var t="development"===window.localStorage.env;window.tommy.tplManager.renderInline("wallet__walletsListTemplate",{items:e,showTestButton:t},i.page.container),t&&($$("#wallet__createTestTransaction").on("click",function(){window.tommy.initWalletTransaction({addon_id:26,addon_install_id:8430,payee_name:"Apple / iMac Pro",currency:"CNY",amount:100})}),$$("#wallet__createTestErrorTransaction").on("click",function(){window.tommy.initWalletTransaction({addon_id:26,addon_install_id:8430,payee_name:"Mercedes S600",currency:"USD",amount:1e5})}))})},loadTransactions:function(){r.default.getWalletTransactions().then(function(e){window.tommy.tplManager.renderInline("wallet__transactionsListTemplate",{items:e},i.page.container)})},loadBalanceHistory:function(){},bind:function(e){i.page=e},uninit:function(){i.page=null,delete i.page,console.log("uninitialize wallet addon")}};n.default=i},{"../api":1}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),l=(a=o)&&a.__esModule?a:{default:a};var r={init:function(e){var t=l.default.wallet,n=t.enable_notifications,a=t.show_balance;r.bind(e);var o={enable_notifications:n,show_balance:a};window.tommy.tplManager.renderInline("wallet__settingsTemplate",o,e.container)},onInputChange:function(e){var t,n,a,o=e.target,r=o.name,i=o.checked;l.default.updateWalletSettings((t={},n=r,a=i,n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t)).then(function(){"show_balance"===r&&(l.default.wallet.show_balance?$$(".wallet-balance-value").text(l.default.wallet.balance):$$(".wallet-balance-value").text(""))})},bind:function(e){r.page=e,$$(e.container).on("change","input",r.onInputChange)},uninit:function(){r.page&&($$(r.page.container).off("change","input",r.onInputChange),r.page=null,delete r.page)}};n.default=r},{"../api":1}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),r=(a=o)&&a.__esModule?a:{default:a};var i={init:function(t){var e=t.query.id;r.default.getWalletTransaction(e).then(function(e){window.tommy.tplManager.renderInline("wallet__transactionDetailsTemplate",e,t.container)})},uninit:function(){}};n.default=i},{"../api":1}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return e&&a[e]?a[e]:""};var a={AED:"د.إ",AFN:"؋",ALL:"L",AMD:"֏",ANG:"ƒ",AOA:"Kz",ARS:"$",AUD:"$",AWG:"ƒ",AZN:"₼",BAM:"KM",BBD:"$",BDT:"৳",BGN:"лв",BHD:".د.ب",BIF:"FBu",BMD:"$",BND:"$",BOB:"$b",BRL:"R$",BSD:"$",BTC:"฿",BTN:"Nu.",BWP:"P",BYR:"Br",BYN:"Br",BZD:"BZ$",CAD:"$",CDF:"FC",CHF:"CHF",CLP:"$",CNY:"¥",COP:"$",CRC:"₡",CUC:"$",CUP:"₱",CVE:"$",CZK:"Kč",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"دج",EEK:"kr",EGP:"£",ERN:"Nfk",ETB:"Br",ETH:"Ξ",EUR:"€",FJD:"$",FKP:"£",GBP:"£",GEL:"₾",GGP:"£",GHC:"₵",GHS:"GH₵",GIP:"£",GMD:"D",GNF:"FG",GTQ:"Q",GYD:"$",HKD:"$",HNL:"L",HRK:"kn",HTG:"G",HUF:"Ft",IDR:"Rp",ILS:"₪",IMP:"£",INR:"₹",IQD:"ع.د",IRR:"﷼",ISK:"kr",JEP:"£",JMD:"J$",JOD:"JD",JPY:"¥",KES:"KSh",KGS:"лв",KHR:"៛",KMF:"CF",KPW:"₩",KRW:"₩",KWD:"KD",KYD:"$",KZT:"лв",LAK:"₭",LBP:"£",LKR:"₨",LRD:"$",LSL:"M",LTC:"Ł",LTL:"Lt",LVL:"Ls",LYD:"LD",MAD:"MAD",MDL:"lei",MGA:"Ar",MKD:"ден",MMK:"K",MNT:"₮",MOP:"MOP$",MRO:"UM",MRU:"UM",MUR:"₨",MVR:"Rf",MWK:"MK",MXN:"$",MYR:"RM",MZN:"MT",NAD:"$",NGN:"₦",NIO:"C$",NOK:"kr",NPR:"₨",NZD:"$",OMR:"﷼",PAB:"B/.",PEN:"S/.",PGK:"K",PHP:"₱",PKR:"₨",PLN:"zł",PYG:"Gs",QAR:"﷼",RMB:"￥",RON:"lei",RSD:"Дин.",RUB:"₽",RWF:"R₣",SAR:"﷼",SBD:"$",SCR:"₨",SDG:"ج.س.",SEK:"kr",SGD:"$",SHP:"£",SLL:"Le",SOS:"S",SRD:"$",SSP:"£",STD:"Db",STN:"Db",SVC:"$",SYP:"£",SZL:"E",THB:"฿",TJS:"SM",TMT:"T",TND:"د.ت",TOP:"T$",TRL:"₤",TRY:"₺",TTD:"TT$",TVD:"$",TWD:"NT$",TZS:"TSh",UAH:"₴",UGX:"USh",USD:"$",UYU:"$U",UZS:"лв",VEF:"Bs",VND:"₫",VUV:"VT",WST:"WS$",XAF:"FCFA",XBT:"Ƀ",XCD:"$",XOF:"CFA",XPF:"₣",YER:"﷼",ZAR:"R",ZWD:"Z$"}},{}],7:[function(e,t,n){"use strict";var a=u(e("./controllers/index")),o=u(e("./controllers/card-details")),r=u(e("./controllers/transaction-details")),i=u(e("./controllers/settings")),l=u(e("./init-wallet-transaction")),c=u(e("./currency-map"));function u(e){return e&&e.__esModule?e:{default:e}}var s=window.tommy.app,d=s.f7,p=s.t7;d.onPageInit("wallet__index",a.default.init),d.onPageBeforeRemove("wallet__index",a.default.uninit),d.onPageBeforeInit("wallet__card_details",o.default.init),d.onPageBeforeRemove("wallet__card_details",o.default.uninit),d.onPageInit("wallet__transaction_details",r.default.init),d.onPageBeforeRemove("wallet__transaction_details",r.default.uninit),d.onPageInit("wallet__settings",i.default.init),d.onPageBeforeRemove("wallet__settings",i.default.uninit),p.registerHelper("wallet__formatTransactionAmount",function(e){return("paid"===e.status||"failed"===e.status?"-":"+")+" "+(0,c.default)(e.currency)+e.amount}),p.registerHelper("wallet__currencySymbol",function(e){return(0,c.default)(e)}),p.registerHelper("wallet__formatTransactionStatus",function(e){return e[0].toUpperCase()+e.substr(1)}),p.registerHelper("wallet__formatTransactionDate",function(e){if(!e)return"";var t=new Date(e),n=t.getFullYear(),a=t.getMonth()+1;a<10&&(a="0"+a);var o=t.getDate();o<10&&(o="0"+o);var r=t.getHours();r<10&&(r="0"+r);var i=t.getMinutes();return i<10&&(i="0"+i),n+"-"+a+"-"+o+" "+r+":"+i}),window.tommy.initWalletTransaction=l.default},{"./controllers/card-details":2,"./controllers/index":3,"./controllers/settings":4,"./controllers/transaction-details":5,"./currency-map":6,"./init-wallet-transaction":8}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){m.cache.popup||m.init(e,t,n)};var f=a(e("./currency-map")),o=a(e("./api"));function a(e){return e&&e.__esModule?e:{default:e}}var _=window.tommy,m={cache:{popup:null,params:null},selectWallet:function(e,t){var n=_.app.f7,a=e.map(function(e){return{text:e.name,onClick:function(){t&&t(e)}}});n.actions(a)},showLoader:function(){m.cache.$popup.find(".transaction-preloader").length||m.cache.$popup.append('<div class="transaction-preloader"></div>')},hideLoader:function(){m.cache.$popup.find(".transaction-preloader").remove()},clear:function(){m.cache.$popup.remove(),m.cache={}},renderError:function(e){var t=m.cache.$popup,n="string"==typeof e?n:e&&e.message||"",a=_.tplManager.render("wallet__transactionPopupStatus",{title:_.i18n.t("transaction_popup.error_title",{defaultValue:"Fail"}),status:"error",message:n});m.cache.onReportBack=function(){return t.html(a)},t.html(a)},renderSuccess:function(e){var t=m.cache.$popup,n=e.payee_name,a=e.card_name,o=e.amount,r=e.currency,i=_.tplManager.render("wallet__transactionPopupStatus",{title:_.i18n.t("transaction_popup.success_title",{defaultValue:"Success"}),status:"success",message:_.i18n.t("transaction_popup.success_message",{defaultValue:"You sent {{amount}}{{amount}}.<br>To {{to}}<br>From {{from}}",currency:(0,f.default)(r),amount:o,to:n,from:a})});m.cache.onReportBack=function(){return t.html(i)},t.html(i)},createTransaction:function(n){var a=n.card_name;m.showLoader(),o.default.createWalletTransaction(n).then(function(e){m.hideLoader();var t=Object.assign({},e||{},{card_name:a});(m.cache.transactionDetails=t).status&&"failed"!==t.status?(m.renderSuccess(t),m.cache.onSuccess&&m.cache.onSuccess()):"failed"===t.status&&(m.renderError(Object.assign(t,{message:_.i18n.t("transaction_popup.error_insufficient",{defaultValue:"Sorry. Your Tommy account balance is insufficient. Please use other payment methods"})})),m.cache.onError&&m.cache.onError())}).catch(function(e){var t=Object.assign({},n,{status:"failed"});m.hideLoader(),m.cache.transactionDetails=t,m.renderError(e),m.cache.onError&&m.cache.onError()})},viewReport:function(){var e=_.app.f7,t=m.cache,n=t.$popup,a=t.transactionDetails,o='\n      <div class="page navbar-fixed">\n        <div class="navbar no-border">\n          <div class="navbar-inner">\n            <div class="left">\n              <a href="#" class="link icon-only transaction-popup-report-back"><i class="icon f7-icons">chevron_left</i></a>\n            </div>\n            <div class="center">'+_.i18n.t("transaction_details.title",{defaultValue:"Transaction Details"})+'</div>\n            <div class="right">\n              <a href="#" class="link icon-only close-popup" data-popup=".wallet__transaction-popup">\n                <i class="icon f7-icons">close</i>\n              </a>\n            </div>\n          </div>\n        </div>\n        <div class="page-content transaction-popup-fade-in">\n         '+_.tplManager.render("wallet__transactionDetailsTemplate",a)+"\n        </div>\n      </div>\n    ";n.html(o),e.sizeNavbars(n)},render:function(){var t=_.app.f7,e=m.cache,l=e.$popup,n=e.params,c=n.addon_id,u=n.addon_install_id,s=n.payee_name,d=n.amount,p=n.currency;m.showLoader(),o.default.getWalletCards().then(function(e){var t=1<e.length,n=e[0],a=n.id,o=n.wallet_account_id,r=n.name,i=_.tplManager.render("wallet__transactionPopupDetails",{payee_name:s,currency:(0,f.default)(p),amount:d,card_name:r,multiple:t});m.hideLoader(),l.append(i),l.on("click",".transaction-popup-select-wallet",function(){t&&m.selectWallet(e,function(e){r=e.name,a=e.id,o=e.wallet_account_id,l.find(".transaction-popup-select-wallet").text(r)})}),l.once("click",".transaction-popup-confirm-button",function(){m.createTransaction({addon_id:c,addon_install_id:u,payee_name:s,currency:p,amount:d,wallet_card_id:a,wallet_account_id:o,card_name:r})}),l.on("click",".transaction-popup-report-button",function(){l.addClass("transaction-popup-status-rendered"),m.viewReport()}),l.on("click",".transaction-popup-report-back",function(){m.cache.onReportBack&&m.cache.onReportBack()})}).catch(function(e){t.closeModal(".wallet__transaction-popup")})},init:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],a=_.app.f7;m.cache.params=e,m.cache.onSuccess=t,m.cache.onError=n;var o=a.popup('\n      <div class="popup tablet-fullscreen wallet__transaction-popup"></div>\n    '),r=$$(o);m.cache.popup=o,(m.cache.$popup=r).on("popup:opened",function(){m.render()}),r.on("popup:closed",function(){m.clear()})}}},{"./api":1,"./currency-map":6}]},{},[7]);