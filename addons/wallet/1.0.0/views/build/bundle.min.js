!function i(l,r,c){function s(t,e){if(!r[t]){if(!l[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var o=r[t]={exports:{}};l[t][0].call(o.exports,function(e){return s(l[t][1][e]||e)},o,o.exports,i,l,r,c)}return r[t].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)s(c[e]);return s}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("./controllers/index");(a=o)&&a.__esModule;var i=window.tommy.api,l={wallet:{},getWallet:function(){return i.call({endpoint:"wallet",method:"GET",data:{}}).then(function(e){return l.wallet=e})},updateWalletSettings:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(t).forEach(function(e){l.wallet[e]=t[e]}),i.call({endpoint:"wallet",method:"PUT",data:t})},getWalletCards:function(){return i.call({endpoint:"wallet/cards",method:"GET",data:{}})},getWalletTransactions:function(e){return i.call({endpoint:"wallet/transactions",method:"GET",data:{card_id:e}})},getWalletTransaction:function(e){return i.call({endpoint:"wallet/transactions/"+e,method:"GET",data:{}})},getBalanceHistory:function(){},createWalletTransaction:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return i.call({endpoint:"wallet/transactions",method:"POST",data:e})}};n.default=l},{"./controllers/index":3}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),i=(a=o)&&a.__esModule?a:{default:a};var l={init:function(t){var e=t.query,n=e.id,a=e.name;a&&$$(t.navbarInnerContainer).find(".center").text(a),i.default.getWalletTransactions(n).then(function(e){window.tommy.tplManager.renderInline("wallet__transactionsListTemplate",{items:e},t.container)})},uninit:function(){}};n.default=l},{"../api":1}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),i=(a=o)&&a.__esModule?a:{default:a};var l={init:function(e){console.log("initialize wallet addon"),l.bind(e),l.loadWalletInfo(),l.loadWallets(),l.loadTransactions(),l.loadBalanceHistory()},loadWalletInfo:function(){i.default.getWallet().then(function(e){e.show_balance&&$$(l.page.container).find(".wallet-balance-value").text(e.balance)})},loadWallets:function(){i.default.getWalletCards().then(function(e){var t="development"===window.localStorage.env;window.tommy.tplManager.renderInline("wallet__walletsListTemplate",{items:e,showTestButton:t},l.page.container),t&&($$("#wallet__createTestTransaction").on("click",function(){window.tommy.initWalletTransaction({addon_id:26,addon_install_id:8430,payee_name:"Apple / iMac Pro",amount:100})}),$$("#wallet__createTestErrorTransaction").on("click",function(){window.tommy.initWalletTransaction({addon_id:26,addon_install_id:8430,payee_name:"Mercedes S600",amount:1e5})}))})},loadTransactions:function(){i.default.getWalletTransactions().then(function(e){window.tommy.tplManager.renderInline("wallet__transactionsListTemplate",{items:e},l.page.container)})},loadBalanceHistory:function(){},bind:function(e){l.page=e},uninit:function(){l.page=null,delete l.page,console.log("uninitialize wallet addon")}};n.default=l},{"../api":1}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),r=(a=o)&&a.__esModule?a:{default:a};var i={init:function(e){var t=r.default.wallet,n=t.enable_notifications,a=t.show_balance;i.bind(e);var o={enable_notifications:n,show_balance:a};window.tommy.tplManager.renderInline("wallet__settingsTemplate",o,e.container)},onInputChange:function(e){var t,n,a,o=e.target,i=o.name,l=o.checked;r.default.updateWalletSettings((t={},n=i,a=l,n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t)).then(function(){"show_balance"===i&&(r.default.wallet.show_balance?$$(".wallet-balance-value").text(r.default.wallet.balance):$$(".wallet-balance-value").text(""))})},bind:function(e){i.page=e,$$(e.container).on("change","input",i.onInputChange)},uninit:function(){i.page&&($$(i.page.container).off("change","input",i.onInputChange),i.page=null,delete i.page)}};n.default=i},{"../api":1}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),i=(a=o)&&a.__esModule?a:{default:a};var l={init:function(t){var e=t.query.id;i.default.getWalletTransaction(e).then(function(e){window.tommy.tplManager.renderInline("wallet__transactionDetailsTemplate",e,t.container)})},uninit:function(){}};n.default=l},{"../api":1}],6:[function(e,t,n){"use strict";var a=c(e("./controllers/index")),o=c(e("./controllers/card-details")),i=c(e("./controllers/transaction-details")),l=c(e("./controllers/settings")),r=c(e("./init-wallet-transaction"));function c(e){return e&&e.__esModule?e:{default:e}}var s=window.tommy.app,u=s.f7,d=s.t7;u.onPageInit("wallet__index",a.default.init),u.onPageBeforeRemove("wallet__index",a.default.uninit),u.onPageBeforeInit("wallet__card_details",o.default.init),u.onPageBeforeRemove("wallet__card_details",o.default.uninit),u.onPageInit("wallet__transaction_details",i.default.init),u.onPageBeforeRemove("wallet__transaction_details",i.default.uninit),u.onPageInit("wallet__settings",l.default.init),u.onPageBeforeRemove("wallet__settings",l.default.uninit),d.registerHelper("wallet__formatTransactionAmount",function(e){return("paid"===e.status||"failed"===e.status?"-":"+")+" "+e.amount}),d.registerHelper("wallet__formatTransactionStatus",function(e){return e[0].toUpperCase()+e.substr(1)}),d.registerHelper("wallet__formatTransactionDate",function(e){if(!e)return"";var t=new Date(e),n=t.getFullYear(),a=t.getMonth()+1;a<10&&(a="0"+a);var o=t.getDate();o<10&&(o="0"+o);var i=t.getHours();i<10&&(i="0"+i);var l=t.getMinutes();return l<10&&(l="0"+l),n+"-"+a+"-"+o+" "+i+":"+l}),window.tommy.initWalletTransaction=r.default},{"./controllers/card-details":2,"./controllers/index":3,"./controllers/settings":4,"./controllers/transaction-details":5,"./init-wallet-transaction":7}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){f.cache.popup||f.init(e,t,n)};var a,o=e("./api"),i=(a=o)&&a.__esModule?a:{default:a};var p=window.tommy,f={cache:{popup:null,params:null},selectWallet:function(e,t){var n=p.app.f7,a=e.map(function(e){return{text:e.name,onClick:function(){t&&t(e)}}});n.actions(a)},showLoader:function(){f.cache.$popup.find(".transaction-preloader").length||f.cache.$popup.append('<div class="transaction-preloader"></div>')},hideLoader:function(){f.cache.$popup.find(".transaction-preloader").remove()},clear:function(){f.cache.$popup.remove(),f.cache={}},renderError:function(e){var t=f.cache.$popup,n="string"==typeof e?n:e&&e.message||"",a=p.tplManager.render("wallet__transactionPopupStatus",{title:p.i18n.t("transaction_popup.error_title",{defaultValue:"Fail"}),status:"error",message:n});f.cache.onReportBack=function(){return t.html(a)},t.html(a)},renderSuccess:function(e){var t=f.cache.$popup,n=e.payee_name,a=e.card_name,o=e.amount,i=p.tplManager.render("wallet__transactionPopupStatus",{title:p.i18n.t("transaction_popup.success_title",{defaultValue:"Success"}),status:"success",message:p.i18n.t("transaction_popup.success_message",{defaultValue:"You sent Â¥{{amount}}.<br>To {{to}}<br>From {{from}}",amount:o,to:n,from:a})});f.cache.onReportBack=function(){return t.html(i)},t.html(i)},createTransaction:function(n){var a=n.card_name;f.showLoader(),i.default.createWalletTransaction(n).then(function(e){f.hideLoader();var t=Object.assign({},e||{},{card_name:a});(f.cache.transactionDetails=t).status&&"failed"!==t.status?(f.renderSuccess(t),f.cache.onSuccess&&f.cache.onSuccess()):"failed"===t.status&&(f.renderError(Object.assign(t,{message:p.i18n.t("transaction_popup.error_insufficient",{defaultValue:"Sorry. Your Tommy account balance is insufficient. Please use other payment methods"})})),f.cache.onError&&f.cache.onError())}).catch(function(e){var t=Object.assign({},n,{status:"failed"});f.hideLoader(),f.cache.transactionDetails=t,f.renderError(e),f.cache.onError&&f.cache.onError()})},viewReport:function(){var e=p.app.f7,t=f.cache,n=t.$popup,a=t.transactionDetails,o='\n      <div class="page navbar-fixed">\n        <div class="navbar no-border">\n          <div class="navbar-inner">\n            <div class="left">\n              <a href="#" class="link icon-only transaction-popup-report-back"><i class="icon f7-icons">chevron_left</i></a>\n            </div>\n            <div class="center">'+p.i18n.t("transaction_details.title",{defaultValue:"Transaction Details"})+'</div>\n            <div class="right">\n              <a href="#" class="link icon-only close-popup" data-popup=".wallet__transaction-popup">\n                <i class="icon f7-icons">close</i>\n              </a>\n            </div>\n          </div>\n        </div>\n        <div class="page-content transaction-popup-fade-in">\n         '+p.tplManager.render("wallet__transactionDetailsTemplate",a)+"\n        </div>\n      </div>\n    ";n.html(o),e.sizeNavbars(n)},render:function(){var e=f.cache,r=e.$popup,t=e.params,c=t.addon_id,s=t.addon_install_id,u=t.payee_name,d=t.amount;f.showLoader(),i.default.getWalletCards().then(function(e){var t=1<e.length,n=e[0],a=n.id,o=n.wallet_account_id,i=n.name,l=p.tplManager.render("wallet__transactionPopupDetails",{payee_name:u,amount:d,card_name:i,multiple:t});f.hideLoader(),r.append(l),r.on("click",".transaction-popup-select-wallet",function(){t&&f.selectWallet(e,function(e){i=e.name,a=e.id,o=e.wallet_account_id,r.find(".transaction-popup-select-wallet").text(i)})}),r.once("click",".transaction-popup-confirm-button",function(){f.createTransaction({addon_id:c,addon_install_id:s,payee_name:u,amount:d,wallet_card_id:a,wallet_account_id:o,card_name:i})}),r.on("click",".transaction-popup-report-button",function(){r.addClass("transaction-popup-status-rendered"),f.viewReport()}),r.on("click",".transaction-popup-report-back",function(){f.cache.onReportBack&&f.cache.onReportBack()})})},init:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],a=p.app.f7;f.cache.params=e,f.cache.onSuccess=t,f.cache.onError=n;var o=a.popup('\n      <div class="popup tablet-fullscreen wallet__transaction-popup"></div>\n    '),i=$$(o);f.cache.popup=o,(f.cache.$popup=i).on("popup:opened",function(){f.render()}),i.on("popup:closed",function(){f.clear()})}}},{"./api":1}]},{},[6]);