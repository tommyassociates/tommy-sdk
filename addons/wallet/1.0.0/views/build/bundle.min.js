!function l(r,i,u){function c(t,e){if(!i[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(s)return s(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var o=i[t]={exports:{}};r[t][0].call(o.exports,function(e){return c(r[t][1][e]||e)},o,o.exports,l,r,i,u)}return i[t].exports}for(var s="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("./controllers/index");(a=o)&&a.__esModule;var l=window.tommy.api,r={wallet:{},getWallet:function(){return l.call({endpoint:"wallet",method:"GET",data:{}}).then(function(e){return r.wallet=e})},updateWalletSettings:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(t).forEach(function(e){r.wallet[e]=t[e]}),l.call({endpoint:"wallet",method:"PUT",data:t})},getWalletCards:function(){return l.call({endpoint:"wallet/cards",method:"GET",data:{}})},getWalletTransactions:function(e){return l.call({endpoint:"wallet/transactions",method:"GET",data:{card_id:e}})},getWalletTransaction:function(e){return l.call({endpoint:"wallet/transactions/"+e,method:"GET",data:{}})},getBalanceHistory:function(){},createWalletTransaction:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return l.call({endpoint:"wallet/transactions",method:"POST",data:e})}};n.default=r},{"./controllers/index":3}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),l=(a=o)&&a.__esModule?a:{default:a};var r={init:function(t){var e=t.query,n=e.id,a=e.name;a&&$$(t.navbarInnerContainer).find(".center").text(a),l.default.getWalletTransactions(n).then(function(e){window.tommy.tplManager.renderInline("wallet__transactionsListTemplate",{items:e},t.container)})},uninit:function(){}};n.default=r},{"../api":1}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),l=(a=o)&&a.__esModule?a:{default:a};var r={init:function(e){console.log("initialize wallet addon"),r.bind(e),r.loadWalletInfo(),r.loadWallets(),r.loadTransactions(),r.loadBalanceHistory()},loadWalletInfo:function(){l.default.getWallet().then(function(e){e.show_balance&&$$(r.page.container).find(".wallet-balance-value").text(e.balance)})},loadWallets:function(){l.default.getWalletCards().then(function(e){window.tommy.tplManager.renderInline("wallet__walletsListTemplate",{items:e},r.page.container)})},loadTransactions:function(){l.default.getWalletTransactions().then(function(e){window.tommy.tplManager.renderInline("wallet__transactionsListTemplate",{items:e},r.page.container)})},loadBalanceHistory:function(){},bind:function(e){r.page=e},uninit:function(){r.page=null,delete r.page,console.log("uninitialize wallet addon")}};n.default=r},{"../api":1}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),i=(a=o)&&a.__esModule?a:{default:a};var l={init:function(e){var t=i.default.wallet,n=t.enable_notifications,a=t.show_balance;l.bind(e);var o={enable_notifications:n,show_balance:a};window.tommy.tplManager.renderInline("wallet__settingsTemplate",o,e.container)},onInputChange:function(e){var t,n,a,o=e.target,l=o.name,r=o.checked;i.default.updateWalletSettings((t={},n=l,a=r,n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t)).then(function(){"show_balance"===l&&(i.default.wallet.show_balance?$$(".wallet-balance-value").text(i.default.wallet.balance):$$(".wallet-balance-value").text(""))})},bind:function(e){l.page=e,$$(e.container).on("change","input",l.onInputChange)},uninit:function(){l.page&&($$(l.page.container).off("change","input",l.onInputChange),l.page=null,delete l.page)}};n.default=l},{"../api":1}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,o=e("../api"),l=(a=o)&&a.__esModule?a:{default:a};var r={init:function(t){var e=t.query.id;l.default.getWalletTransaction(e).then(function(e){window.tommy.tplManager.renderInline("wallet__transactionDetailsTemplate",e,t.container)})},uninit:function(){}};n.default=r},{"../api":1}],6:[function(e,t,n){"use strict";var a=u(e("./controllers/index")),o=u(e("./controllers/card-details")),l=u(e("./controllers/transaction-details")),r=u(e("./controllers/settings")),i=u(e("./init-wallet-transaction"));function u(e){return e&&e.__esModule?e:{default:e}}var c=window.tommy.app,s=c.f7,d=c.t7;s.onPageInit("wallet__index",a.default.init),s.onPageBeforeRemove("wallet__index",a.default.uninit),s.onPageBeforeInit("wallet__card_details",o.default.init),s.onPageBeforeRemove("wallet__card_details",o.default.uninit),s.onPageInit("wallet__transaction_details",l.default.init),s.onPageBeforeRemove("wallet__transaction_details",l.default.uninit),s.onPageInit("wallet__settings",r.default.init),s.onPageBeforeRemove("wallet__settings",r.default.uninit),d.registerHelper("wallet__formatTransactionAmount",function(e){return("paid"===e.status?"-":"+")+" "+e.amount}),d.registerHelper("wallet__formatTransactionStatus",function(e){return e[0].toUpperCase()+e.substr(1)}),d.registerHelper("wallet__formatTransactionDate",function(e){if(!e)return"";var t=new Date(e),n=t.getFullYear(),a=t.getMonth()+1;a<10&&(a="0"+a);var o=t.getDate();o<10&&(o="0"+o);var l=t.getHours();l<10&&(l="0"+l);var r=t.getMinutes();return r<10&&(r="0"+r),n+"-"+a+"-"+o+" "+l+":"+r}),window.tommy.initWalletTransaction=i.default},{"./controllers/card-details":2,"./controllers/index":3,"./controllers/settings":4,"./controllers/transaction-details":5,"./init-wallet-transaction":7}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){p.popup||p.init(e,t,n)};var a,o=e("./api"),l=(a=o)&&a.__esModule?a:{default:a};var d=window.tommy,p={popup:null,params:null,showLoader:function(){p.$popup.find(".transaction-preloader").length||p.$popup.append('<div class="transaction-preloader"></div>')},hideLoader:function(){p.$popup.find(".transaction-preloader").remove()},clear:function(){p.$popup.remove(),p.popup=null,p.$popup=null,p.params=null,p.onSuccess=null,p.onError=null},create:function(e){var t=e.card_name;p.showLoader(),l.default.createWalletTransaction(e).then(function(e){p.renderSuccess(Object.assign({},e||{},{card_name:t})),p.onSuccess&&p.onSuccess()}).catch(function(e){p.hideLoader(),p.renderError(e),p.onError&&p.onError()})},renderError:function(e){p.$popup;var t=d.tplManager.render("wallet__transactionPopupStatus",{title:window.tommy.i18n.t("transaction_popup.error_title",{defaultValue:"Fail"}),status:"error",message:e.message||""});p.$popup.html(t)},renderSuccess:function(e){p.$popup;var t=e.payee_name,n=e.card_name,a=e.amount,o=d.tplManager.render("wallet__transactionPopupStatus",{title:window.tommy.i18n.t("transaction_popup.success_title",{defaultValue:"Success"}),status:"success",message:window.tommy.i18n.t("transaction_popup.success_message",{defaultValue:"You sent Â¥{{amount}}.<br>To {{to}}<br>From {{from}}",amount:a,to:t,from:n})});p.$popup.html(o)},render:function(){var r=p.$popup,e=p.params,i=e.addon_id,u=e.addon_install_id,c=e.payee_name,s=e.amount;p.showLoader(),l.default.getWalletCards().then(function(e){var t=e[0],n=t.id,a=t.wallet_account_id,o=t.name,l=d.tplManager.render("wallet__transactionPopupDetails",{payee_name:c,amount:s,card_name:o});p.hideLoader(),p.$popup.append(l),r.find(".transaction-popup-confirm-button").on("click",function e(t){t.preventDefault(),r.find(".transaction-popup-confirm-button").off("click",e),p.create({addon_id:i,addon_install_id:u,payee_name:c,amount:s,wallet_card_id:n,wallet_account_id:a,card_name:o})})})},init:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],a=d.app,o=a.f7;a.t7;p.params=e,p.onSuccess=t,p.onError=n;var l=o.popup('\n      <div class="popup tablet-fullscreen wallet__transaction-popup"></div>\n    '),r=$$(l);p.popup=l,(p.$popup=r).on("popup:opened",function(){p.render()}),r.on("popup:closed",function(){p.clear()})}}},{"./api":1}]},{},[6]);