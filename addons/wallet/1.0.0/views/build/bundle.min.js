!function r(i,l,c){function u(n,e){if(!l[n]){if(!i[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(s)return s(n,!0);var a=new Error("Cannot find module '"+n+"'");throw a.code="MODULE_NOT_FOUND",a}var o=l[n]={exports:{}};i[n][0].call(o.exports,function(e){return u(i[n][1][e]||e)},o,o.exports,r,i,l,c)}return l[n].exports}for(var s="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,o=e("./controllers/index");(a=o)&&a.__esModule;var r=window.tommy.api,i={wallet:{},getWallet:function(){return r.call({endpoint:"wallet",method:"GET",data:{}}).then(function(e){return i.wallet=e})},updateWalletSettings:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(n).forEach(function(e){i.wallet[e]=n[e]}),r.call({endpoint:"wallet",method:"PUT",data:n})},getWalletCards:function(){return r.call({endpoint:"wallet/cards",method:"GET",data:{}})},getWalletTransactions:function(e){return r.call({endpoint:"wallet/transactions",method:"GET",data:{card_id:e}}).then(function(e){return e.sort(function(e,n){return new Date(e.paid_at).getTime()<new Date(n.paid_at).getTime()?1:-1})})},getWalletTransaction:function(e){return r.call({endpoint:"wallet/transactions/"+e,method:"GET",data:{}})},getBalanceHistory:function(){},createWalletTransaction:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return r.call({endpoint:"wallet/transactions",method:"POST",data:e})}};t.default=i},{"./controllers/index":3}],2:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,o=e("../api"),r=(a=o)&&a.__esModule?a:{default:a};var i={init:function(n){var e=n.query,t=e.id,a=e.name;a&&$$(n.navbarInnerContainer).find(".center").text(a),r.default.getWalletTransactions(t).then(function(e){window.tommy.tplManager.renderInline("wallet__transactionsListTemplate",{items:e},n.container)})},uninit:function(){}};t.default=i},{"../api":1}],3:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,o=e("../api"),r=(a=o)&&a.__esModule?a:{default:a};var i={init:function(e){console.log("initialize wallet addon"),i.bind(e),i.loadWalletInfo(),i.loadWallets(),i.loadTransactions(),i.loadBalanceHistory(),$$(document).on("wallet:transaction",i.refresh),e.query.back&&$$(e.navbarInnerContainer).find(".left a.open-panel").removeClass("open-panel").addClass("back").html('\n          <i class="icon f7-icons">chevron_left</i>\n        ')},refresh:function(){i.loadWalletInfo(),i.loadWallets(),i.loadTransactions(),i.loadBalanceHistory()},loadWalletInfo:function(){r.default.getWallet().then(function(e){e.show_balance&&$$(i.page.container).find(".wallet-balance-value").text(e.balance)})},loadWallets:function(){r.default.getWalletCards().then(function(e){var n="development"===window.localStorage.env;window.tommy.tplManager.renderInline("wallet__walletsListTemplate",{items:e,showTestButton:n},i.page.container),n&&($$("#wallet__createTestTransaction").on("click",function(){window.tommy.initWalletTransaction({addon_id:26,addon_install_id:8430,payee_name:"Apple / iMac Pro",currency:"CNY",amount:100})}),$$("#wallet__createTestErrorTransaction").on("click",function(){window.tommy.initWalletTransaction({addon_id:26,addon_install_id:8430,payee_name:"Mercedes S600",currency:"USD",amount:1e5})}))})},loadTransactions:function(){r.default.getWalletTransactions().then(function(e){window.tommy.tplManager.renderInline("wallet__transactionsListTemplate",{items:e},i.page.container)})},loadBalanceHistory:function(){},bind:function(e){i.page=e},uninit:function(){i.page=null,delete i.page,$$(document).off("wallet:transaction",i.refresh),console.log("uninitialize wallet addon")}};t.default=i},{"../api":1}],4:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,o=e("../api"),l=(a=o)&&a.__esModule?a:{default:a};var r={init:function(e){var n=l.default.wallet,t=n.enable_notifications,a=n.show_balance;r.bind(e);var o={enable_notifications:t,show_balance:a};window.tommy.tplManager.renderInline("wallet__settingsTemplate",o,e.container)},onInputChange:function(e){var n,t,a,o=e.target,r=o.name,i=o.checked;l.default.updateWalletSettings((n={},t=r,a=i,t in n?Object.defineProperty(n,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[t]=a,n)).then(function(){"show_balance"===r&&(l.default.wallet.show_balance?$$(".wallet-balance-value").text(l.default.wallet.balance):$$(".wallet-balance-value").text(""))})},bind:function(e){r.page=e,$$(e.container).on("change","input",r.onInputChange)},uninit:function(){r.page&&($$(r.page.container).off("change","input",r.onInputChange),r.page=null,delete r.page)}};t.default=r},{"../api":1}],5:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,o=e("../api"),r=(a=o)&&a.__esModule?a:{default:a};var i={init:function(n){var e=n.query.id;r.default.getWalletTransaction(e).then(function(e){window.tommy.tplManager.renderInline("wallet__transactionDetailsTemplate",e,n.container)})},uninit:function(){}};t.default=i},{"../api":1}],6:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&a[e]?a[e]:""};var a={AED:"د.إ",AFN:"؋",ALL:"L",AMD:"֏",ANG:"ƒ",AOA:"Kz",ARS:"$",AUD:"$",AWG:"ƒ",AZN:"₼",BAM:"KM",BBD:"$",BDT:"৳",BGN:"лв",BHD:".د.ب",BIF:"FBu",BMD:"$",BND:"$",BOB:"$b",BRL:"R$",BSD:"$",BTC:"฿",BTN:"Nu.",BWP:"P",BYR:"Br",BYN:"Br",BZD:"BZ$",CAD:"$",CDF:"FC",CHF:"CHF",CLP:"$",CNY:"¥",COP:"$",CRC:"₡",CUC:"$",CUP:"₱",CVE:"$",CZK:"Kč",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"دج",EEK:"kr",EGP:"£",ERN:"Nfk",ETB:"Br",ETH:"Ξ",EUR:"€",FJD:"$",FKP:"£",GBP:"£",GEL:"₾",GGP:"£",GHC:"₵",GHS:"GH₵",GIP:"£",GMD:"D",GNF:"FG",GTQ:"Q",GYD:"$",HKD:"$",HNL:"L",HRK:"kn",HTG:"G",HUF:"Ft",IDR:"Rp",ILS:"₪",IMP:"£",INR:"₹",IQD:"ع.د",IRR:"﷼",ISK:"kr",JEP:"£",JMD:"J$",JOD:"JD",JPY:"¥",KES:"KSh",KGS:"лв",KHR:"៛",KMF:"CF",KPW:"₩",KRW:"₩",KWD:"KD",KYD:"$",KZT:"лв",LAK:"₭",LBP:"£",LKR:"₨",LRD:"$",LSL:"M",LTC:"Ł",LTL:"Lt",LVL:"Ls",LYD:"LD",MAD:"MAD",MDL:"lei",MGA:"Ar",MKD:"ден",MMK:"K",MNT:"₮",MOP:"MOP$",MRO:"UM",MRU:"UM",MUR:"₨",MVR:"Rf",MWK:"MK",MXN:"$",MYR:"RM",MZN:"MT",NAD:"$",NGN:"₦",NIO:"C$",NOK:"kr",NPR:"₨",NZD:"$",OMR:"﷼",PAB:"B/.",PEN:"S/.",PGK:"K",PHP:"₱",PKR:"₨",PLN:"zł",PYG:"Gs",QAR:"﷼",RMB:"￥",RON:"lei",RSD:"Дин.",RUB:"₽",RWF:"R₣",SAR:"﷼",SBD:"$",SCR:"₨",SDG:"ج.س.",SEK:"kr",SGD:"$",SHP:"£",SLL:"Le",SOS:"S",SRD:"$",SSP:"£",STD:"Db",STN:"Db",SVC:"$",SYP:"£",SZL:"E",THB:"฿",TJS:"SM",TMT:"T",TND:"د.ت",TOP:"T$",TRL:"₤",TRY:"₺",TTD:"TT$",TVD:"$",TWD:"NT$",TZS:"TSh",UAH:"₴",UGX:"USh",USD:"$",UYU:"$U",UZS:"лв",VEF:"Bs",VND:"₫",VUV:"VT",WST:"WS$",XAF:"FCFA",XBT:"Ƀ",XCD:"$",XOF:"CFA",XPF:"₣",YER:"﷼",ZAR:"R",ZWD:"Z$"}},{}],7:[function(e,n,t){"use strict";var a=u(e("./controllers/index")),o=u(e("./controllers/card-details")),r=u(e("./controllers/transaction-details")),i=u(e("./controllers/settings")),l=u(e("./init-wallet-transaction")),c=u(e("./currency-map"));function u(e){return e&&e.__esModule?e:{default:e}}var s=window.tommy.app,d=s.f7,p=s.t7;d.onPageInit("wallet__index",a.default.init),d.onPageBeforeRemove("wallet__index",a.default.uninit),d.onPageBeforeInit("wallet__card_details",o.default.init),d.onPageBeforeRemove("wallet__card_details",o.default.uninit),d.onPageInit("wallet__transaction_details",r.default.init),d.onPageBeforeRemove("wallet__transaction_details",r.default.uninit),d.onPageInit("wallet__settings",i.default.init),d.onPageBeforeRemove("wallet__settings",i.default.uninit),p.registerHelper("wallet__formatTransactionAmount",function(e){return("paid"===e.status||"failed"===e.status?"-":"+")+" "+(0,c.default)(e.currency)+e.amount}),p.registerHelper("wallet__currencySymbol",function(e){return(0,c.default)(e)}),p.registerHelper("wallet__formatTransactionStatus",function(e){return e[0].toUpperCase()+e.substr(1)}),p.registerHelper("wallet__formatTransactionDate",function(e){if(!e)return"";var n=new Date(e),t=n.getFullYear(),a=n.getMonth()+1;a<10&&(a="0"+a);var o=n.getDate();o<10&&(o="0"+o);var r=n.getHours();r<10&&(r="0"+r);var i=n.getMinutes();return i<10&&(i="0"+i),t+"-"+a+"-"+o+" "+r+":"+i}),window.tommy.initWalletTransaction=l.default},{"./controllers/card-details":2,"./controllers/index":3,"./controllers/settings":4,"./controllers/transaction-details":5,"./currency-map":6,"./init-wallet-transaction":8}],8:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,n,t){w.cache.popup||w.init(e,n,t)};var _=a(e("./currency-map")),o=a(e("./api"));function a(e){return e&&e.__esModule?e:{default:e}}var m=window.tommy,w={cache:{popup:null,params:null},selectWallet:function(e,n){var t=m.app.f7,a=e.map(function(e){return{text:e.name,onClick:function(){n&&n(e)}}});t.actions(a)},showLoader:function(){w.cache.$popup.find(".transaction-preloader").length||w.cache.$popup.append('<div class="transaction-preloader"></div>')},hideLoader:function(){w.cache.$popup.find(".transaction-preloader").remove()},clear:function(){w.cache.$popup.remove(),w.cache={}},renderError:function(e){var n=w.cache.$popup,t="string"==typeof e?t:e&&e.message||"",a=m.tplManager.render("wallet__transactionPopupStatus",{title:m.i18n.t("transaction_popup.error_title",{defaultValue:"Fail"}),status:"error",message:t});w.cache.onReportBack=function(){return n.html(a)},n.html(a)},renderSuccess:function(e){var n=w.cache.$popup,t=e.payee_name,a=e.card_name,o=e.amount,r=e.currency,i=m.tplManager.render("wallet__transactionPopupStatus",{title:m.i18n.t("transaction_popup.success_title",{defaultValue:"Success"}),status:"success",message:m.i18n.t("transaction_popup.success_message",{defaultValue:"You sent {{currency}}{{amount}}.<br>To {{to}}.<br>From {{from}}.",currency:(0,_.default)(r),amount:o,to:t,from:a})});w.cache.onReportBack=function(){return n.html(i)},n.html(i)},createTransaction:function(t){var a=t.card_name;w.showLoader(),o.default.createWalletTransaction(t).then(function(e){w.hideLoader();var n=Object.assign({},e||{},{card_name:a});(w.cache.transactionDetails=n).status&&"failed"!==n.status?(w.renderSuccess(n),$$(document).trigger("wallet:transaction"),w.cache.onSuccess&&w.cache.onSuccess(n)):"failed"===n.status&&(w.renderError(Object.assign(n,{message:m.i18n.t("transaction_popup.error_insufficient",{defaultValue:"Sorry. Your Tommy account balance is insufficient. Please use other payment methods"})})),w.cache.onError&&w.cache.onError(n))},function(e){var n=Object.assign({},t,{status:"failed"});w.hideLoader(),w.cache.transactionDetails=n,w.renderError(e),w.cache.onError&&w.cache.onError(e)})},viewReport:function(){var e=m.app.f7,n=w.cache,t=n.$popup,a=n.transactionDetails,o='\n      <div class="page navbar-fixed">\n        <div class="navbar no-border">\n          <div class="navbar-inner">\n            <div class="left">\n              <a href="#" class="link icon-only transaction-popup-report-back"><i class="icon f7-icons">chevron_left</i></a>\n            </div>\n            <div class="center">'+m.i18n.t("transaction_details.title",{defaultValue:"Transaction Details"})+'</div>\n            <div class="right">\n              <a href="#" class="link icon-only close-popup" data-popup=".wallet__transaction-popup">\n                <i class="icon f7-icons">close</i>\n              </a>\n            </div>\n          </div>\n        </div>\n        <div class="page-content transaction-popup-fade-in">\n         '+m.tplManager.render("wallet__transactionDetailsTemplate",a)+"\n        </div>\n      </div>\n    ";t.html(o),e.sizeNavbars(t)},render:function(){var n=m.app.f7,e=w.cache,l=e.$popup,t=e.params,c=t.addon,u=t.addon_id,s=t.addon_install_id,d=t.payee_name,p=t.amount,f=t.currency;w.showLoader(),o.default.getWalletCards().then(function(e){var n=1<e.length,t=e[0],a=t.id,o=t.wallet_account_id,r=t.name,i=m.tplManager.render("wallet__transactionPopupDetails",{payee_name:d,currency:(0,_.default)(f),amount:p,card_name:r,multiple:n});w.hideLoader(),l.append(i),l.on("click",".transaction-popup-select-wallet",function(){n&&w.selectWallet(e,function(e){r=e.name,a=e.id,o=e.wallet_account_id,l.find(".transaction-popup-select-wallet").text(r)})}),l.once("click",".transaction-popup-confirm-button",function(){w.createTransaction({addon:c,addon_id:u,addon_install_id:s,payee_name:d,currency:f,amount:p,wallet_card_id:a,wallet_account_id:o,card_name:r})}),l.on("click",".transaction-popup-report-button",function(){l.addClass("transaction-popup-status-rendered"),w.viewReport()}),l.on("click",".transaction-popup-report-back",function(){w.cache.onReportBack&&w.cache.onReportBack()})}).catch(function(e){n.closeModal(".wallet__transaction-popup")})},init:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],t=arguments[2],a=m.app.f7;w.cache.params=e,w.cache.onSuccess=n,w.cache.onError=t;var o=a.popup('\n      <div class="popup tablet-fullscreen wallet__transaction-popup"></div>\n    '),r=$$(o);w.cache.popup=o,(w.cache.$popup=r).on("popup:opened",function(){w.render()}),r.on("popup:closed",function(){w.clear()})}}},{"./api":1,"./currency-map":6}]},{},[7]);