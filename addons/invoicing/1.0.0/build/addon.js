var addon=function(t){var e={};function i(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([,function(t,e,i){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach((function(e){o(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{id:"invoicing__index",name:"invoicing__index"}},[i("f7-navbar",[i("tommy-nav-menu"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.pageTitle))]),t._v(" "),t.isNurse?t._e():i("f7-nav-right",[i("f7-link",{attrs:{href:"/invoicing/settings/","icon-f7":"gear"}}),t._v(" "),i("f7-link",{attrs:{href:"/invoicing/order-details/","icon-f7":"add"}})],1)],1),t._v(" "),t.orderedLists&&t.orderedLists.length?i("f7-swiper",{staticClass:"no-swipe-panel",attrs:{params:{slidesPerView:"auto",breakpointsInverse:!0,centeredSlides:!1,touchMoveStopPropagation:!1,on:{tap:t.onSlideClick},breakpoints:{768:{centeredSlides:!0}}}}},t._l(t.orderedLists,(function(e){return i("f7-swiper-slide",{key:e.id},[i("div",{staticClass:"orders-list",class:{hasScroll:t.listWithScroll[e.id]},attrs:{"data-id":e.id}},[i("div",{staticClass:"orders-list-header"},[i("div",[t._v(t._s(e.name))]),t._v(" "),i("div",{staticClass:"order-list-header-right"},[t.canEditList(e)?i("a",{attrs:{"data-url":"/invoicing/list-edit/"+e.id+"/"}},[i("img",{attrs:{src:t.$addonAssetsUrl+"slice6.png",srcset:t.$addonAssetsUrl+"slice6@2x.png 2x, "+t.$addonAssetsUrl+"slice6@3x.png 3x"}})]):t._e(),t._v(" "),t.canEditList(e)&&0<e.orders.length?i("a",{ref:"download",refInFor:!0,on:{click:function(i){return t.makeCSV(e.orders,e.name)}}},[i("img",{attrs:{src:t.$addonAssetsUrl+"download.svg"}})]):t._e()])]),t._v(" "),i("div",{staticClass:"orders-list-content"},[e.orders&&e.orders.length?t._l(e.orders,(function(e,n){return i("a",{key:n,staticClass:"card invoicing-order-card",attrs:{"data-url":"/invoicing/order-details/"+e.id+"/"}},[i("div",{staticClass:"card-header"},[e.data&&e.data.date?i("span",{staticClass:"order-date"},[t._v(t._s(t.orderDate(e.data?e.data.date:null)))]):t._e(),t._v(" "),t.isNurse?t._e():i("span",{staticClass:"order-status"},[t._v(t._s(t.$t("invoicing.order_status."+e.status)))])]),t._v(" "),i("div",{staticClass:"card-content"},[i("f7-list",{staticClass:"no-hairlines no-hairlines-between"},[e.user_id?i("f7-list-item",{attrs:{title:t.orderUserName(e.user_id)}},[i("img",{attrs:{slot:"media",src:t.$addonAssetsUrl+"icon-user.svg"},slot:"media"})]):t._e(),t._v(" "),i("f7-list-item",{attrs:{title:e.name}},[i("img",{attrs:{slot:"media",src:t.$addonAssetsUrl+"icon-product.svg"},slot:"media"})]),t._v(" "),e.total&&!t.isNurse?i("f7-list-item",{attrs:{title:e.total}},[i("img",{attrs:{slot:"media",src:t.$addonAssetsUrl+"icon-money.svg"},slot:"media"})]):t._e(),t._v(" "),e.data&&e.data.location?i("f7-list-item",{attrs:{title:e.data.location.address+" "+e.data.location.city}},[i("img",{attrs:{slot:"media",src:t.$addonAssetsUrl+"icon-location.svg"},slot:"media"})]):t._e()],1)],1)])})):t._e()],2)])])})),1):t._e()],1)}i.r(e);var c=window.tommy,l=c.api,d={actor:void 0,actorId:void 0,isNurse:!1,assignee_id:null,contacts:null,loadOrder:function(t){var e={with_filters:!0,with_permission_to:!0,actor_id:d.actorId};return l.call({endpoint:"vendor/manager/orders/".concat(t),data:e})},saveOrder:function(t){return l.call({method:t.id?"PUT":"POST",endpoint:"vendor/manager/orders/".concat(t.id||""),data:t})},cancelOrder:function(t){return l.call({endpoint:"vendor/manager/orders/".concat(t.id),method:"DELETE"})},loadListOrders:function(t){var e=[];if(t.data&&t.filters)for(var i=0;i<t.filters.length;i+=1)e.indexOf(t.filters[i].name)<0&&e.push(t.filters[i].name);var n={tags:e,with_filters:!0,with_permission_to:!0,actor_id:d.actorId,assignee_id:d.assignee_id||void 0};return t.data.date_range&&(n.date_range=t.data.date_range,Array.isArray(n.date_range)&&(n.date_range=n.date_range.map((function(t){return t/1e3})))),t.data.status?n.status=t.data.status:d.assignee_id&&(n.status=["complete","paid","processing"]),t.data.sort&&(n.sort=t.data.sort),t.data.price_min&&(n.price_min=t.data.price_min),t.data.price_max&&(n.price_max=t.data.price_max),t.data.balance_min&&(n.balance_min=t.data.balance_min),t.data.balance_max&&(n.balance_max=t.data.balance_max),"invoice"===t.data.type&&(n.invoices=!0),"quote"===t.data.type&&(n.quotes=!0),t.data.customer&&(n.user_id=t.data.customer),t.data.only_assigned?n.assignee_id=d.actorId||c.root.user.id:t.data.assignee&&(n.assignee_id=t.data.assignee),void 0!==t.data.canceled&&(n.canceled=t.data.canceled),n.data=JSON.stringify(n.data),l.call({endpoint:"/vendor/manager/orders",data:n})},loadList:function(t){return l.getFragment(t,{data:{addon:"invoicing",kind:"OrderList",with_filters:!0,with_permission_to:!0}})},loadLists:function(t,e){var i=0<arguments.length&&void 0!==t?t:{},n=1<arguments.length&&void 0!==e?e:{},a=Object.assign({addon:"invoicing",kind:"OrderList",with_filters:!0,with_permission_to:!0,actor_id:d.actorId,user_id:d.actorId,only_owned:!d.actorId&&!d.isNurse},i);return d.actorId||d.isNurse||void 0!==a.only_owned||(a.only_owned=!0),l.getFragments(a,n)},deleteList:function(t,e){return l.deleteFragment(t,{data:e})},saveList:function(t){t.addon="invoicing",t.kind="OrderList",t.with_filters=!0,t.with_permission_to=!0,t.data||(t.data={}),void 0===t.data.position&&(t.data.position=0),void 0===t.data.active&&(t.data.active=!0),t.id||(t.with_permissions=["order_list_read_access","order_list_edit_access"]);var e=Object.assign({},t,{data:JSON.stringify(t.data),filters:JSON.stringify(t.filters)});return t.id?l.updateFragment(t.id,e):l.createFragment(e)},createDefaultList:function(){var t={name:c.i18n.t("invoicing.index.default_list_name"),data:{default:!0},filters:[]};return d.saveList(t)},loadPromotions:function(){return l.call({endpoint:"vendor/manager/coupons",method:"GET",cache:!1})},loadPromotion:function(t){return l.call({endpoint:"vendor/manager/coupons/".concat(t),method:"GET",cache:!1})},savePromotion:function(t){return l.call({endpoint:"vendor/manager/coupons/".concat(t.id||""),method:t.id?"PUT":"POST",data:t,dataType:"json",contentType:"application/json",processData:!1})},loadProducts:function(){return l.call({endpoint:"vendor/manager/products",method:"GET",cache:!1})},loadProduct:function(t){return l.call({endpoint:"vendor/manager/products/".concat(t),method:"GET",cache:!1})},saveProduct:function(t,e){var i=new FormData,a=r({},t);return a.data&&"object"===n(a.data)&&(a.data=r({},a.data)),Object.keys(a).forEach((function(t){var e=a[t];if(null===e&&(e=""),"null"===e&&(e=""),("data"===t||"filters"===t||"vendor_product_ids"===t)&&e||Array.isArray(e))return"string"==typeof e&&"[object Object]"!==e&&(e=JSON.parse(e)),"[object Object]"===e?(e="",void i.append(t,e)):Array.isArray(e)&&!e.length?(e=null,void i.append(t,e)):void(Object.keys(e).length?e=c.app.f7.utils.serializeObject(o({},t,e)).split("&").forEach((function(t){i.append(t.split("=")[0],decodeURIComponent(t.split("=")[1]))})):(e="",i.append(t,e)));"image"!==t||e||(e=null),"image_url"!==t||e||(e=null),i.append(t,e)})),l.call({endpoint:"vendor/manager/".concat(e?"packages":"products","/").concat(t.id||""),method:t.id?"PUT":"POST",data:i,contentType:"multipart/form-data"})},loadPackages:function(t,e){return l.call({endpoint:"vendor/manager/packages",method:"GET",cache:!1})},loadPackage:function(t){return l.call({endpoint:"vendor/manager/packages/".concat(t),method:"GET",cache:!1})}},u=d;function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e,i,n,a,r,o,s){var c,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=i,l._compiled=!0),n&&(l.functional=!0),r&&(l._scopeId="data-v-"+r),o?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},l._ssrRegister=c):a&&(c=s?function(){a.call(this,this.$root.$options.shadowRoot)}:a),c)if(l.functional){l._injectStyles=c;var d=l.render;l.render=function(t,e){return c.call(e),d(t,e)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return{exports:t,options:l}}s._withStripped=!0;var _=m({data:function(){var t,e=this,i=e.$f7route.query.actor_id,n=(t=(t=i?e.$root.teamMembers.filter((function(t){return t.user_id===parseInt(e.actorId,10)}))[0]:e.$root.account)||e.$root.account).roles;return u.isNurse=!n||n&&0===n.length||n&&(0<=n.indexOf("Nurse")||0<=n.indexOf("Employee")),u.assignee_id=u.isNurse?t.user_id:null,{lists:null,actorId:i,listWithScroll:{},isNurse:u.isNurse,contacts:u.contacts,orderContacts:{},orderContactsLoading:{},csvKeys:[],csvValues:[],promotions:null}},created:function(){this.actorId?(u.actorId=parseInt(this.actorId,10),u.actor=this.actor,u.actor.roles&&(0<=u.actor.roles.indexOf("Nurse")||0<=u.actor.roles.indexOf("Employee"))&&(u.isNurse=!0,this.isNurse=!0,u.assignee_id=u.actor.user_id)):(delete u.actorId,delete u.actor)},computed:{actor:function(){var t=this;return t.actorId?t.$root.teamMembers.filter((function(e){return e.user_id===parseInt(t.actorId,10)}))[0]:null},pageTitle:function(){var t=this;if(!t.actorId)return t.$t("invoicing.index.title","Orders");var e=t.$root.teamMembers.filter((function(e){return e.user_id===parseInt(t.actorId,10)}))[0].first_name;return t.$t("invoicing.index.title_user",{user:e})},orderedLists:function(){return this.lists?this.lists.sort((function(t,e){return t.data.position-e.data.position})).filter((function(t){return t.data.active})):null}},methods:{makeCSV:function(t,e){var i=this,n=this,a=["OrderId","Status","NurseName","CreateTime","BookingTime","Amount","Hours","City","Address","CustomerName","CouponName","CouponDiscount","Payment Method","Clock In Time","Clock Out Time","Question 1","Question 2","Question 3","Pending","Paid","Processing","QA","Complete","Canceled","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];Promise.all(t.map((function(t){return u.loadOrder(t.id)}))).then((function(r){for(var o=[],s={QA:0,complete:0,paid:0,pending:0,processing:0,canceled:0},c=[0,0,0,0,0,0,0,0,0,0,0,0],l=0;l<t.length;l++){var d=[],u=t[l];d.push(u.id),u.canceled?d.push("canceled "+u.status):d.push(u.status);var v=u.assignee_id?i.getAssigneeName(u.assignee_id):"null";d.push(v);var m=n.$moment(u.created_at).format("YYYY/MM/DD HH:mm");d.push(m),d.push(i.orderDate(+u.data.date).toLocaleString()),d.push(r[l].total),d.push(r[l].data.duration/60||0),d.push('"'+u.data.location.city+'"'),d.push('"'+u.data.location.address+'"'),d.push(i.orderUserName(u.user_id));var _=u.vendor_coupon_id,p=_?i.promotionName(_):"null";d.push('"'+p+'"');var f=_?i.promotionDiscount(_):0;d.push('"'+f+'"'),d.push('"'+u.data.payment_method+'"'||!1);var g=r[l].data.feedback;if(g){var h=g.actual_start_date?n.$moment(g.actual_start_date).format("YYYY/MM/DD HH:mm"):" ";d.push(h);var b=g.actual_start_date?n.$moment(g.actual_end_date).format("YYYY/MM/DD HH:mm"):" ";d.push(b),d.push(g.question1||" "),d.push(g.question2||" "),d.push(g.question3||" ")}else d.push(" "),d.push(" "),d.push(" "),d.push(" "),d.push(" ");if(Array.isArray(u.status))for(var k=0;k<u.status.length;k++)s[u.status[k]]++;else s[u.status]++;u.canceled&&s.canceled++,d.push(s.pending),d.push(s.paid),d.push(s.processing),d.push(s.QA),d.push(s.complete),d.push(s.canceled),c[new Date(u.created_at).getMonth()]++,d.push.apply(d,c),o.push(d)}var y=a.join(",")+"\n"+o.map((function(t){return t.join(",")})).join("\n");i.triggerDownload(e,y)}))},triggerDownload:function(t,e){var i="".concat(t,".csv"),n=document.createElement("a");n.href="data:attachment/csv;charset=utf-8,".concat("\ufeff").concat(encodeURIComponent(e)),n.target="_blank",n.download=i,n.click()},downloadCSV:function(t,e){var i=this;t.forEach((function(t,e){i.traversalObject(t,e,!0),i.csvValues[i.csvValues.length-1]+="\n"}));var n="".concat(this.csvKeys.join(","),"\n").concat(this.csvValues.join(",").replace(/\n,/g,"\n")),a="".concat(e,".csv"),r=document.createElement("a");r.href="data:attachment/csv;charset=utf-8,".concat("\ufeff").concat(encodeURIComponent(n)),r.target="_blank",r.download=a,r.click()},traversalObject:function(t,e,i){var n=2<arguments.length&&void 0!==i&&i;for(var a in t)if("object"===v(t[a])&&null!==t[a])this.traversalObject(t[a],e);else if("id"===a||"user_id"===a)0===e&&n&&this.csvKeys.push(a),n&&("user_id"===a&&(t[a]=this.orderUserName(t[a])),this.csvValues.push(t[a]));else if("date"===a)0===e&&this.csvKeys.push(a),this.csvValues.push(this.orderDate(t[a]));else if("assignee_id"===a){0===e&&this.csvKeys.push(a);var r=t[a]?this.getAssigneeName(t[a]):"null";this.csvValues.push(r)}else if("vendor_coupon_id"===a){0===e&&this.csvKeys.push("couponName","couponDiscount");var o=t[a]?this.promotionName(t[a]):"null",s=t[a]?this.promotionDiscount(t[a]):"null";this.csvValues.push(o,s)}else"status"!==a&&"city"!==a&&"created_at"!==a&&"total"!==a&&"address"!==a||(0===e&&this.csvKeys.push(a),"string"==typeof t[a]&&(t[a]=t[a].split(",").join(" ")),this.csvValues.push(t[a]?t[a]:"null"))},getAssigneeName:function(t){var e=this.$root.teamMembers.filter((function(e){return e.user_id===parseInt(t,10)}))[0];return e?e.last_name+e.first_name:"null"},onSlideClick:function(t){var e=this.$$(t.target).closest("a").eq(0).attr("data-url");e&&this.$f7router.navigate(e)},humanTime:function(t){var e=window.tommy.moment,i=e.utc(t).toDate();if(e(i).isValid()){var n=e().diff(e(i),"days");if(1===n)return"Yesterday ".concat(e(i).format("h:mm A"));if(0===n)return"Today ".concat(e(i).format("h:mm A"));if(-1===n)return"Yesterday ".concat(e(i).format("h:mm A"));if(1<=n&&n<=8||-8<=n&&n<=-1)return e(i).format("ddd h:mm A");if(365<=n||n<=-365)return e(i).format("MMM D, YYYY h:mm A");if(8<=n||n<=-8)return e(i).format("MMM D h:mm A")}return"None"},orderDate:function(t){return t?this.$moment(parseInt(t,10)).format("YYYY/MM/DD HH:mm"):""},orderUserName:function(t){var e,i=this;return i.isNurse&&(e=i.orderContacts[t]),!(e=e||i.$root.teamMembers.filter((function(e){return e.user_id===parseInt(t,10)}))[0])&&i.contacts&&i.contacts.length&&(e=i.contacts.filter((function(e){return e.friend_id===parseInt(t,10)}))[0]),e?e.name||"".concat(e.first_name||""," ").concat(e.last_name||""):""},listHasScroll:function(t){if(!t.orders||0===t.orders.length)return!1;var e=this.$$('.orders-list[data-id="'.concat(t.id,'"] .orders-list-content'))[0];return!!e&&e.scrollHeight>e.offsetHeight},loadListOrders:function(t){var e=this;u.loadListOrders(t).then((function(i){(t.orders=i).forEach((function(t){e.isNurse&&(e.orderContacts[t.user_id]||e.orderContactsLoading[t.user_id]||(e.orderContacts[t.user_id]={},e.orderContactsLoading[t.user_id]=!0,e.$api.getContact(t.user_id).then((function(i){e.orderContacts[t.user_id]=i,e.orderContactsLoading[t.user_id]=!1,e.$forceUpdate()}))))})),e.$nextTick((function(){e.listHasScroll(t)?e.$set(e.listWithScroll,t.id,!0):e.$set(e.listWithScroll,t.id,!1)}))}))},reloadListsOrders:function(){var t=this;t.lists&&t.lists.forEach((function(e){t.loadListOrders(e)}))},loadLists:function(t,e){var i=!(1<arguments.length&&void 0!==e)||e,n=this;u.loadLists({},{cache:!t}).then((function(t){t.forEach((function(t){t.orders=[]})),n.lists=t,!n.lists.length&&i?u.createDefaultList(n.$root.user).then((function(){n.loadLists(!0,!1)})).catch((function(){n.loadLists(!0,!1)})):n.lists.forEach((function(t){t.data.active&&n.loadListOrders(t)}))}))},reloadLists:function(){this.loadLists(!0)},canEditList:function(t){if(this.isNurse&&!this.actorId)return!1;var e=this.$root.account,i="Team"===e.type||"TeamMember"===e.type||0<=e.roles.indexOf("Team Manager"),n=0<=e.roles.indexOf("Team Manager");return!(!t.data.default||!n)||(!t.data.default||i)&&-1!==t.permission_to.indexOf("update")},promotionName:function(t){return this.promotions.filter((function(e){return e.id===parseInt(t,10)}))[0].name},promotionDiscount:function(t){var e=this.promotions.filter((function(e){return e.id===parseInt(t,10)}))[0];return e?"percentage"!==e.kind?e.amount:this.orderItemsTotal*e.amount||0:0}},beforeDestroy:function(){this.$events.$off("invoicing:reloadListsOrders",this.reloadListsOrders),this.$events.$off("invoicing:reloadLists",this.reloadLists)},mounted:function(){var t=this;t.loadLists(),u.contacts||t.$api.getContacts().then((function(e){t.contacts=e,u.contacts=e})),t.$events.$on("invoicing:reloadListsOrders",t.reloadListsOrders),t.$events.$on("invoicing:reloadLists",t.reloadLists),u.loadPromotions().then((function(e){t.promotions=e}))}},s,[],!1,null,null,null);function p(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{id:"invoicing__settings","data-name":"invoicing__settings"}},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.$t("invoicing.settings.title","Settings")))])],1),t._v(" "),i("f7-list",{staticClass:"list-custom"},[i("f7-list-item",{attrs:{link:"/invoicing/list-management/",title:t.$t("invoicing.settings.list_management","List Management")}}),t._v(" "),t.isNurse?t._e():i("f7-list-item",{attrs:{link:"/invoicing/item-service-management/",title:t.$t("invoicing.settings.item_service_management","Item/Service Management")}}),t._v(" "),t.isNurse?t._e():i("f7-list-item",{attrs:{link:"/invoicing/promotion-management/",title:t.$t("invoicing.settings.promotion_management","Promotion Management")}})],1)],1)}_.options.__file="addons/invoicing/1.0.0/src/pages/index.vue";var f=_.exports;p._withStripped=!0;var g=m({data:function(){return{isNurse:u.isNurse}}},p,[],!1,null,null,null);function h(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{name:"invoicing__item-service-management",id:"invoicing__item-service-management"}},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.$t("invoicing.item_service_management.title","Items / Service")))]),t._v(" "),i("f7-nav-right",[i("f7-link",{attrs:{"icon-f7":"add"},on:{click:t.addItem}})],1)],1),t._v(" "),i("div",{staticClass:"item-service-tabs-links"},[i("f7-link",{class:{active:"items"===t.activeTab},on:{click:function(e){t.activeTab="items"}}},[t._v(t._s(t.$t("invoicing.item_service_management.items_tab")))]),t._v(" "),i("f7-link",{class:{active:"packages"===t.activeTab},on:{click:function(e){t.activeTab="packages"}}},[t._v(t._s(t.$t("invoicing.item_service_management.packages_tab")))])],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"items"===t.activeTab,expression:"activeTab === 'items'"}],staticClass:"item-service-tab"},[t.items&&t.items.length?i("f7-searchbar",{attrs:{"search-container":".invoicing-list-items",backdrop:!1,"disable-button":!1,placeholder:t.$t("invoicing.item_service_management.search_items")}}):t._e(),t._v(" "),t.items&&t.items.length?i("f7-list",{staticClass:"list-custom invoicing-list-items",attrs:{"no-hairlines":""}},t._l(t.orderedProducts,(function(t){return i("f7-list-item",{key:t.id,attrs:{title:t.name,link:"/invoicing/product-details/"+t.id+"/?title="+(t.name||"")}})})),1):t._e()],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"packages"===t.activeTab,expression:"activeTab === 'packages'"}],staticClass:"item-service-tab"},[t.packages&&t.packages.length?i("f7-searchbar",{attrs:{"search-container":".invoicing-list-packages",backdrop:!1,"disable-button":!1,placeholder:t.$t("invoicing.item_service_management.search_packages")}}):t._e(),t._v(" "),t.packages&&t.packages.length?i("f7-list",{staticClass:"list-custom invoicing-list-packages",attrs:{"no-hairlines":""}},t._l(t.orderedPackages,(function(t){return i("f7-list-item",{key:t.id,attrs:{title:t.name,link:"/invoicing/package-details/"+t.id+"/?title="+(t.name||"")}})})),1):t._e()],1)],1)}g.options.__file="addons/invoicing/1.0.0/src/pages/settings.vue";var b=g.exports;h._withStripped=!0;var k=m({data:function(){return{items:null,packages:null,activeTab:"items"}},mounted:function(){var t=this;t.loadProducts(),t.loadPackages(),t.$events.$on("invoicing:reloadProducts",t.loadProducts),t.$events.$on("invoicing:reloadPackages",t.loadPackages)},beforeDestroy:function(){this.$events.$off("invoicing:reloadProducts",this.loadProducts),this.$events.$off("invoicing:reloadPackages",this.loadPackages)},computed:{orderedProducts:function(){return this.items?this.items.sort((function(t,e){return t.id-e.id})):[]},orderedPackages:function(){return this.packages?this.packages.sort((function(t,e){return t.id-e.id})):[]}},methods:{addItem:function(){"items"===this.activeTab?this.$f7router.navigate("/invoicing/product-details/"):this.$f7router.navigate("/invoicing/package-details/")},loadPackages:function(){var t=this;u.loadPackages({},{cache:!1}).then((function(e){t.packages=e}))},loadProducts:function(){var t=this;u.loadProducts({},{cache:!1}).then((function(e){t.items=e}))},add:function(){}}},h,[],!1,null,null,null);function y(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{name:"invoicing__list-management",id:"invoicing__list-management"}},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.$t("invoicing.list_management.title","List Management")))]),t._v(" "),i("f7-nav-right",[t.showSave?i("f7-link",{attrs:{"icon-f7":"check"},on:{click:t.save}}):t._e()],1)],1),t._v(" "),t.lists?i("f7-list",{staticClass:"list-custom",attrs:{sortable:"",sortableEnabled:"",inset:""},on:{"sortable:sort":t.onSort}},t._l(t.orderedLists,(function(e){return i("f7-list-item",{key:e.id,attrs:{checkbox:"",checked:e.data.active,title:e.name},on:{change:function(i){return t.toggleListActive(e,i.target.checked)}}})})),1):t._e(),t._v(" "),i("f7-list",{staticClass:"list-custom margin-bottom",attrs:{inset:""}},[i("f7-list-item",{attrs:{link:"/invoicing/list-add/",title:t.$t("invoicing.list_management.create_list","Create New List")}})],1)],1)}k.options.__file="addons/invoicing/1.0.0/src/pages/item-service-management.vue";var $=k.exports;function C(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}y._withStripped=!0;var S=m({data:function(){return{saving:!1,showSave:!1,lists:null}},mounted:function(){var t=this;u.loadLists({},{cache:!1}).then((function(e){t.lists=e}))},computed:{orderedLists:function(){return this.lists?this.lists.sort((function(t,e){return t.data.position-e.data.position})):null}},methods:{onSort:function(t,e){var i=1<arguments.length&&void 0!==e?e:{},n=i.from,a=i.to,r=this;r.saving||(r.showSave=!0,r.$nextTick((function(){var t;r.lists[n].data.position=a,(t=r.lists).splice.apply(t,[a,0].concat(C(r.lists.splice(n,1)))),r.$forceUpdate()})))},toggleListActive:function(t,e){this.saving||(this.showSave=!0,t.data.active=e)},save:function(){var t=this;t.showSave=!1;var e=[];t.lists.forEach((function(t,i){t.data.position=i,e.push(u.saveList(t))})),Promise.all(e).then((function(){t.$events.$emit("invoicing:reloadLists"),t.$f7router.back()}))}}},y,[],!1,null,null,null);function w(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{name:"invoicing__list-add",id:"invoicing__list-add"}},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.$t("invoicing.list_add.title","Add List")))]),t._v(" "),i("f7-nav-right",[t.showSave?i("f7-link",{attrs:{"icon-f7":"check"},on:{click:t.save}}):t._e()],1)],1),t._v(" "),i("f7-list",{staticClass:"top-0 list-custom"},[i("f7-list-item",[i("f7-input",{attrs:{type:"text",placeholder:t.$t("invoicing.list_add.name_placeholder","Name"),value:t.name},on:{input:function(e){t.name=e.target.value}}})],1)],1)],1)}S.options.__file="addons/invoicing/1.0.0/src/pages/list-management.vue";var O=S.exports;w._withStripped=!0;var P=m({data:function(){return{saving:!1,name:""}},computed:{showSave:function(){return this.name.trim().length}},methods:{save:function(){var t=this;t.saving||(t.saving=!0,u.saveList({name:t.name}).then((function(){t.$events.$emit("invoicing:reloadLists"),t.$f7router.back("/invoicing/".concat(u.actorId?"?actor_id=".concat(u.actorId):""),{force:!0})})))}}},w,[],!1,null,null,null);function x(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{name:"invoicing__list-edit",id:"invoicing__list-edit"}},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.$t("invoicing.list_edit.title","Edit List")))]),t._v(" "),i("f7-nav-right",[t.showSave?i("f7-link",{attrs:{"icon-f7":"check"},on:{click:t.save}}):t._e()],1)],1),t._v(" "),t.list?i("f7-list",{staticClass:"list-custom"},[i("f7-list-item",[i("f7-label",[t._v(t._s(t.$t("invoicing.list_edit.name","Name")))]),t._v(" "),i("f7-input",{attrs:{type:"text",value:t.list.name},on:{input:function(e){return t.onNameChange(e.target.value)}}})],1),t._v(" "),i("f7-list-item",{attrs:{"smart-select":"","smart-select-params":{closeOnSelect:!0},title:t.$t("invoicing.list_edit.sort","Sort")}},[i("select",{staticClass:"toggle-save",attrs:{name:"sort"},on:{change:t.onSortChange}},t._l(["default","price_high","price_low","newest"],(function(e,n){return i("option",{key:n,domProps:{value:e,selected:t.list.data.sort===e||"default"===e&&!t.list.data.sort}},[t._v(t._s(t.$t("invoicing.list_edit.sort_"+e)))])})),0)]),t._v(" "),i("f7-list-item",{attrs:{link:"#",title:t.$t("invoicing.common.date_range","Date Range"),after:t.formatDateRange(t.list.data.date_range)},on:{click:t.showDateRange}}),t._v(" "),i("f7-list-item",{attrs:{"smart-select":"","smart-select-params":{openIn:"popover",closeOnSelect:!0},title:t.$t("invoicing.list_edit.filter_status","Status")}},[i("select",{staticClass:"toggle-save",attrs:{name:"statuses",multiple:""},on:{change:t.onStatusChange}},t._l(t.orderStatuses,(function(e,n){return i("option",{key:n,domProps:{value:e,selected:0<=t.list.data.status.indexOf(e)||!t.list.data.status}},[t._v(t._s(t.$t("invoicing.order_status."+e)))])})),0)]),t._v(" "),i("f7-list-item",{attrs:{"smart-select":"","smart-select-params":{openIn:"popover",closeOnSelect:!0},title:t.$t("invoicing.list_edit.type")}},[i("select",{attrs:{name:"type"},on:{change:t.onTypeChange}},[i("option",{attrs:{value:"all"},domProps:{selected:"all"===t.list.data.type||!t.list.data.type}},[t._v(t._s(t.$t("invoicing.list_edit.type_all")))]),t._v(" "),i("option",{attrs:{value:"invoice"},domProps:{selected:"invoice"===t.list.data.type}},[t._v(t._s(t.$t("invoicing.list_edit.type_invoice")))]),t._v(" "),i("option",{attrs:{value:"quote"},domProps:{selected:"quote"===t.list.data.type}},[t._v(t._s(t.$t("invoicing.list_edit.type_quote")))])])]),t._v(" "),i("f7-list-item",{attrs:{link:"",title:t.$t("invoicing.list_edit.payment_range"),after:void 0!==t.list.data.price_min&&void 0!==t.list.data.price_max?t.list.data.price_min+" - "+t.list.data.price_max:""},on:{click:t.showPaymentRange}}),t._v(" "),t.$root.team&&t.$root.teamMembers&&!t.list.data.only_assigned?i("f7-list-item",{attrs:{"smart-select":"","smart-select-params":{searchbar:!0},title:t.$t("invoicing.list_edit.assignee","Assignee")}},[i("select",{attrs:{name:"assignee",multiple:""},on:{change:t.onAssigneeChange}},t._l(t.$root.teamMembers,(function(e){return i("option",{key:e.id,attrs:{"data-option-class":"invoicing-smart-select-option","data-option-image":e.icon_url},domProps:{value:e.user_id,selected:0<=t.list.data.assignee.indexOf(e.user_id)}},[t._v(t._s(e.first_name||"")+" "+t._s(e.last_name||""))])})),0)]):t._e(),t._v(" "),t.contacts?i("f7-list-item",{attrs:{"smart-select":"","smart-select-params":{searchbar:!0},title:t.$t("invoicing.list_edit.customer","Customer")}},[i("select",{attrs:{name:"customer",multiple:""},on:{change:t.onCustomerChange}},t._l(t.contacts,(function(e,n){return i("option",{key:n+"-"+e.id+"-"+e.friend_id,attrs:{"data-option-class":"invoicing-smart-select-option","data-option-image":e.icon_url},domProps:{value:e.friend_id,selected:0<=t.list.data.customer.indexOf(e.friend_id)}},[t._v(t._s(e.name||(e.first_name||"")+" "+(e.last_name||"")))])})),0)]):t._e(),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.list_edit.only_assigned","Show only assigned")}},[i("f7-toggle",{attrs:{slot:"after",checked:!!t.list.data.only_assigned},on:{change:function(e){return t.setOnlyAssigned(e.target.checked)}},slot:"after"})],1),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.list_edit.include_canceled","Include cancelled orders")}},[i("f7-toggle",{attrs:{slot:"after",checked:!!t.list.data.canceled},on:{change:function(e){return t.setCanceled(e.target.checked)}},slot:"after"})],1),t._v(" "),t._l(t.permissions,(function(e,n){return i("tag-select",{key:n,attrs:{listId:t.list.id,data:{title:t.$t("invoicing.permissions."+e.name+".title"),placeholder:t.$t("invoicing.common.search_members_tags","Search Members, Tags"),pageTitle:t.$t("invoicing.common.search_members_tags","Search Members, Tags"),tags:e.filters}},on:{tagAdd:function(i){return t.addListPermission(e,i)},tagRemove:function(i){return t.removeListPermission(e,i)}}})}))],2):t._e(),t._v(" "),t.list?i("f7-list",{staticClass:"margin-top"},[i("f7-list-button",{staticClass:"color-custom",attrs:{color:"custom"},on:{click:t.deleteList}},[t._v(t._s(t.$t("invoicing.list_edit.delete-list","Delete List")))])],1):t._e()],1)}P.options.__file="addons/invoicing/1.0.0/src/pages/list-add.vue";var T=P.exports,D=["pending","paid","processing","qa","complete"];function I(t){var e=new Date(t),i=e.getFullYear(),n=e.getMonth()+1,a=e.getDate();return n<10&&(n="0".concat(n)),a<10&&(a="0".concat(a)),"".concat(i,"-").concat(n,"-").concat(a)}function M(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tag-select tasks-tag-select orders-list-tags-select"},[i("ul",[i("li",{staticClass:"item-divider"},[t._v(t._s(t.data.title))]),t._v(" "),i("li",[i("a",{staticClass:"item-link tag-search",attrs:{href:"#"},on:{click:t.openSelector}},[i("div",{staticClass:"item-content"},[t._m(0),t._v(" "),i("div",{staticClass:"item-inner"},[i("div",{staticClass:"item-title"},[t._v(t._s(t.data.placeholder))])])])])])]),t._v(" "),i("ul",{staticClass:"tag-items"},t._l(t.data.tags,(function(e,n){return i("li",{key:n,staticClass:"tag-item"},[i("div",{staticClass:"item-content"},[i("div",{staticClass:"item-inner"},[i("div",{staticClass:"item-title"},[t._v(t._s(e.name))]),t._v(" "),i("div",{staticClass:"item-after"},[i("a",{staticClass:"item-link",staticStyle:{height:"24px"},attrs:{href:"#"},on:{click:function(i){return t.removeTag(e)}}},[i("i",{staticClass:"material-icons"},[t._v("close")])])])])])])})),0)])}M._withStripped=x._withStripped=!0;var A=m({props:{data:Object},data:function(){return{teamTags:null}},mounted:function(){var t=this;t.$api.getCurrentTeamTags({cache:!1}).then((function(e){t.teamTags=e}))},methods:{openSelector:function(){var t=this;t.$f7router.navigate("/invoicing/tag-select/",{props:{tags:t.data.tags,pageTitle:t.data.pageTitle,teamTags:t.teamTags,onChange:function(e,i){i?t.$emit("tagAdd",e):t.$emit("tagRemove",e)}}})},removeTag:function(t){this.$emit("tagRemove",t)}}},M,[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"item-media"},[e("i",{staticClass:"material-icons md-36"},[this._v("search")])])}],!1,null,null,null);A.options.__file="addons/invoicing/1.0.0/src/components/tag-select.vue";var N=A.exports,L=m({components:{tagSelect:N},props:{listId:[String,Number]},data:function(){return{showSave:!1,id:parseInt(this.listId,10),orderStatuses:D,list:null,permissions:[],contacts:u.contacts}},beforeDestroy:function(){this.$events.$off("invoicing:setListDateRange",this.updateListDateRange)},mounted:function(){var t=this;u.loadList(t.id).then((function(e){e.data||(e.data={}),e.data.status||(e.data.status=[]),e.data.customer||(e.data.customer=[]),e.data.assignee||(e.data.assignee=[]),void 0===e.data.canceled&&(e.data.canceled=!0),t.list=e,t.$api.getInstalledAddonPermission("invoicing","order_list_read_access",{taggable_id:e.id,with_filters:!0}).then((function(i){i.taggable_id=e.id,t.permissions.push(i)})),t.$api.getInstalledAddonPermission("invoicing","order_list_edit_access",{taggable_id:e.id,with_filters:!0}).then((function(i){i.taggable_id=e.id,t.permissions.push(i)})),u.contacts||t.$api.getContacts().then((function(e){t.contacts=e,u.contacts=e}))})),t.$events.$on("invoicing:setListDateRange",t.updateListDateRange)},methods:{formatDateRange:function(t){if(!t)return"";if("string"!=typeof t)return Array.isArray(t)?"".concat(I(t[0])," - ").concat(I(t[1])):t||"";var e=t.charAt(0).toUpperCase()+t.slice(1);return window.tommy.i18n.t("date_range.".concat(t),e)},updateListDateRange:function(t,e){this.list.id===t&&(this.list.data.date_range=e)},onNameChange:function(t){this.saving||(this.list.name=t,this.showSave=!0)},onSortChange:function(t){this.saving||(this.list.data.sort=this.$$(t.target).val(),this.showSave=!0)},onStatusChange:function(t){this.saving||(this.list.data.status=this.$$(t.target).val(),this.showSave=!0)},onTypeChange:function(t){this.saving||(this.list.data.type=t.target.value,this.showSave=!0)},onCustomerChange:function(t){this.saving||(this.list.data.customer=this.$$(t.target).val().map((function(t){return parseInt(t,10)})),this.showSave=!0)},onAssigneeChange:function(t){this.saving||(this.list.data.assignee=this.$$(t.target).val().map((function(t){return parseInt(t,10)})),this.showSave=!0)},setOnlyAssigned:function(t){this.list.data.only_assigned=t,this.showSave=!0,t&&(this.list.data.assignee=[])},setCanceled:function(t){this.list.data.canceled=t,this.showSave=!0},showDateRange:function(){this.$f7router.navigate("/invoicing/list-edit/date-range/",{props:{list:this.list}})},showBalanceRange:function(){var t=this,e=t.list.data,i=e.balance_min,n=e.balance_max;t.$f7router.navigate("/invoicing/range-select/",{props:{pageTitle:t.$t("invoicing.list_edit.balance_range"),from:i?parseFloat(i):i,to:n?parseFloat(n):n,onSave:function(e){var i=e.from,n=e.to;t.list.data.balance_min=i,t.list.data.balance_max=n,t.list=t.list,u.saveList(t.list).then((function(){t.$f7router.back()}))}}})},showPaymentRange:function(){var t=this,e=t.list.data,i=e.price_min,n=e.price_max;t.$f7router.navigate("/invoicing/range-select/",{props:{pageTitle:t.$t("invoicing.list_edit.payment_range"),from:i?parseFloat(i):i,to:n?parseFloat(n):n,onSave:function(e){var i=e.from,n=e.to;t.list.data.price_min=i,t.list.data.price_max=n,t.list=t.list,u.saveList(t.list).then((function(){t.$f7router.back()}))}}})},save:function(){var t=this;t.saving||(t.saving=!0,t.showSave=!1,u.saveList(t.list).then((function(){t.$events.$emit("invoicing:reloadLists",t.listId),t.$f7router.back()})))},deleteList:function(){var t=this;t.saving||(t.saving=!0,t.showSave=!1,u.deleteList(t.list.id,t.list).then((function(){t.$events.$emit("invoicing:reloadLists",t.listId),t.$f7router.back()})))},saveListPermission:function(t){this.$api.updateInstalledAddonPermission("invoicing",t.name,{taggable_id:t.taggable_id,with_filters:!0,filters:JSON.stringify(t.filters)})},addListPermission:function(t,e){t.filters.push(e),this.saveListPermission(t)},removeListPermission:function(t,e){t.filters.splice(t.filters.indexOf(e),1),this.saveListPermission(t)}}},x,[],!1,null,null,null);function q(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{name:"invoicing__date-range-select",id:"invoicing__date-range-select"}},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.$t("invoicing.common.date_range","Date Range")))]),t._v(" "),i("f7-nav-right",[t.showSave?i("f7-link",{attrs:{"icon-f7":"check"},on:{click:t.save}}):t._e()],1)],1),t._v(" "),i("f7-list",[i("f7-list-item",{attrs:{radio:"",value:"",checked:!(t.isCustomRange||""!==t.range&&t.range),title:t.$t("invoicing.date_range.none","None")},on:{change:function(e){return t.setPlainRange("")}}}),t._v(" "),i("f7-list-item",{attrs:{radio:"",value:"today",checked:!t.isCustomRange&&"today"===t.range,title:t.$t("invoicing.date_range.today","Today")},on:{change:function(e){return t.setPlainRange("today")}}}),t._v(" "),i("f7-list-item",{attrs:{radio:"",value:"week",checked:!t.isCustomRange&&"week"===t.range,title:t.$t("invoicing.date_range.week","This Week")},on:{change:function(e){return t.setPlainRange("week")}}}),t._v(" "),i("f7-list-item",{attrs:{radio:"",value:"month",checked:!t.isCustomRange&&"month"===t.range,title:t.$t("invoicing.date_range.month","This Month")},on:{change:function(e){return t.setPlainRange("month")}}})],1),t._v(" "),i("f7-list",{staticClass:"top-10 list-custom"},[i("f7-list-item",{attrs:{title:t.$t("invoicing.common.choose_range","Choose Range")}},[i("f7-toggle",{attrs:{slot:"after",checked:t.isCustomRange},on:{change:function(e){return t.toggleCustomRange(e.target.checked)}},slot:"after"})],1),t._v(" "),i("f7-list-item",{directives:[{name:"show",rawName:"v-show",value:t.isCustomRange,expression:"isCustomRange"}]},[i("f7-label",[t._v(t._s(t.$t("invoicing.common.start_date","Start Date")))]),t._v(" "),i("f7-input",{ref:"rangeStart",attrs:{type:"text"}})],1),t._v(" "),i("f7-list-item",{directives:[{name:"show",rawName:"v-show",value:t.isCustomRange,expression:"isCustomRange"}]},[i("f7-label",[t._v(t._s(t.$t("invoicing.common.end_date","End Date")))]),t._v(" "),i("f7-input",{ref:"rangeEnd",attrs:{type:"text"}})],1)],1)],1)}L.options.__file="addons/invoicing/1.0.0/src/pages/list-edit.vue";var E=L.exports;q._withStripped=!0;var j=m({props:{list:Object},data:function(){var t=this.list.data.date_range;return{showSave:!1,dateFrom:Array.isArray(t)&&t[0]?t[0]:(new Date).getTime(),dateTo:Array.isArray(t)&&t[1]?t[1]:(new Date).getTime(),range:t}},computed:{isCustomRange:function(){var t=this.range;return Array.isArray(t)||!(!t||"string"==typeof t)}},mounted:function(){var t=this,e=!1,i=!1;t.calendarFrom=t.$f7.calendar.create({inputEl:t.$$(t.$refs.rangeStart.$el).find("input"),closeOnSelect:!0,value:[t.dateFrom],on:{change:function(i,n){e&&(t.showSave=!0),e=!0,t.dateFrom=new Date(n[0]).getTime(),Array.isArray(t.range)&&t.range[0]&&(t.range[0]=t.dateFrom),t.dateFrom>t.dateTo&&t.calendarTo.setValue([t.dateFrom])}}}),t.calendarTo=t.$f7.calendar.create({inputEl:t.$$(t.$refs.rangeEnd.$el).find("input"),closeOnSelect:!0,value:[t.dateTo],on:{change:function(e,n){i&&(t.showSave=!0),i=!0,t.dateTo=new Date(n[0]).getTime(),Array.isArray(t.range)&&t.range[1]&&(t.range[1]=t.dateTo),t.dateTo<t.dateFrom&&t.calendarFrom.setValue([t.dateTo])}}})},methods:{setPlainRange:function(t){this.range=t,this.showSave=!0},toggleCustomRange:function(t){var e=this;e.showSave=!0,e.range=t?[e.dateFrom,e.dateTo]:""},save:function(){var t=this;if(!t.saving){t.saving=!0,t.showSave=!1;var e=Object.assign({},t.list);e.data.date_range=t.range,u.saveList(e).then((function(){t.$events.$emit("invoicing:setListDateRange",t.list.id,t.range),t.$f7router.back()}))}}}},q,[],!1,null,null,null);function Y(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page"},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.pageTitle))]),t._v(" "),i("f7-subnavbar",{attrs:{inner:!1}},[i("f7-searchbar",{attrs:{"search-container":"#list-edit-tag-select","search-in":".item-title"},on:{"searchbar:search":t.onSearch}})],1)],1),t._v(" "),t.query&&t.query.length?i("f7-list",[i("f7-list-item",{staticClass:"tasks-tag-select-tags-list",attrs:{checkbox:"",title:t.query},on:{change:function(e){return t.toggleTag({context:"tags",name:t.query,label:"Tag"},e.target.checked,!0)}}},[i("span",{staticClass:"tag-select-list-icon",attrs:{slot:"media"},slot:"media"},[i("img",{attrs:{src:t.contextIconSrc({context:"tags",name:t.query,label:"Tag"}),srcset:t.contextIconSrcset({context:"tags",name:t.query,label:"Tag"})}})])])],1):t._e(),t._v(" "),i("f7-list",{staticClass:"no-margin no-hairlines tasks-tag-select-tags-list",attrs:{id:"list-edit-tag-select"}},t._l(t.allTags,(function(e,n){return i("f7-list-item",{key:n,attrs:{checkbox:"",checked:t.isTagSelected(e),title:e.name},on:{change:function(i){return t.toggleTag(e,i.target.checked)}}},["members"===e.context?i("span",{staticClass:"tag-select-list-avatar",style:"background-image: url("+(e.icon||"")+")",attrs:{slot:"media"},slot:"media"}):i("span",{staticClass:"tag-select-list-icon",attrs:{slot:"media"},slot:"media"},[i("img",{attrs:{src:t.contextIconSrc(e),srcset:t.contextIconSrcset(e)}})])])})),1)],1)}j.options.__file="addons/invoicing/1.0.0/src/pages/date-range.vue";var R=j.exports;Y._withStripped=!0;var F=m({props:{listId:[String,Number],pageTitle:String,tags:Array,teamTags:Array,onChange:Function},data:function(){return{query:null}},computed:{allTags:function(){var t=this,e=[];return t.tags.forEach((function(i){var n;t.teamTags.forEach((function(t){n=n||i.context===t.context&&i.name===t.name&&i.label===t.label})),n||e.push(i)})),[].concat(function(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(t.teamTags),e)}},methods:{onSearch:function(t,e){this.query=e},isTagSelected:function(t){return 0<this.tags.filter((function(e){return e.name===t.name&&e.id===t.id&&e.type===t.type})).length},contextIconSrc:function(t){var e=this.$addonAssetsUrl;return"".concat(e,"icons/").concat(t.context.slice(0,-1),".png")},contextIconSrcset:function(t){var e=this.$addonAssetsUrl;return"".concat(e,"icons/").concat(t.context.slice(0,-1),"@2x.png 2x,").concat(e,"icons/").concat(t.context.slice(0,-1),"@3x.png 3x")},toggleTag:function(t,e,i){this.onChange&&(this.onChange(t,e),i&&this.$f7router.back())}}},Y,[],!1,null,null,null);function V(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{id:"invoicing__item-details","data-name":"invoicing__item-details"}},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.pageTitle))]),t._v(" "),i("f7-nav-right",[t.showSave?i("f7-link",{attrs:{"icon-f7":"check"},on:{click:t.save}}):t._e()],1)],1),t._v(" "),t.item?i("f7-list",{staticClass:"list-custom"},[i("f7-list-input",{attrs:{label:t.$t("invoicing.item.name_label","Name"),placeholder:t.$t("invoicing.item.name_placeholder","Enter item/service name"),type:"text",value:t.item.name},on:{input:function(e){t.item.name=e.target.value,t.enableSave()}}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.item.enabled_label","Enabled")}},[i("f7-toggle",{attrs:{checked:t.item.active},on:{change:function(e){t.item.active=e.target.checked,t.enableSave()}}})],1),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item.description_label","Description")}}),t._v(" "),i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.item.description_placeholder","Enter item/service description"),type:"textarea",resizable:"",value:t.item.description},on:{input:function(e){t.item.description=e.target.value,t.enableSave()}}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item.duration_label","Duration")}}),t._v(" "),i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.item.duration_placeholder","Item duration in minutes"),type:"number",value:t.item.data.duration},on:{input:t.onDurationChange}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item.category_label","Category")}}),t._v(" "),i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.item.category_placeholder","Enter item/service category"),type:"text",value:t.item.category},on:{input:function(e){t.item.category=e.target.value,t.enableSave()}}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item.available_in_label","Available in")}}),t._v(" "),i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.item.available_in_placeholder","City where it is available"),type:"text",value:t.availabile_in},on:{input:function(e){return t.setAvailable(e.target.value)}}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item.photo_label","Photo")}}),t._v(" "),i("li",[i("div",{staticClass:"invoicing-product-photo-container"},[t.item.image_url||t.imagePreview?i("div",{staticClass:"invoicing-product-photo"},[i("img",{attrs:{src:t.item.image_url||t.imagePreview}}),t._v(" "),i("f7-link",{attrs:{"icon-f7":"close_round_fill"},on:{click:t.deleteImage}})],1):i("label",{staticClass:"invoicing-product-photo-add"},[i("input",{attrs:{type:"file"},on:{change:t.onFileChange}}),t._v(" "),i("f7-icon",{attrs:{f7:"add"}})],1)])]),t._v(" "),i("tag-select",{attrs:{slot:"after-list",data:{title:t.$t("invoicing.item.tags_label"),placeholder:t.$t("invoicing.common.search_members_tags","Search Members, Tags"),pageTitle:t.$t("invoicing.common.search_members_tags","Search Members, Tags"),tags:t.item.filters}},on:{tagAdd:t.addItemTag,tagRemove:t.removeItemTag},slot:"after-list"})],1):t._e(),t._v(" "),t.item?i("f7-list",{staticClass:"list-custom margin-top"},[i("f7-list-input",{attrs:{label:t.$t("invoicing.item.price_label","Price"),placeholder:t.$t("invoicing.item.price_placeholder","Enter item/service price"),type:"number",value:t.item.price},on:{input:function(e){return t.setPrice(e.target.value)}}}),t._v(" "),i("f7-list-input",{attrs:{label:t.$t("invoicing.item.barcode_label","Barcode ID"),placeholder:t.$t("invoicing.item.barcode_placeholder","Enter item/service barcode ID"),type:"text",value:t.item.code},on:{input:function(e){t.item.code=e.target.value,t.enableSave()}}})],1):t._e()],1)}F.options.__file="addons/invoicing/1.0.0/src/pages/tag-select-page.vue";var U=F.exports;V._withStripped=!0;var H=m({components:{tagSelect:N},props:{id:[String,Number]},data:function(){return{pageTitle:this.$f7route.query.title||this.$t("invoicing.product.new_title"),item:null,showSave:!1,imagePreview:null,availabile_in:""}},mounted:function(){var t=this;t.id?u.loadProduct(t.id).then((function(e){e.data&&"string"!=typeof e.data||(e.data={duration:null,availabile_in:[]}),t.availabile_in=(e.data.availabile_in||[]).join(","),"string"==typeof e.filters&&(e.filters=JSON.parse(decodeURIComponent(e.filters))),e.filters||(e.filters=[]),t.item=e})):t.item={active:!1,category:"",code:"",data:{duration:null,availabile_in:[]},filters:[],description:"",name:"",price:0}},methods:{setAvailable:function(t){this.availabile_in=t,this.item.data.availabile_in=t.split(",").map((function(t){return t.trim()})).filter((function(t){return t})),this.enableSave()},setPrice:function(t){var e=this;e.item.price=t,e.item.price_cents=100*parseFloat(e.item.price),Number.isNaN(e.item.price_cents)&&(e.item.price_cents=0),e.enableSave()},enableSave:function(){this.item.name?this.showSave=!0:this.showSave=!1},addItemTag:function(t){this.item.filters.push(t),this.enableSave()},removeItemTag:function(t){this.item.filters.splice(this.item.filters.indexOf(t),1),this.enableSave()},onDurationChange:function(t){this.item.data.duration=t.target.value,this.enableSave()},onFileChange:function(t){var e=this,i=t.target.files[0],n=new FileReader;n.onload=function(t){e.imagePreview=t.target.result},n.readAsDataURL(i),e.item.image=i,e.enableSave()},deleteImage:function(){this.item.image=null,this.item.image_url=null,this.imagePreview=null,this.enableSave()},save:function(){var t=this;t.showSave=!1,u.saveProduct(t.item).then((function(){t.$events.$emit("invoicing:reloadProducts"),t.$f7router.back()}))}}},V,[],!1,null,null,null);function J(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{id:"invoicing__item-details","data-name":"invoicing__item-details"}},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.pageTitle))]),t._v(" "),i("f7-nav-right",[t.showSave?i("f7-link",{attrs:{"icon-f7":"check"},on:{click:t.save}}):t._e()],1)],1),t._v(" "),t.item?i("f7-list",{staticClass:"list-custom"},[i("f7-list-input",{attrs:{label:t.$t("invoicing.item.name_label","Name"),placeholder:t.$t("invoicing.item.name_placeholder","Enter item/service name"),type:"text",value:t.item.name},on:{input:function(e){t.item.name=e.target.value,t.enableSave()}}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.item.enabled_label","Enabled")}},[i("f7-toggle",{attrs:{checked:t.item.active},on:{change:function(e){t.item.active=e.target.checked,t.enableSave()}}})],1),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item.description_label","Description")}}),t._v(" "),i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.item.description_placeholder","Enter item/service description"),type:"textarea",resizable:"",value:t.item.description},on:{input:function(e){t.item.description=e.target.value,t.enableSave()}}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item.duration_label","Duration")}}),t._v(" "),i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.item.duration_placeholder","Item duration in minutes"),type:"number",value:t.item.data.duration},on:{input:t.onDurationChange}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item.category_label","Cagegory")}}),t._v(" "),i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.item.category_placeholder","Enter item/service category"),type:"text",value:t.item.category},on:{input:function(e){t.item.category=e.target.value,t.enableSave()}}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item.available_in_label","Available in")}}),t._v(" "),i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.item.available_in_placeholder","City where it is available"),type:"text",value:t.availabile_in},on:{input:function(e){return t.setAvailable(e.target.value)}}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item.photo_label","Photo")}}),t._v(" "),i("li",[i("div",{staticClass:"invoicing-product-photo-container"},[t.item.image_url||t.imagePreview?i("div",{staticClass:"invoicing-product-photo"},[i("img",{attrs:{src:t.item.image_url||t.imagePreview}}),t._v(" "),i("f7-link",{attrs:{"icon-f7":"close_round_fill"},on:{click:t.deleteImage}})],1):i("label",{staticClass:"invoicing-product-photo-add"},[i("input",{attrs:{type:"file"},on:{change:t.onFileChange}}),t._v(" "),i("f7-icon",{attrs:{f7:"add"}})],1)])]),t._v(" "),i("tag-select",{attrs:{slot:"after-list",data:{title:t.$t("invoicing.item.tags_label"),placeholder:t.$t("invoicing.common.search_members_tags","Search Members, Tags"),pageTitle:t.$t("invoicing.common.search_members_tags","Search Members, Tags"),tags:t.item.filters}},on:{tagAdd:t.addItemTag,tagRemove:t.removeItemTag},slot:"after-list"}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.package.items_label")}}),t._v(" "),t.products?i("li",{staticClass:"invoicing-order-items"},[i("div",{staticClass:"invoicing-order-add-box",on:{click:function(e){t.productsOpened=!0}}},[i("f7-icon",{attrs:{f7:"add"}}),t._v(" "),i("div",{staticClass:"invoicing-order-add-box-placeholder"},[t._v(t._s(t.$t("invoicing.package.add_item_label")))])],1),t._v(" "),t._l(t.item.package_products_attributes,(function(e,n){return e._destroy?t._e():i("div",{key:n,staticClass:"invoicing-order-item"},[i("div",{staticClass:"invoicing-order-item-name"},[t._v(t._s(t.productName(e.vendor_product_id)))]),t._v(" "),i("div",{staticClass:"invoicing-order-item-selector"},[i("f7-link",{attrs:{"icon-f7":"delete_round"},on:{click:function(e){return t.decreaseProduct(n)}}}),t._v(" "),i("div",{staticClass:"invoicing-order-item-qty"},[t._v(t._s(e.quantity))]),t._v(" "),i("f7-link",{attrs:{"icon-f7":"add_round_fill"},on:{click:function(e){return t.increaseProduct(n)}}})],1)])}))],2):t._e()],1):t._e(),t._v(" "),t.item?i("f7-list",{staticClass:"list-custom margin-top"},[i("f7-list-input",{attrs:{label:t.$t("invoicing.item.price_label","Price"),placeholder:t.$t("invoicing.item.price_placeholder","Enter item/service price"),type:"text",value:t.item.price},on:{input:function(e){return t.setPrice(e.target.value)}}}),t._v(" "),i("f7-list-input",{attrs:{label:t.$t("invoicing.item.barcode_label","Barcode ID"),placeholder:t.$t("invoicing.item.barcode_placeholder","Enter item/service barcode ID"),type:"text",value:t.item.code},on:{input:function(e){t.item.code=e.target.value,t.enableSave()}}})],1):t._e(),t._v(" "),t.products?i("f7-popup",{attrs:{opened:t.productsOpened},on:{"popup:closed":function(e){t.productsOpened=!1}}},[i("f7-view",{attrs:{init:!1}},[i("f7-page",{staticClass:"invoicing-page"},[i("f7-navbar",[i("f7-nav-right",[i("f7-link",{attrs:{"popup-close":"","icon-f7":"close"}})],1),t._v(" "),i("f7-nav-title",[t._v(t._s(t.$t("invoicing.package.add_item_label")))])],1),t._v(" "),i("f7-searchbar",{attrs:{"search-container":".invoicing-package-details-products","disable-button":!1}}),t._v(" "),i("f7-list",{staticClass:"list-custom invoicing-order-details-products invoicing-package-details-products"},t._l(t.products,(function(e){return i("f7-list-item",{key:e.id,attrs:{link:"",title:e.name,after:"¥"+e.price},on:{click:function(i){return t.addProduct(e)}}})})),1)],1)],1)],1):t._e()],1)}H.options.__file="addons/invoicing/1.0.0/src/pages/product-details.vue";var B=H.exports;J._withStripped=!0;var K=m({components:{tagSelect:N},props:{id:[String,Number]},data:function(){return{pageTitle:this.$f7route.query.title||this.$t("invoicing.package.new_title"),item:null,showSave:!1,imagePreview:null,products:null,productsOpened:!1,availabile_in:"",data:{duration:null}}},mounted:function(){var t=this;u.loadProducts().then((function(e){t.products=e})),t.id?u.loadPackage(t.id).then((function(e){e.package_products_attributes||(e.package_products_attributes=[]),e.package_products&&(e.package_products_attributes=e.package_products.map((function(t){return{id:t.id,vendor_product_id:t.vendor_product_id,quantity:t.quantity,vendor_package_id:t.vendor_package_id}})),delete e.package_products),e.data&&"string"!=typeof e.data||(e.data={availabile_in:[],duration:null}),t.availabile_in=(e.data.availabile_in||[]).join(","),"string"==typeof e.filters&&(e.filters=JSON.parse(decodeURIComponent(e.filters))),e.filters||(e.filters=[]),t.item=e})):t.item={active:!1,category:"",code:"",filters:[],description:"",name:"",price:0,package_products_attributes:[],data:{availabile_in:[],duration:null}}},methods:{setAvailable:function(t){this.availabile_in=t,this.item.data.availabile_in=t.split(",").map((function(t){return t.trim()})).filter((function(t){return t})),this.enableSave()},productName:function(t){return this.products.filter((function(e){return e.id===parseInt(t,10)}))[0].name},increaseProduct:function(t){this.item.package_products_attributes[t].quantity+=1,this.enableSave()},decreaseProduct:function(t){var e=this;--e.item.package_products_attributes[t].quantity,0===e.item.package_products_attributes[t].quantity&&(e.item.package_products_attributes[t].id?e.item.package_products_attributes[t]._destroy=!0:e.item.package_products_attributes.splice(t,1)),e.enableSave()},addProduct:function(t){var e;this.productsOpened=!1,this.item.package_products_attributes.forEach((function(i){i.vendor_product_id===t.id&&(e=!0)})),e||(this.item.package_products_attributes.push({vendor_product_id:t.id,quantity:1}),this.showSave=!0)},setPrice:function(t){var e=this;e.item.price=t,e.item.price_cents=100*parseFloat(e.item.price),Number.isNaN(e.item.price_cents)&&(e.item.price_cents=0),e.enableSave()},enableSave:function(){this.item.name?this.showSave=!0:this.showSave=!1},addItemTag:function(t){this.item.filters.push(t),this.enableSave()},removeItemTag:function(t){this.item.filters.splice(this.item.filters.indexOf(t),1),this.enableSave()},onDurationChange:function(t){this.item.data.duration=t.target.value,this.enableSave()},onFileChange:function(t){var e=this,i=t.target.files[0],n=new FileReader;n.onload=function(t){e.imagePreview=t.target.result},n.readAsDataURL(i),e.item.image=i,e.enableSave()},deleteImage:function(){this.item.image=null,this.item.image_url=null,this.imagePreview=null,this.enableSave()},save:function(){var t=this;t.showSave=!1,u.saveProduct(t.item,!0).then((function(){t.$events.$emit("invoicing:reloadPackages"),t.$f7router.back()}))}}},J,[],!1,null,null,null);function z(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{name:"invoicing__range-select",id:"invoicing__range-select"}},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.pageTitle))]),t._v(" "),i("f7-nav-right",[t.showSave?i("f7-link",{attrs:{"icon-f7":"check"},on:{click:t.save}}):t._e()],1)],1),t._v(" "),i("f7-list",{staticClass:"list-custom"},[i("f7-list-item",{attrs:{title:t.$t("invoicing.common.choose_range","Choose Range")}},[i("f7-toggle",{attrs:{slot:"after",checked:t.isCustomRange},on:{change:function(e){return t.toggleCustomRange(e.target.checked)}},slot:"after"})],1),t._v(" "),t.isCustomRange?i("f7-list-input",{attrs:{label:t.$t("invoicing.common.amount_min","From"),type:"number",value:t.amount_min},on:{input:function(e){return t.setMin(e.target.value)}}}):t._e(),t._v(" "),t.isCustomRange?i("f7-list-input",{attrs:{label:t.$t("invoicing.common.amount_max","To"),type:"number",value:t.amount_max},on:{input:function(e){return t.setMax(e.target.value)}}}):t._e()],1)],1)}K.options.__file="addons/invoicing/1.0.0/src/pages/package-details.vue";var G=K.exports;z._withStripped=!0;var Q=m({props:{from:Number,to:Number,pageTitle:String,onSave:Function},data:function(){var t=this.from,e=this.to;return{showSave:!1,amount_min:t,amount_max:e,isCustomRange:void 0!==t||void 0!==e}},methods:{save:function(){var t=this;if(!t.saving){t.saving=!0,t.showSave=!1;var e,i,n=t.amount_min,a=t.amount_max;t.isCustomRange?(e=(e=n)||void 0,i=(i=a)||void 0,n&&a&&a<n&&(i=n)):i=e=void 0,t.onSave({from:e,to:i})}},setMin:function(t){this.amount_min=t,this.showSave=!0},setMax:function(t){this.amount_max=t,this.showSave=!0},toggleCustomRange:function(t){var e=this;e.showSave=!0,t?(e.isCustomRange=!0,e.amount_min=e.from,e.amount_max=e.to):(e.isCustomRange=!1,e.amount_min=void 0,e.amount_max=void 0)}}},z,[],!1,null,null,null);function W(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-popup",{ref:"popup"},[i("f7-view",{attrs:{"ios-dynamic-navbar":!1}},[i("f7-page",{staticClass:"invoicing-page",attrs:{name:"invoicing__order-details",id:"invoicing__order-details"}},[i("f7-navbar",[i("f7-nav-left",[i("f7-link",{attrs:{"popup-close":"","icon-f7":"close"}})],1),t._v(" "),i("f7-nav-title",[t._v(t._s(t.pageTitle))]),t._v(" "),i("f7-nav-right",[t.showSave?i("f7-link",{attrs:{"icon-f7":"check"},on:{click:t.save}}):t._e()],1)],1),t._v(" "),t.order?[i("f7-list",{staticClass:"list-custom"},[t.order.created_at&&t.order.id?i("f7-list-item",{attrs:{title:t.$t("invoicing.order_details.created"),after:t.formatDate(t.order.created_at)}}):t._e(),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_details.due_date"),link:!0,after:t.formatOrderDate(t.order.data?parseInt(t.order.data.date,10):null)},on:{click:t.openDateSelect}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_details.due_time"),link:!0,after:t.formatOrderTime(t.order.data?parseInt(t.order.data.date,10):null)},on:{click:t.openTimeSelect}}),t._v(" "),t.order.data&&t.order.data.location?i("f7-list-input",{attrs:{label:t.$t("invoicing.order_details.city"),placeholder:t.$t("invoicing.order_details.city_placeholder"),type:"text",value:t.order.data.location.city},on:{input:t.onCityChange}}):t._e(),t._v(" "),t.order.data&&t.order.data.location?i("f7-list-input",{attrs:{label:t.$t("invoicing.order_details.address"),placeholder:t.$t("invoicing.order_details.address_placeholder"),type:"text",value:t.order.data.location.address},on:{input:t.onAddressChange}}):t._e(),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_details.status"),"smart-select":"","smart-select-params":{openIn:"popover",closeOnSelect:!0,routableModals:!1}}},[i("select",{on:{change:t.onStatusChange}},t._l(t.orderStatuses,(function(e,n){return i("option",{key:n,domProps:{value:e,selected:t.order.status===e}},[t._v(t._s(t.$t("invoicing.order_status."+e)))])})),0)]),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_details.type"),"smart-select":"","smart-select-params":{openIn:"popover",closeOnSelect:!0,routableModals:!1}}},[i("select",{on:{change:t.onTypeChange}},[i("option",{attrs:{value:"invoice"},domProps:{selected:!t.order.quote}},[t._v(t._s(t.$t("invoicing.list_edit.type_invoice")))]),t._v(" "),i("option",{attrs:{value:"quote"},domProps:{selected:t.order.quote}},[t._v(t._s(t.$t("invoicing.list_edit.type_quote")))])])]),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_details.comment")}}),t._v(" "),i("f7-list-input",{attrs:{type:"textarea",value:t.order.comment,placeholder:t.$t("invoicing.order_details.comment_placeholder"),resizable:""},on:{input:t.onCommentChange}}),t._v(" "),t.orderAssignee?[i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_details.assignee")}}),t._v(" "),i("f7-list-item",{attrs:{title:t.orderAssignee?t.orderAssigneeName:"","smart-select":"","smart-select-params":{virtualList:!0}}},[i("tommy-circle-avatar",{attrs:{slot:"media",data:t.orderAssignee},slot:"media"}),t._v(" "),i("select",{attrs:{name:"assignee"},on:{change:t.onAssigneeChange}},t._l(t.$root.teamMembers,(function(e,n){return i("option",{key:"teamMember-"+n+"-"+e.id,attrs:{"data-option-class":"invoicing-smart-select-option","data-option-image":e.icon_url},domProps:{value:e.user_id,selected:t.order.user_id===e.user_id}},[t._v("\n                  "+t._s(e.first_name||"")+" "+t._s(e.last_name||""))])})),0),t._v(" "),i("f7-link",{staticStyle:{"margin-left":"80px",padding:"8px 0"},attrs:{slot:"root",href:"/team-member-details/?user_id="+t.order.assignee_id+"&name="+t.orderAssigneeName},slot:"root"},[i("span",[t._v(t._s(t.$t("invoicing.order_details.assignee_profile")))]),t._v(" "),i("f7-icon",{attrs:{f7:"chevron_right",size:16}})],1)],1)]:t._e(),t._v(" "),[i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_details.customer")}}),t._v(" "),i("f7-list-item",{attrs:{title:t.orderUser?t.orderUserName:"","smart-select":"","smart-select-params":{virtualList:!0}}},[i("tommy-circle-avatar",{attrs:{slot:"media",data:t.orderUser},slot:"media"}),t._v(" "),i("select",{attrs:{name:"customer"},on:{change:t.onCustomerChange}},[t._l(t.contacts,(function(e,n){return i("option",{key:"contact-"+n+"-"+e.friend_id,attrs:{"data-option-class":"invoicing-smart-select-option","data-option-image":e.icon_url},domProps:{value:e.friend_id,selected:t.order.user_id===e.friend_id}},[t._v("\n                  "+t._s(e.first_name||"")+" "+t._s(e.last_name||""))])})),t._v(" "),t._l(t.$root.teamMembers,(function(e,n){return i("option",{key:"teamMember-"+n+"-"+e.id,attrs:{"data-option-class":"invoicing-smart-select-option","data-option-image":e.icon_url},domProps:{value:e.user_id,selected:t.order.user_id===e.user_id}},[t._v("\n                  "+t._s(e.first_name||"")+" "+t._s(e.last_name||""))])}))],2),t._v(" "),i("f7-link",{staticStyle:{"margin-left":"80px",padding:"8px 0"},attrs:{slot:"root",href:"/contact-details/?user_id="+t.order.assignee_id},slot:"root"},[i("span",[t._v(t._s(t.$t("invoicing.order_details.customer_profile")))]),t._v(" "),i("f7-icon",{attrs:{f7:"chevron_right",size:16}})],1)],1)],t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_details.items")}}),t._v(" "),t.products&&t.packages?i("li",{staticClass:"invoicing-order-items"},[i("div",{staticClass:"invoicing-order-add-box",on:{click:function(e){t.productsOpened=!0}}},[i("f7-icon",{attrs:{f7:"add"}}),t._v(" "),i("div",{staticClass:"invoicing-order-add-box-placeholder"},[t._v(t._s(t.$t("invoicing.order_details.add_item_label")))])],1),t._v(" "),t._l(t.order.vendor_order_items,(function(e,n){return e._destroy?t._e():i("div",{key:e.orderable_id+"-"+n,staticClass:"invoicing-order-item"},[i("div",{staticClass:"invoicing-order-item-name"},[t._v(t._s(t.productName(e.orderable_id,e.orderable_type))+"\n              ")]),t._v(" "),i("div",{staticClass:"invoicing-order-item-details"},[i("div",{staticClass:"invoicing-order-item-price"},[t._v(t._s(t.productPrice(e.orderable_id,e.orderable_type))+"\n                ")]),t._v(" "),i("div",{staticClass:"invoicing-order-item-selector"},[i("f7-link",{attrs:{"icon-f7":"delete_round"},on:{click:function(e){return t.decreaseOrderItem(n)}}}),t._v(" "),i("div",{staticClass:"invoicing-order-item-qty"},[t._v(t._s(e.quantity))]),t._v(" "),i("f7-link",{attrs:{"icon-f7":"add_round_fill"},on:{click:function(e){return t.increaseOrderItem(n)}}})],1)])])})),t._v(" "),t.orderItemsTotal?i("div",{staticClass:"invoicing-order-total"},[i("div",{staticClass:"invoicing-order-total-row"},[i("div",{staticClass:"invoicing-order-total-label"},[t._v(t._s(t.$t("invoicing.order_details.total")))]),t._v(" "),i("div",{staticClass:"invoicing-order-total-value"},[t._v(t._s(t.orderItemsTotal))])])]):t._e()],2):t._e(),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_details.promotions")}}),t._v(" "),t.promotions?i("li",{staticClass:"invoicing-order-items"},[i("div",{staticClass:"invoicing-order-add-box",on:{click:function(e){t.promotionsOpened=!0}}},[i("f7-icon",{attrs:{f7:"add"}}),t._v(" "),i("div",{staticClass:"invoicing-order-add-box-placeholder"},[t._v(t._s(t.$t("invoicing.order_details.add_promotion_label"))+"\n              ")])],1),t._v(" "),t.order.vendor_coupon_id?i("div",{staticClass:"invoicing-order-item"},[i("div",{staticClass:"invoicing-order-item-name"},[t._v(t._s(t.promotionName(t.order.vendor_coupon_id)))]),t._v(" "),i("div",{staticClass:"invoicing-order-item-details"},[i("div",{staticClass:"invoicing-order-item-price"},[t._v("-"+t._s(t.promotionDiscount(t.order.vendor_coupon_id)))]),t._v(" "),i("div",{staticClass:"invoicing-order-item-selector"},[i("f7-link",{attrs:{"icon-f7":"delete_round"},on:{click:function(e){return t.deleteOrderPromotion()}}})],1)])]):t._e(),t._v(" "),t.orderDiscountTotal?i("div",{staticClass:"invoicing-order-total"},[i("div",{staticClass:"invoicing-order-total-row"},[i("div",{staticClass:"invoicing-order-total-label"},[t._v(t._s(t.$t("invoicing.order_details.total")))]),t._v(" "),i("div",{staticClass:"invoicing-order-total-value"},[t._v("-"+t._s(t.orderDiscountTotal))])])]):t._e()]):t._e(),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_details.payment")}}),t._v(" "),t.products&&t.packages&&t.promotions?i("li",{staticClass:"invoicing-order-items"},[i("div",{staticClass:"invoicing-order-total"},[t.orderItemsTotal?i("div",{staticClass:"invoicing-order-total-row"},[i("div",{staticClass:"invoicing-order-total-label"},[t._v(t._s(t.$t("invoicing.order_details.items")))]),t._v(" "),i("div",{staticClass:"invoicing-order-total-value"},[t._v(t._s(t.orderItemsTotal))])]):t._e(),t._v(" "),t.orderDiscountTotal?i("div",{staticClass:"invoicing-order-total-row"},[i("div",{staticClass:"invoicing-order-total-label"},[t._v(t._s(t.$t("invoicing.order_details.promotions")))]),t._v(" "),i("div",{staticClass:"invoicing-order-total-value"},[t._v("-"+t._s(t.orderDiscountTotal))])]):t._e(),t._v(" "),t.order.data.payment_method?i("div",{staticClass:"invoicing-order-total-row"},[i("div",{staticClass:"invoicing-order-total-label"},[t._v(t._s(t.$t("invoicing.order_details.via_label")))]),t._v(" "),i("div",{staticClass:"invoicing-order-total-value"},[t._v("\n                  "+t._s(t.$t("invoicing.order_details.via_"+t.order.data.payment_method)))])]):t._e(),t._v(" "),i("div",{staticClass:"invoicing-order-total-row invoicing-order-final-row"},[i("div",{staticClass:"invoicing-order-total-label"},[t._v(t._s(t.$t("invoicing.order_details.total")))]),t._v(" "),i("div",{staticClass:"invoicing-order-total-value"},[t._v(t._s(t.orderTotal))])])])]):t._e(),t._v(" "),t.order&&t.order.data.feedback&&t.products&&t.packages?[i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_feedback_results.time_clocking")}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_feedback_results.scheduled"),after:t.calcOrderDuration()}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_feedback_results.start"),after:t.$moment(parseInt(t.order.data.date,10)).format("H:mm DD MMM YYYY")}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_feedback_results.finish"),after:t.$moment(parseInt(t.order.data.date,10)+60*t.calcOrderDuration()*1e3).format("H:mm DD MMM YYYY")}}),t._v(" "),t.order.data.feedback.start_date&&t.order.data.feedback.end_date?[i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_feedback_results.time_change")}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_feedback_results.start"),after:t.$moment(t.order.data.feedback.start_date).format("H:mm DD MMM YYYY")}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_feedback_results.finish"),after:t.$moment(t.order.data.feedback.end_date).format("H:mm DD MMM YYYY")}})]:t._e(),t._v(" "),t.order.data.feedback.actual_start_date&&t.order.data.feedback.actual_end_date?[i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_feedback_results.actual_time")}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_feedback_results.start"),after:t.$moment(t.order.data.feedback.actual_start_date).format("H:mm DD MMM YYYY")}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_feedback_results.finish"),after:t.$moment(t.order.data.feedback.actual_end_date).format("H:mm DD MMM YYYY")}})]:t._e(),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_feedback_results.feedback")}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_feedback_results.question_1"),after:t.$t("invoicing.order_feedback_results."+t.order.data.feedback.question1)}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_feedback_results.question_2"),after:t.$t("invoicing.order_feedback_results."+t.order.data.feedback.question2)}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_feedback_results.question_3"),after:t.$t("invoicing.order_feedback_results."+t.order.data.feedback.question3)}})]:t._e()],2),t._v(" "),t.orderCancelable?i("f7-list",{staticClass:"margin-top margin-bottom"},[i("f7-list-button",{staticClass:"color-custom",attrs:{color:"custom"},on:{click:t.cancelOrder}},[t._v("\n            "+t._s(t.$t("invoicing.order_details.cancel_button","Cancel Order")))])],1):t._e(),t._v(" "),t.products&&t.packages?i("f7-popup",{attrs:{opened:t.productsOpened},on:{"popup:closed":function(e){t.productsOpened=!1}}},[i("f7-view",{attrs:{init:!1}},[i("f7-page",{staticClass:"invoicing-page"},[i("f7-navbar",[i("f7-nav-right",[i("f7-link",{attrs:{"icon-f7":"close"},on:{click:function(e){t.productsOpened=!1}}})],1),t._v(" "),i("f7-nav-title",[t._v(t._s(t.$t("invoicing.order_details.add_item_label")))])],1),t._v(" "),i("f7-searchbar",{attrs:{"search-container":".invoicing-order-details-items","disable-button":!1}}),t._v(" "),i("f7-list",{staticClass:"list-custom invoicing-order-details-products invoicing-order-details-items"},[i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_details.packages")}}),t._v(" "),t._l(t.packages,(function(e){return i("f7-list-item",{key:"package-"+e.id,attrs:{link:"",title:e.name,after:"¥"+e.price},on:{click:function(i){return t.addOrderItem(e,"Vendor::Package")}}})})),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_details.items")}}),t._v(" "),t._l(t.products,(function(e){return i("f7-list-item",{key:"product-"+e.id,attrs:{link:"",title:e.name,after:"¥"+e.price},on:{click:function(i){return t.addOrderItem(e,"Vendor::Product")}}})}))],2)],1)],1)],1):t._e(),t._v(" "),t.promotions?i("f7-popup",{attrs:{opened:t.promotionsOpened},on:{"popup:closed":function(e){t.promotionsOpened=!1}}},[i("f7-view",{attrs:{init:!1}},[i("f7-page",[i("f7-navbar",[i("f7-nav-right",[i("f7-link",{attrs:{"icon-f7":"close"},on:{click:function(e){t.promotionsOpened=!1}}})],1),t._v(" "),i("f7-nav-title",[t._v(t._s(t.$t("invoicing.order_details.add_promotion_label")))])],1),t._v(" "),i("f7-searchbar",{attrs:{"search-container":".invoicing-order-details-promotions","disable-button":!1}}),t._v(" "),i("f7-list",{staticClass:"list-custom invoicing-order-details-products invoicing-order-details-promotions"},t._l(t.promotions,(function(e){return i("f7-list-item",{key:e.id,attrs:{link:"",title:e.name,after:"- ¥"+("percentage"!==e.kind?e.amount:e.amount*t.order.total)},on:{click:function(i){return t.addOrderPromotion(e)}}})})),1)],1)],1)],1):t._e()]:t._e()],2)],1)],1)}Q.options.__file="addons/invoicing/1.0.0/src/pages/range-select.vue";var X=Q.exports;function Z(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function tt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}W._withStripped=!0;var et=m({props:{id:[Number,String]},data:function(){return{pageTitle:this.id?"".concat(this.$t("invoicing.order_details.title","Order")," #").concat(this.id):this.$t("invoicing.order_details.new_title"),order:null,showSave:!1,orderStatuses:D,products:null,packages:null,productsOpened:!1,promotions:null,promotionsOpened:!1,isFeedback:!1,orderUser:null,orderAssignee:null,contacts:u.contacts}},mounted:function(){var t=this;t.id?u.loadOrder(t.id).then((function(e){t.order=e;var i=t.$root.teamMembers.filter((function(t){return t.user_id===parseInt(e.user_id,10)}))[0],n=t.$root.teamMembers.filter((function(t){return t.user_id===parseInt(e.assignee_id,10)}))[0];if(t.orderAssignee=n,!i)return t.contacts?(i=t.contacts.filter((function(t){return t.friend_id===parseInt(e.user_id,10)}))[0],void(t.orderUser=i)):void t.$api.getContacts.then((function(n){t.contacts=n,i=t.contacts.filter((function(t){return t.friend_id===parseInt(e.user_id,10)}))[0],t.orderUser=i}));t.orderUser=i})):t.order={comment:"",discount:0,total:0,user_id:null,vendor_coupon_id:null,vendor_order_items:[],wallet_transaction_id:null,status:"pending",canceled:!1,data:{location:{address:"",city:""},date:(new Date).getTime()}},u.loadProducts().then((function(e){t.products=e})),u.loadPackages().then((function(e){t.packages=e})),u.loadPromotions().then((function(e){t.promotions=e}))},beforeDestroy:function(){var t=this;t.dateCalendar&&t.dateCalendar.destroy&&t.dateCalendar.destroy(),t.timePicker&&t.timePicker.destroy&&t.timePicker.destroy()},computed:{orderAssigneeName:function(){var t=this.orderAssignee;return t?t.friend_team_name?t.friend_team_name.trim():t.name?t.name.trim():t.first_name?"".concat(t.first_name).concat(t.last_name?" ".concat(t.last_name):"").trim():"":""},orderUserName:function(){var t=this.orderUser;return t?t.friend_team_name?t.friend_team_name.trim():t.name?t.name.trim():t.first_name?"".concat(t.first_name).concat(t.last_name?" ".concat(t.last_name):"").trim():"":""},orderItemsTotal:function(){var t=this,e=0;return t.order.vendor_order_items.forEach((function(i){e+=t.productPrice(i.orderable_id,i.orderable_type)*i.quantity})),e},orderDiscountTotal:function(){var t=this,e=0;if(t.order.vendor_coupon_id){var i=t.promotions.filter((function(e){return e.id===t.order.vendor_coupon_id}))[0];i&&(e="percentage"!==i.kind?i.amount:t.orderItemsTotal*i.amount)}return e},orderTotal:function(){return Math.max(this.orderItemsTotal-this.orderDiscountTotal,0)},orderCancelable:function(){var t=this.order;return!t.canceled&&("paid"===t.status||"pending"===t.status)}},methods:{cancelOrder:function(){var t=this;t.order.canceled=!0,u.cancelOrder(t.order).then((function(e){t.order=e,t.order.canceled=!0,t.$events.$emit("invoicing:reloadListsOrders")})).catch((function(){t.order.canceled=!1}))},calcOrderDuration:function(){var t=this,e=0;return t.order&&t.products&&t.packages&&t.order.vendor_order_items.forEach((function(i){e+=t.productDuration(i.orderable_id,i.orderable_type)*i.quantity})),e},onAssigneeChange:function(t){var e=parseInt(t.target.value,10),i=this.$root.teamMembers.filter((function(t){return t.user_id===parseInt(e,10)}))[0];this.order.assignee_id=i.user_id,this.order.data.nurse=i,this.showSave=!0},onCustomerChange:function(t){var e=this,i=parseInt(t.target.value,10),n=e.$root.teamMembers.filter((function(t){return t.user_id===parseInt(i,10)}))[0];!n&&e.contacts&&(n=e.contacts.filter((function(t){return t.friend_id===parseInt(i,10)}))[0]),e.orderUser=n,e.order.user_id=parseInt(t.target.value,10),e.showSave=!0},onCommentChange:function(t){this.order.comment=t.target.value,this.showSave=!0},onCityChange:function(t){var e=this;e.order.data||(e.order.data={}),e.order.data.location||(e.order.data.location={}),e.order.data.location.city=t.target.value,e.showSave=!0},onAddressChange:function(t){var e=this;e.order.data||(e.order.data={}),e.order.data.location||(e.order.data.location={}),e.order.data.location.address=t.target.value,e.showSave=!0},openTimeSelect:function(){var t=this,e=t.order;if(t.timePicker)t.timePicker.open();else{var i,n=t.formatOrderTime(e.data?parseInt(e.data.date,10):null);t.timePicker=t.$f7.picker.create({value:n?n.split(":"):[],cols:[{values:"00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23".split(" ")},{divider:!0,content:" : "},{values:function(){for(var t=[],e=0;e<=59;e+=1)t.push(e<10?"0".concat(e):"".concat(e));return t}()}],on:{change:function(e,n){if(i){var a=new Date(parseInt(t.order.data.date,10));a.setHours(parseInt(n[0],10),parseInt(n[1],10)),t.order.data.date=a.getTime(),t.showSave=!0}else i=!0}}}),t.timePicker.open()}},openDateSelect:function(){var t,e=this;e.dateCalendar?e.dateCalendar.open():(e.dateCalendar=e.$f7.calendar.create({value:e.order.data.date?[parseInt(e.order.data.date,10)]:[],on:{change:function(i,n){if(t){var a=new Date(parseInt(e.order.data.date,10)),r=new Date(n[0]);a.setFullYear(r.getFullYear()),a.setMonth(r.getMonth()),a.setDate(r.getDate()),e.order.data.date=a.getTime(),e.showSave=!0}else t=!0}}}),e.dateCalendar.open())},promotionName:function(t){return this.promotions.filter((function(e){return e.id===parseInt(t,10)}))[0].name},promotionDiscount:function(t){var e=this.promotions.filter((function(e){return e.id===parseInt(t,10)}))[0];return e?"percentage"!==e.kind?e.amount:this.orderItemsTotal*e.amount:0},productName:function(t,e){var i=this["Vendor::Product"===(1<arguments.length&&void 0!==e?e:"Vendor::Product")?"products":"packages"].filter((function(e){return e.id===parseInt(t,10)}))[0];return i?i.name:""},productPrice:function(t,e){var i=this["Vendor::Product"===(1<arguments.length&&void 0!==e?e:"Vendor::Product")?"products":"packages"].filter((function(e){return e.id===parseInt(t,10)}))[0];return i?i.price:0},productDuration:function(t,e){var i=this["Vendor::Product"===(1<arguments.length&&void 0!==e?e:"Vendor::Product")?"products":"packages"].filter((function(e){return e.id===parseInt(t,10)}))[0];return i?parseInt(i.data.duration,10):0},formatOrderDate:function(t){return t?this.$moment(new Date(parseInt(t,10))).format("D MMM YYYY"):""},formatOrderTime:function(t){return t?this.$moment(new Date(parseInt(t,10))).format("HH:mm"):""},formatDate:function(t){return this.$moment(new Date(t)).format("HH:mm D MMM YYYY")},onStatusChange:function(t){var e=this,i=e.order.status;e.order.status=t.target.value,"paid"!==i&&"paid"===e.order.status&&(e.orderChangedToPaid=!0),e.showSave=!0},onTypeChange:function(t){"quote"===t.target.value?this.order.quote=!0:this.order.quote=!1,this.showSave=!0},increaseOrderItem:function(t){this.order.vendor_order_items[t].quantity+=1,this.showSave=!0},decreaseOrderItem:function(t){var e=this;--e.order.vendor_order_items[t].quantity,0===e.order.vendor_order_items[t].quantity&&(e.order.vendor_order_items[t].id?e.order.vendor_order_items[t]._destroy=!0:e.order.vendor_order_items.splice(t,1)),e.showSave=!0},addOrderItem:function(t,e){var i,n=this;n.productsOpened=!1,n.order.vendor_order_items.forEach((function(e){e.orderable_id===t.id&&(i=!0,e._destroy&&(e._destroy=!1,delete e._destroy,e.quantity=1,n.showSave=!0))})),i||(n.order.vendor_order_items.push({orderable_id:t.id,orderable_type:e,quantity:1}),n.showSave=!0)},addOrderPromotion:function(t){this.promotionsOpened=!1,this.order.vendor_coupon_id=t.id,this.showSave=!0},deleteOrderPromotion:function(){this.order.vendor_coupon_id=null,this.showSave=!0},save:function(){var t=this,e=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Z(Object(i),!0).forEach((function(e){tt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Z(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},t.order);if(t.showSave=!1,!e.name&&e.vendor_order_items.length&&(e.name=t.productName(e.vendor_order_items[0].orderable_id,e.vendor_order_items[0].orderable_type)),e.vendor_order_items_attributes=function(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(e.vendor_order_items),e.total=t.orderItemsTotal,e.discount=t.orderDiscountTotal,delete e.vendor_order_items,t.orderChangedToPaid&&!e.event_id&&e.data.date&&e.data.nurse&&e.data.location&&e.id&&e.user_id){var i,n=e.data.date;"string"==typeof n&&(n=parseInt(n,10)),e.data.duration&&0<e.data.duration&&(i=n+60*parseInt(e.data.duration,10)*1e3),e.event_attributes={addon:"nurse_booking",title:e.name,start_at:new Date(n).toJSON(),end_at:new Date(i).toJSON(),location:"".concat(e.data.location.city," ").concat(e.data.location.address),user_id:e.user_id,team_id:null,assignee_id:e.data.nurse.user_id,assignee_team_id:t.$root.team.id,kind:"Booking",resource_id:e.id,resource_type:"VendorOrder"}}u.saveOrder(e).then((function(e){t.order=e,t.$events.$emit("invoicing:reloadListsOrders")}))}}},W,[],!1,null,null,null);function it(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-popup",{ref:"popup"},[i("f7-view",{attrs:{"ios-dynamic-navbar":!1}},[t.isFeedback?i("order-feedback",{attrs:{order:t.order,orderDuration:t.orderDuration},on:{feedbackComplete:t.onFeedbackComplete,close:t.onFeedbackClose}}):t._e(),t._v(" "),t.isFeedback?t._e():i("f7-page",{staticClass:"invoicing-page",attrs:{name:"invoicing__order-details",id:"invoicing__order-details"}},[i("f7-navbar",[i("f7-nav-left",[i("f7-link",{attrs:{"popup-close":"","icon-f7":"close"}})],1),t._v(" "),i("f7-nav-title",[t._v(t._s(t.pageTitle))]),t._v(" "),i("f7-nav-right",[t.showSave?i("f7-link",{attrs:{"icon-f7":"check"},on:{click:t.save}}):t._e()],1)],1),t._v(" "),t.order&&t.showStartButton?i("div",{staticClass:"invoicing-toolbar-button",attrs:{slot:"fixed"},on:{click:t.startOrder},slot:"fixed"},[t._v(t._s(t.$t("invoicing.order_details.start_button")))]):t._e(),t._v(" "),t.order&&t.showFinishButton?i("div",{staticClass:"invoicing-toolbar-button",attrs:{slot:"fixed"},on:{click:t.finishOrder},slot:"fixed"},[t._v(t._s(t.$t("invoicing.order_details.finish_button")))]):t._e(),t._v(" "),t.order?[i("f7-list",{staticClass:"list-custom"},[i("f7-list-item",{attrs:{title:t.$t("invoicing.order_details.due_date"),link:!1,after:t.formatOrderDate(t.order.data?parseInt(t.order.data.date,10):null)}}),t._v(" "),i("f7-list-item",{attrs:{title:t.$t("invoicing.order_details.due_time"),link:!1,after:t.formatOrderTime(t.order.data?parseInt(t.order.data.date,10):null)}}),t._v(" "),t.order.data&&t.order.data.location?i("f7-list-item",{attrs:{title:t.$t("invoicing.order_details.city"),type:"text",after:t.order.data.location.city}}):t._e(),t._v(" "),t.order.data&&t.order.data.location?i("f7-list-item",{attrs:{title:t.$t("invoicing.order_details.address"),type:"text",after:t.order.data.location.address}}):t._e(),t._v(" "),t.order.comment?i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_details.comment")}}):t._e(),t._v(" "),t.order.comment?i("f7-list-input",{attrs:{type:"textarea",value:t.order.comment,placeholder:t.$t("invoicing.order_details.comment_placeholder"),resizable:"",readonly:!0}}):t._e(),t._v(" "),t.orderUser?[i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_details.customer")}}),t._v(" "),i("f7-list-item",{attrs:{title:t.orderUserName,link:"/contact-details/?user_id="+t.order.user_id+"&masterDetailRoot=true",view:".view-main","reload-all":!0}},[i("tommy-circle-avatar",{attrs:{slot:"media",data:t.orderUser},slot:"media"})],1)]:t._e(),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.order_details.items")}}),t._v(" "),t.products&&t.packages?i("li",{staticClass:"invoicing-order-items"},t._l(t.order.vendor_order_items,(function(e,n){return e._destroy?t._e():i("div",{key:e.orderable_id+"-"+n,staticClass:"invoicing-order-item"},[i("div",{staticClass:"invoicing-order-item-name"},[t._v(t._s(t.productName(e.orderable_id,e.orderable_type)))])])})),0):t._e()],2)]:t._e()],2)],1)],1)}function nt(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-feedback"},[i("f7-navbar",[t.saved?i("f7-nav-left",[i("f7-link",{attrs:{"icon-f7":"close"},on:{click:t.closeFeedback}})],1):t._e(),t._v(" "),t.saved||"step-1"===t.step||"step-4"===t.step?t._e():i("f7-nav-left",[i("f7-link",{attrs:{icon:"icon-back"},on:{click:t.stepBack}})],1),t._v(" "),i("f7-nav-title",[t._v(t._s(t.navTitle))])],1),t._v(" "),"step-1"===t.step?i("div",{staticClass:"invoicing-feedback-buttons",attrs:{slot:"fixed"},slot:"fixed"},[i("a",{staticClass:"invoicing-feedback-button-no",on:{click:function(e){return t.setStep("step-1-2")}}},[t._v(t._s(t.t("button_no")))]),t._v(" "),i("a",{staticClass:"invoicing-feedback-button-yes",on:{click:function(e){return t.setStep("step-2")}}},[t._v(t._s(t.t("button_yes")))])]):t._e(),t._v(" "),"step-1-2"===t.step?i("div",{staticClass:"invoicing-feedback-buttons",attrs:{slot:"fixed"},slot:"fixed"},[i("a",{staticClass:"invoicing-feedback-button-submit",on:{click:function(e){return t.setStep("step-2")}}},[t._v(t._s(t.t("button_submit")))])]):t._e(),t._v(" "),"step-2"===t.step?i("div",{staticClass:"invoicing-feedback-buttons",attrs:{slot:"fixed"},slot:"fixed"},[i("a",{staticClass:"invoicing-feedback-button-submit",on:{click:function(e){return t.setStep("step-3")}}},[t._v(t._s(t.t("button_start")))])]):t._e(),t._v(" "),"step-3"===t.step?i("div",{staticClass:"invoicing-feedback-buttons",attrs:{slot:"fixed"},slot:"fixed"},[i("a",{staticClass:"invoicing-feedback-button-submit",on:{click:function(e){return t.setStep("question-1")}}},[t._v(t._s(t.t("button_next")))])]):t._e(),t._v(" "),"question-1"===t.step?i("div",{staticClass:"invoicing-feedback-buttons",attrs:{slot:"fixed"},slot:"fixed"},[i("a",{staticClass:"invoicing-feedback-button-no",on:{click:function(e){return t.setStep("question-2","no")}}},[t._v(t._s(t.t("button_no")))]),t._v(" "),i("a",{staticClass:"invoicing-feedback-button-yes",on:{click:function(e){return t.setStep("question-2","yes")}}},[t._v(t._s(t.t("button_yes")))])]):t._e(),t._v(" "),"question-2"===t.step?i("div",{staticClass:"invoicing-feedback-buttons",attrs:{slot:"fixed"},slot:"fixed"},[i("a",{staticClass:"invoicing-feedback-button-no",on:{click:function(e){return t.setStep("question-3","no")}}},[t._v(t._s(t.t("button_no")))]),t._v(" "),i("a",{staticClass:"invoicing-feedback-button-yes",on:{click:function(e){return t.setStep("question-3","yes")}}},[t._v(t._s(t.t("button_yes")))])]):t._e(),t._v(" "),"question-3"===t.step?i("div",{staticClass:"invoicing-feedback-buttons",attrs:{slot:"fixed"},slot:"fixed"},[i("a",{staticClass:"invoicing-feedback-button-no",on:{click:function(e){return t.setStep("step-4","no")}}},[t._v(t._s(t.t("button_no")))]),t._v(" "),i("a",{staticClass:"invoicing-feedback-button-yes",on:{click:function(e){return t.setStep("step-4","yes")}}},[t._v(t._s(t.t("button_yes")))])]):t._e(),t._v(" "),"step-1"===t.step?[i("div",{staticClass:"invoicing-feedback-confirm-title"},[t._v(t._s(t.t("time_confirm_title")))]),t._v(" "),t.orderDuration?i("div",{staticClass:"invoicing-feedback-confirm-time"},[t._v(t._s(t.durationFormatted)+" "+t._s(t.t("hours")))]):t._e()]:t._e(),t._v(" "),"step-1-2"===t.step?[i("div",{staticClass:"invoicing-feedback-confirm-title"},[t._v(t._s(t.t("time_select_title")))]),t._v(" "),i("div",{staticClass:"invoicing-feedback-confirm-text",domProps:{innerHTML:t._s(t.t("time_select_text"))}}),t._v(" "),i("f7-list",[i("f7-list-input",{attrs:{label:t.t("time_select_start"),"inline-label":"",type:"text",inputId:"start_date"}}),t._v(" "),i("f7-list-input",{attrs:{label:t.t("time_select_end"),"inline-label":"",type:"text",inputId:"end_date"}})],1)]:t._e(),t._v(" "),"step-2"===t.step?[i("div",{staticClass:"invoicing-feedback-question-text",domProps:{innerHTML:t._s(t.t("feedback_start_text"))}})]:t._e(),t._v(" "),"step-3"===t.step?[i("div",{staticClass:"invoicing-feedback-question-text",domProps:{innerHTML:t._s(t.t("feedback_info_text"))}})]:t._e(),t._v(" "),"question-1"===t.step?[i("div",{staticClass:"invoicing-feedback-question-text",domProps:{innerHTML:t._s(t.t("feedback_question_1"))}})]:t._e(),t._v(" "),"question-2"===t.step?[i("div",{staticClass:"invoicing-feedback-question-text",domProps:{innerHTML:t._s(t.t("feedback_question_2"))}})]:t._e(),t._v(" "),"question-3"===t.step?[i("div",{staticClass:"invoicing-feedback-question-text",domProps:{innerHTML:t._s(t.t("feedback_question_3"))}})]:t._e(),t._v(" "),"step-4"===t.step?[i("div",{staticClass:"invoicing-feedback-end-image"},[i("img",{attrs:{src:t.$addonAssetsUrl+"/feedback-image.svg"}})]),t._v(" "),i("div",{staticClass:"invoicing-feedback-end-title"},[t._v(t._s(t.t("feedback_end_title")))]),t._v(" "),i("div",{staticClass:"invoicing-feedback-end-text",domProps:{innerHTML:t._s(t.t("feedback_end_text"))}})]:t._e()],2)}et.options.__file="addons/invoicing/1.0.0/src/pages/order-details.vue";var at=et.exports;nt._withStripped=it._withStripped=!0;var rt=m({props:{order:Object,orderDuration:Number},data:function(){return{navTitle:this.t("confirm_title"),step:"step-1",q1:null,q2:null,q3:null,saved:!1,start_date:null,end_date:null}},computed:{durationFormatted:function(){return Math.floor(this.orderDuration/60*10)/10}},mounted:function(){this.$f7.navbar.size(this.$el.querySelector(".navbar"))},methods:{t:function(t,e){return this.$t("invoicing.order_feedback.".concat(t),e)},stepBack:function(){var t=this,e=t.step;"step-1-2"===e&&(t.start_date=null,t.end_date=null,t.step="step-1"),"step-2"===e&&t.start_date?(t.step="step-1-2",t.$nextTick((function(){t.initTimePickers()}))):"step-2"===e&&(t.step="step-1"),"step-3"===e&&(t.step="step-2"),"question-1"===e&&(t.step="step-3"),"question-2"===e&&(t.step="question-1"),"question-3"===e&&(t.step="question-2")},setStep:function(t,e){var i=this;"step-1-2"===t&&(i.step=t,i.$nextTick((function(){i.initTimePickers()}))),"step-2"===t&&(i.step=t),"step-3"===t&&(i.step=t),"question-1"===t&&(i.step=t),"question-2"===t&&(i.step=t,i.q1=e),"question-3"===t&&(i.step=t,i.q2=e),"step-4"===t&&(i.step=t,i.q3=e,i.saveFeedback())},initTimePickers:function(){for(var t=this,e=new Date(parseInt(t.order.data.date,10)),i=e.getTime()-864e6,n=[],a=0;a<21;a+=1)n.push(i+24*a*60*60*1e3);for(var r=[],o=0;o<24;o+=1)r.push(o<10?"0".concat(o):o);for(var s=[],c=0;c<60;c+=1)s.push(c<10?"0".concat(c):c);var l=e.getHours();l<10&&(l="0".concat(l));var d=e.getMinutes();d<10&&(d="0".concat(d)),t.$f7.picker.create({inputEl:t.$el.querySelector("#start_date"),openIn:"popover",value:[e.getTime(),l,d],cols:[{values:n,displayValues:n.map((function(e){return t.$moment(e).format("ddd, DD MMM")}))},{values:r},{divider:!0,content:":"},{values:s}],formatValue:function(t,e){return"".concat(e[0]," ").concat(e[1],":").concat(e[2])},on:{change:function(e,i){var n=new Date(parseInt(i[0],10));n.setHours(parseInt(i[1],10),parseInt(i[2],10),0,0),t.start_date=n}}});var u=new Date(e.getTime()+60*t.orderDuration*1e3),v=u.getHours();v<10&&(v="0".concat(v));var m=u.getMinutes();m<10&&(m="0".concat(m)),t.$f7.picker.create({inputEl:t.$el.querySelector("#end_date"),openIn:"popover",value:[e.getTime(),v,m],cols:[{values:n,displayValues:n.map((function(e){return t.$moment(e).format("ddd, DD MMM")}))},{values:r},{divider:!0,content:":"},{values:s}],formatValue:function(t,e){return"".concat(e[0]," ").concat(e[1],":").concat(e[2])},on:{change:function(e,i){var n=new Date(parseInt(i[0],10));n.setHours(parseInt(i[1],10),parseInt(i[2],10),0,0),t.end_date=n}}})},saveFeedback:function(){var t=this;t.$emit("feedbackComplete",{feedback:{question1:t.q1,question2:t.q2,question3:t.q2,start_date:t.start_date?t.start_date.toJSON():null,end_date:t.end_date?t.end_date.toJSON():null},callback:function(){t.saved=!0}})},closeFeedback:function(){this.$emit("close")}}},nt,[],!1,null,null,null);function ot(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function st(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ot(Object(i),!0).forEach((function(e){ct(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ot(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function ct(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}rt.options.__file="addons/invoicing/1.0.0/src/components/order-feedback.vue";var lt=m({components:{OrderFeedback:rt.exports},props:{id:[Number,String]},data:function(){return{pageTitle:this.id?"".concat(this.$t("invoicing.order_details.title","Order")," #").concat(this.id):this.$t("invoicing.order_details.new_title"),order:null,showSave:!1,orderStatuses:D,products:null,packages:null,isFeedback:!1,orderDuration:0,orderUser:null}},mounted:function(){var t=this;Promise.all([u.loadOrder(t.id).then((function(e){t.order=e;var i=t.$root.teamMembers.filter((function(t){return t.user_id===parseInt(e.user_id,10)}))[0];i?t.orderUser=i:t.$api.getContact(e.user_id).then((function(e){t.orderUser=e}))})),u.loadProducts().then((function(e){t.products=e})),u.loadPackages().then((function(e){t.packages=e}))]).then((function(){t.orderDuration=t.calcOrderDuration()}))},computed:{orderUserName:function(){var t=this.orderUser;return t?t.friend_team_name?t.friend_team_name.trim():t.name?t.name.trim():t.first_name?"".concat(t.first_name).concat(t.last_name?" ".concat(t.last_name):"").trim():"":""},showStartButton:function(){if("paid"!==this.order.status)return!1;var t=(new Date(parseInt(this.order.data.date,10)).getTime()-(new Date).getTime())/1e3/60;return Math.abs(t)<=60},showFinishButton:function(){return"processing"===this.order.status},orderItemsTotal:function(){var t=this,e=0;return t.order.vendor_order_items.forEach((function(i){e+=t.productPrice(i.orderable_id,i.orderable_type)*i.quantity})),e}},methods:{calcOrderDuration:function(){var t=this,e=0;return t.order&&t.products&&t.packages&&t.order.vendor_order_items.forEach((function(i){e+=t.productDuration(i.orderable_id,i.orderable_type)*i.quantity})),e},productName:function(t,e){var i=this["Vendor::Product"===(1<arguments.length&&void 0!==e?e:"Vendor::Product")?"products":"packages"].filter((function(e){return e.id===parseInt(t,10)}))[0];return i?i.name:""},productPrice:function(t,e){var i=this["Vendor::Product"===(1<arguments.length&&void 0!==e?e:"Vendor::Product")?"products":"packages"].filter((function(e){return e.id===parseInt(t,10)}))[0];return i?i.price:0},productDuration:function(t,e){var i=this["Vendor::Product"===(1<arguments.length&&void 0!==e?e:"Vendor::Product")?"products":"packages"].filter((function(e){return e.id===parseInt(t,10)}))[0];return i?parseInt(i.data.duration,10):0},formatOrderDate:function(t){return t?this.$moment(new Date(parseInt(t,10))).format("D MMM YYYY"):""},formatOrderTime:function(t){return t?this.$moment(new Date(parseInt(t,10))).format("HH:mm"):""},formatDate:function(t){return this.$moment(new Date(t)).format("HH:mm D MMM YYYY")},startOrder:function(){var t=this,e=st({},t.order);e.status="processing",e.data.feedback||(e.data.feedback={}),e.data.feedback.actual_start_date=(new Date).toJSON(),u.saveOrder(e).then((function(e){t.order=e,t.$events.$emit("invoicing:reloadListsOrders")}))},finishOrder:function(){this.$refs.popup.f7Popup.params.closeByBackdropClick=!1,this.isFeedback=!0},onFeedbackComplete:function(t){var e=this,i=t.feedback,n=st({},e.order);n.status="qa",n.data.feedback?Object.assign(n.data.feedback,i):n.data.feedback=i,n.data.feedback.actual_end_date=(new Date).toJSON(),delete n.vendor_order_items,u.saveOrder(n).then((function(i){e.order=i,e.$events.$emit("invoicing:reloadListsOrders"),t.callback&&t.callback()}))},onFeedbackClose:function(){this.isFeedback=!1,this.$refs.popup.f7Popup.close()}}},it,[],!1,null,null,null);function dt(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{name:"invoicing__promotion-management",id:"invoicing__promotion-management"}},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.$t("invoicing.promotion_management.title","Promotions")))]),t._v(" "),i("f7-nav-right",[i("f7-link",{attrs:{href:"/invoicing/promotion-details/","icon-f7":"add"}})],1)],1),t._v(" "),t.items&&t.items.length?i("f7-searchbar",{attrs:{slot:"static","search-container":".invoicing-list-items",backdrop:!1,"disable-button":!1,placeholder:t.$t("invoicing.promotion_management.search_placeholder")},slot:"static"}):t._e(),t._v(" "),t.items&&t.items.length?i("f7-list",{staticClass:"list-custom invoicing-list-items",attrs:{slot:"static","no-hairlines":""},slot:"static"},t._l(t.orderedPromotions,(function(t){return i("f7-list-item",{key:t.id,attrs:{title:t.name,link:"/invoicing/promotion-details/"+t.id+"/?title="+encodeURIComponent(t.name||"")}})})),1):t._e()],1)}lt.options.__file="addons/invoicing/1.0.0/src/pages/order-details-nurse.vue";var ut=lt.exports;dt._withStripped=!0;var vt=m({data:function(){return{items:null,packages:null,activeTab:"items"}},mounted:function(){this.loadPromotions(),this.$events.$on("invoicing:reloadPromotions",this.loadPromotions)},beforeDestroy:function(){this.$events.$off("invoicing:reloadPromotions",this.loadPromotions)},computed:{orderedPromotions:function(){return this.items?this.items.sort((function(t,e){return t.id-e.id})):[]}},methods:{loadPromotions:function(){var t=this;u.loadPromotions({},{cache:!1}).then((function(e){t.items=e}))}}},dt,[],!1,null,null,null);function mt(){var t=this,e=t.$createElement,i=t._self._c||e;return i("f7-page",{staticClass:"invoicing-page",attrs:{id:"invoicing__promotion-details","data-name":"invoicing__promotion-details"}},[i("f7-navbar",[i("tommy-nav-back"),t._v(" "),i("f7-nav-title",[t._v(t._s(t.pageTitle))]),t._v(" "),i("f7-nav-right",[t.showSave?i("f7-link",{attrs:{"icon-f7":"check"},on:{click:t.save}}):t._e()],1)],1),t._v(" "),t.item?i("f7-list",{staticClass:"list-custom"},[i("f7-list-input",{attrs:{label:t.$t("invoicing.promotion.name_label","Name"),placeholder:t.$t("invoicing.promotion.name_placeholder","Enter promotion name"),type:"text",value:t.item.name},on:{input:function(e){t.item.name=e.target.value,t.enableSave()}}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.promotion.description_label","Description")}}),t._v(" "),i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.promotion.description_placeholder","Enter promotion description"),type:"textarea",resizable:"",value:t.item.description},on:{input:function(e){t.item.description=e.target.value,t.enableSave()}}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.promotion.expires_label","Description")}}),t._v(" "),i("f7-list-input",{staticClass:"invoicing-valid-to-input",attrs:{title:t.$t("invoicing.order_details.due_date"),type:"text",readonly:"",value:t.item.valid_to?t.$moment(t.item.valid_to).format("D MMM YYYY"):""},on:{focus:t.openCalendar}},[i("span",{staticClass:"input-clear-button margin-right",attrs:{slot:"inner"},on:{click:function(e){t.item.valid_to=null,t.enableSave()}},slot:"inner"})]),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.promotion.type_label")}}),t._v(" "),i("f7-list-item",{attrs:{checkbox:"",title:t.$t("invoicing.promotion.type_voucher_label"),checked:"voucher"===t.item.kind},on:{change:function(e){return t.setKind("voucher")}}}),t._v(" "),i("f7-list-item",{attrs:{checkbox:"",title:t.$t("invoicing.promotion.type_fixed_label"),checked:"fixed"===t.item.kind},on:{change:function(e){return t.setKind("fixed")}}}),t._v(" "),i("f7-list-item",{attrs:{checkbox:"",title:t.$t("invoicing.promotion.type_percentage_label"),checked:"percentage"===t.item.kind},on:{change:function(e){return t.setKind("percentage")}}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.promotion.amount_label","Discount amount")}}),t._v(" "),"fixed"===t.item.kind||"voucher"===t.item.kind?i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.promotion.amount_placeholder","Enter promotion discount"),type:"text",value:t.item.amount?"¥"+t.item.amount:""},on:{input:function(e){return t.setAmount(e.target.value)}}}):t._e(),t._v(" "),"percentage"===t.item.kind?i("f7-list-item",[i("f7-range",{staticClass:"invoicing-range-slider",attrs:{value:t.item.amount,min:0,max:1,step:.01,"format-label":function(t){return Math.floor(100*t)+"%"},label:""},on:{"range:changed":function(e){return t.setAmount(e)}}}),t._v(" "),i("div",{staticClass:"invoicing-range-slider-value"},[t._v(t._s(Math.floor(100*t.item.amount))+"%")])],1):t._e(),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.promotion.category_label","Category")}}),t._v(" "),i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.promotion.category_label","Category"),type:"text",value:t.item.category},on:{input:function(e){t.item.category=e.target.value,t.enableSave()}}}),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.promotion.max_uses_label")}}),t._v(" "),i("f7-list-input",{attrs:{placeholder:t.$t("invoicing.promotion.max_uses_placeholder"),type:"number",value:t.item.max_uses},on:{input:function(e){t.item.max_uses=e.target.value,t.enableSave()}}}),t._v(" "),t.contacts?[i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.promotion.customer_label","Customer")}}),t._v(" "),i("f7-list-item",{attrs:{title:t.customerTitle,link:""},on:{click:function(e){t.customerPopupOpened=!0}}},[t.customerAvatar?i("tommy-circle-avatar",{attrs:{slot:"media",data:t.customerAvatar},slot:"media"}):t._e()],1)]:t._e(),t._v(" "),i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.promotion.item_label","Item")}}),t._v(" "),t.products&&t.packages?i("f7-list-item",{attrs:{title:t.itemTitle,link:""},on:{click:function(e){t.itemsPopupOpened=!0}}},[t.itemAvatar?i("tommy-circle-avatar",{attrs:{slot:"media",url:t.itemAvatar},slot:"media"}):t._e()],1):t._e(),t._v(" "),i("f7-list-item",[i("span",[t._v(t._s(t.$t("invoicing.promotion.valid")))]),t._v(" "),i("f7-toggle",{attrs:{checked:t.couponValid,color:"#FF5413"},on:{change:t.toggleCouponValid}})],1)],2):t._e(),t._v(" "),t.item?i("f7-popup",{attrs:{opened:t.customerPopupOpened},on:{"popup:closed":function(e){t.customerPopupOpened=!1}}},[i("f7-view",{attrs:{init:!1}},[i("f7-page",{staticClass:"invoicing-page"},[i("f7-navbar",[i("f7-nav-title",[t._v(t._s(t.$t("invoicing.promotion.customer_label")))]),t._v(" "),i("f7-nav-right",[i("f7-link",{attrs:{"popup-close":"","icon-f7":"close"}})],1)],1),t._v(" "),i("f7-searchbar",{attrs:{"search-container":".invoicing-promotion-customers-list"}}),t._v(" "),i("f7-list",{staticClass:"invoicing-promotion-customers-list",attrs:{"virtual-list":"","virtual-list-params":{items:t.contactsSorted,searchAll:t.contactsSearchAll,renderExternal:t.contactsRenderExternal,height:65}}},[i("ul",t._l(t.contactsVlData.items,(function(e,n){return i("f7-list-item",{key:"contact-"+n+"-"+(e.friend_id||e.id),style:"top: "+t.contactsVlData.topPosition+"px",attrs:{title:(e.first_name||"")+" "+(e.last_name||""),"virtual-list-index":t.contactsSorted.indexOf(t.item),checked:e.friend_id?t.item.user_id===e.friend_id:t.item.user_id===e.user_id,radio:""},on:{click:function(){t.item.user_id=e.friend_id||e.user_id,t.customerPopupOpened=!1,t.enableSave()}}},[i("tommy-circle-avatar",{attrs:{slot:"media",data:e},slot:"media"})],1)})),1)])],1)],1)],1):t._e(),t._v(" "),t.item&&t.products&&t.packages?i("f7-popup",{attrs:{opened:t.itemsPopupOpened},on:{"popup:closed":function(e){t.itemsPopupOpened=!1}}},[i("f7-view",{attrs:{init:!1}},[i("f7-page",{staticClass:"invoicing-page"},[i("f7-navbar",[i("f7-nav-title",[t._v(t._s(t.$t("invoicing.promotion.item_label")))]),t._v(" "),i("f7-nav-right",[i("f7-link",{attrs:{"popup-close":"","icon-f7":"close"}})],1)],1),t._v(" "),i("f7-searchbar",{attrs:{"search-container":".invoicing-promotion-items-list","disable-button":!1}}),t._v(" "),i("f7-list",{staticClass:"invoicing-promotion-items-list"},[t.products.length?i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item_service_management.items_tab")}}):t._e(),t._v(" "),t._l(t.products,(function(e){return i("f7-list-item",{key:e.id,attrs:{title:e.name,radio:"",checked:t.item.vendor_product_id===e.id},on:{click:function(){t.item.vendor_product_id=e.id,t.item.vendor_package_id=null,t.itemsPopupOpened=!1,t.enableSave()}}},[i("tommy-circle-avatar",{attrs:{slot:"media",url:e.image_url},slot:"media"})],1)})),t._v(" "),t.packages.length?i("f7-list-item",{attrs:{divider:"",title:t.$t("invoicing.item_service_management.packages_tab")}}):t._e(),t._v(" "),t._l(t.packages,(function(e){return i("f7-list-item",{key:e.id,attrs:{title:e.name,radio:"",checked:t.item.vendor_package_id===e.id},on:{click:function(){t.item.vendor_product_id=null,t.item.vendor_package_id=e.id,t.itemsPopupOpened=!1,t.enableSave()}}},[i("tommy-circle-avatar",{attrs:{slot:"media",url:e.image_url},slot:"media"})],1)}))],2)],1)],1)],1):t._e()],1)}vt.options.__file="addons/invoicing/1.0.0/src/pages/promotion-management.vue";var _t=vt.exports;function pt(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}mt._withStripped=!0;var ft=m({components:{tagSelect:N},props:{id:[String,Number]},data:function(){return{pageTitle:this.$f7route.query.title||this.$t("invoicing.promotion.new_title"),item:null,showSave:!1,customerPopupOpened:!1,itemsPopupOpened:!1,products:null,packages:null,contacts:u.contacts,couponValid:!0,contactsVlData:{items:[]}}},mounted:function(){var t=this;t.id?u.loadPromotion(t.id).then((function(e){t.item=e,t.couponValid=t.item.used?!t.item.used:t.couponValid})):t.item={description:"",name:"",amount:0,user_id:null,vendor_product_id:null,vendor_package_id:null,category:null,kind:"fixed",valid_from:null,valid_to:null,max_uses:null,used:!t.couponValid},t.contacts?Promise.all([u.loadProducts(),u.loadPackages()]).then((function(e){var i=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var i=[],n=!0,a=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){a=!0,r=t}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}return i}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(e,2),n=i[0],a=i[1];t.products=n,t.packages=a})):t.$api.getContacts.then((function(e){t.contacts=e,u.contacts=e}))},computed:{contactsSorted:function(){return[].concat(pt(this.contacts||[]),pt(this.$root.teamMembers))},customerAvatar:function(){var t,e=this;return e.item.user_id?(e.$root.teamMembers&&(t=e.$root.teamMembers.filter((function(t){return t.user_id===e.item.user_id}))[0]),!t&&e.contacts&&(t=e.contacts.filter((function(t){return t.friend_id===e.item.user_id}))[0]),t||null):null},customerTitle:function(){var t,e=this;return e.item.user_id?(e.$root.teamMembers&&(t=e.$root.teamMembers.filter((function(t){return t.user_id===e.item.user_id}))[0]),!t&&e.contacts&&(t=e.contacts.filter((function(t){return t.friend_id===e.item.user_id}))[0]),t?"".concat(t.first_name||""," ").concat(t.last_name||""):""):e.$t("invoicing.promotion.customer_placeholder")},itemAvatar:function(){var t,e=this;return e.item.vendor_product_id||e.item.vendor_package_id?(e.item.vendor_product_id&&(t=e.products.filter((function(t){return t.id===e.item.vendor_product_id}))[0]),e.item.vendor_package_id&&(t=e.packages.filter((function(t){return t.id===e.item.vendor_package_id}))[0]),t?t.image_url:null):null},itemTitle:function(){var t,e=this;return e.item.vendor_product_id||e.item.vendor_package_id?(e.item.vendor_product_id&&(t=e.products.filter((function(t){return t.id===e.item.vendor_product_id}))[0]),e.item.vendor_package_id&&(t=e.packages.filter((function(t){return t.id===e.item.vendor_package_id}))[0]),t?t.name:""):e.$t("invoicing.promotion.item_placeholder")}},methods:{contactsSearchAll:function(t,e){var i=[];console.log(t);for(var n=0;n<e.length;n+=1)(0<="".concat(e[n].first_name||""," ").concat(e[n].last_name||"").toLowerCase().indexOf(t.toLowerCase())||""===t.trim())&&i.push(n);return console.log(i),i},contactsRenderExternal:function(t,e){this.contactsVlData=e},toggleCouponValid:function(){this.couponValid=!this.couponValid,this.item.used=!this.couponValid,this.enableSave()},openCalendar:function(){var t=this;t.calendarTo=t.$f7.calendar.create({openIn:"customModal",value:t.item.valid_to?[new Date(t.item.valid_to)]:[],backdrop:!0,closeByOutsideClick:!1,on:{change:function(e,i){t.item.valid_to=t.$moment(new Date(i[0])).format(),t.enableSave()}}}),t.calendarTo.once("closed",(function(){t.calendarTo.destroy()})),t.calendarTo.open()},formatValueDate:function(t){return t?this.$moment(new Date(t)).format("YYYY-MM-DDTHH:mm"):""},onDateChange:function(t){var e=t.target.value;clearTimeout(this.dateChangeTimeout),this.item.valid_to=new Date(e).toJSON(),this.enableSave()},setKind:function(t){var e=this,i=e.item.kind;e.item.kind!==t&&("fixed"!==t&&"voucher"!==t||"percentage"!==i?"percentage"===t&&e.setAmount(.5):e.setAmount(0),e.item.kind=t,e.enableSave())},setAmount:function(t){var e=t;(e="string"==typeof e?t.replace(/[¥ ]*/,"").replace(/,/g,".").trim():1<=e?1:(e=Math.floor(1e3*e/10))<10?parseFloat("0.0".concat(e)):parseFloat("0.".concat(e)))<0?this.$f7.dialog.alert(this.$t("invoicing.promotion_management.wrong_amount")):(this.item.amount=e,this.$set(this.item,"amount",e),this.enableSave())},enableSave:function(){this.showSave=!0},save:function(){var t=this;t.showSave=!1,"string"==typeof t.item.amount&&(t.item.amount=parseFloat(t.item.amount),Number.isNaN(t.item.amount)&&(t.item.amount=0)),t.item.vendor_product_id&&(t.item.vendor_package_id=null),t.item.vendor_package_id&&(t.item.vendor_product_id=null),u.savePromotion(t.item).then((function(){t.$events.$emit("invoicing:reloadPromotions"),t.$f7router.back()}))}}},mt,[],!1,null,null,null);ft.options.__file="addons/invoicing/1.0.0/src/pages/promotion-details.vue";var gt=[{path:"/invoicing/",component:f},{path:"/invoicing/settings/",component:b},{path:"/invoicing/item-service-management/",component:$},{path:"/invoicing/list-management/",component:O},{path:"/invoicing/promotion-management/",component:_t},{path:"/invoicing/list-add/",component:T},{path:"/invoicing/list-edit/date-range/",component:R},{path:"/invoicing/list-edit/:listId/",component:E},{path:"/invoicing/tag-select/",component:U},{path:"/invoicing/product-details/:id?/",component:B},{path:"/invoicing/package-details/:id?/",component:G},{path:"/invoicing/range-select/",component:X},{path:"/invoicing/order-details/:id?/",popup:{async:function(t,e,i){i({component:u.isNurse?ut:at})}}},{path:"/invoicing/promotion-details/:id?/",component:ft.exports}];e.default=gt}]).default;