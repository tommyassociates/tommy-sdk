var addon=function(){var d=window.tommy.api,c={actorId:null,actor:null,getRecords:function getRecords(t,e,a,n){void 0===n&&(n={});var i,s=n.page,l=n.limit,r=n.dateFrom,o=n.dateTo;return e=e.split(/[-_]/g).map(function(t){return t[0].toUpperCase()+t.substr(1)}).join(""),r&&o&&(i=[new Date(r).toJSON(),new Date(o).toJSON()]),d.getFragments({addon:t,kind:"Vitals"+e+"Item",with_filters:!0,with_permission_to:!0,user_id:c.actorId||a.id,actor_id:c.actorId,page:s||1,limit:l||50,date_range:i},{cache:!1})},addRecord:function addRecord(t,e,a,n){e=e.split(/[-_]/g).map(function(t){return t[0].toUpperCase()+t.substr(1)}).join("");var i=new Date(n.date);i.setHours(parseInt(n.time.split(":")[0],10),parseInt(n.time.split(":")[1],10));var s=c.actor||a,l={addon:t,kind:"Vitals"+e+"Item",with_filters:!0,start_at:i.toJSON(),tags:[{context:"members",name:s.first_name+" "+s.last_name,user_id:s.id}],filters:[{context:"members",name:s.first_name+" "+s.last_name,user_id:s.id}],data:JSON.stringify(n)};return c.actorId&&(l.actor_id=c.actorId,l.actor_type="User"),d.createFragment(l)},getSettings:function getSettings(t){return d.call({endpoint:"addons/"+t+"/install/settings/addonSettings",method:"GET",cache:!1}).then(function(t){return t?t.data?t.data:null:t})},saveSettings:function saveSettings(t,e){return void 0===e&&(e={}),d.call({endpoint:"addons/"+t+"/install/settings/addonSettings",method:"PUT",data:{data:JSON.stringify(e)}})}},t={render:function(){var a=this,t=a.$createElement,n=a._self._c||t;return n("f7-page",{class:"vitals-elment-index-page vitals-"+a.vitalsElement+"-index-page",attrs:{id:"vitals_element__index"},on:{"page:beforein":a.onPageBeforeIn,"page:beforeout":a.onPageBeforeOut},nativeOn:{"!scroll":function(t){return a.onPageScroll(t)}}},[n("f7-navbar",[n("tommy-nav-menu"),a._v(" "),n("f7-nav-title",[a._v(a._s(a.t("title")))]),a._v(" "),n("f7-nav-right",[n("f7-link",{attrs:{href:"/"+a.addon+"/settings/","icon-only":""}},[n("i",{class:"icon vitals-element-icon-settings vitals-"+a.vitalsElement+"-icon-settings"})]),a._v(" "),n("f7-link",{attrs:{href:"/"+a.addon+"/history/","icon-only":"","route-props":{goalValue:a.settings?a.settings.goal_value:0}}},[n("i",{class:"icon vitals-element-icon-chart vitals-"+a.vitalsElement+"-icon-chart"})])],1)],1),a._v(" "),n("f7-fab",{class:"vitals-element-fab vitals-"+a.vitalsElement+"-fab",attrs:{href:"/"+a.addon+"/add/"}},[n("f7-icon",{attrs:{f7:"add"}})],1),a._v(" "),n("div",{class:"vitals-element-index-header vitals-"+a.vitalsElement+"-index-header"},[n("div",{class:"vitals-element-index-header-icon vitals-"+a.vitalsElement+"-index-header-icon"}),a._v(" "),a.data&&a.data.length?n("div",{class:"vitals-element-index-header-content vitals-"+a.vitalsElement+"-index-header-content"},[a.settings&&a.settings.goal_value?n("div",{class:"vitals-"+a.vitalsElement+"-index-header-data-row"},[n("div",{class:"vitals-"+a.vitalsElement+"-index-header-data-label"},[a._v(a._s(a.t("goal_label")))]),a._v(" "),n("div",{class:"vitals-element-index-header-data vitals-"+a.vitalsElement+"-index-header-data"},[a._v(a._s(a.settings.goal_value)),n("span",[a._v(a._s(a.t("vital_unit."+(a.settings.goal_unit||5))))])])]):a._e(),a._v(" "),n("div",{class:"vitals-"+a.vitalsElement+"-index-header-data-row"},[n("div",{class:"vitals-"+a.vitalsElement+"-index-header-data-label"},[a._v(a._s(a.t("achieved_label")))]),a._v(" "),n("div",{class:"vitals-element-index-header-data vitals-"+a.vitalsElement+"-index-header-data"},[a._v(a._s(a.todayValue)),n("span",[a._v(a._s(a.t("vital_unit."+(a.data[0].data.unit||5))))])])])]):a._e(),a._v(" "),a.data&&!a.data.length?n("div",{class:"vitals-element-index-header-content vitals-"+a.vitalsElement+"-index-header-content"},[n("div",{class:"vitals-element-index-header-data vitals-"+a.vitalsElement+"-index-header-data"},[a._v(a._s(a.t("vital_label")))])]):a._e()]),a._v(" "),a.data&&!a.data.length?n("div",{class:"vitals-element-index-no-data vitals-"+a.vitalsElement+"-index-no-data"},[n("i",{class:"vitals-element-index-no-data-img vitals-"+a.vitalsElement+"-index-no-data-img"}),a._v(" "),n("span",[a._v(a._s(a.t("not_available")))])]):a._e(),a._v(" "),a.data&&a.data.length?n("div",{class:"vitals-element-index-cards vitals-"+a.vitalsElement+"-index-cards"},a._l(a.data,function(t,e){return n("div",{key:e,class:"vitals-element-card vitals-"+a.vitalsElement+"-card"},[n("div",{class:"vitals-element-card-title vitals-"+a.vitalsElement+"-card-title"},[a._v(a._s(a.$moment(t.data.date).format("DD MMM YYYY"))+" "+a._s(t.data.time))]),a._v(" "),n("div",{class:"vitals-element-card-content vitals-"+a.vitalsElement+"-card-content"},[n("div",{class:"vitals-element-card-icon vitals-"+a.vitalsElement+"-card-icon"},[t.data.value<200?n("img",{attrs:{src:a.$addonAssetsUrl+"card-icon-cup.svg"}}):t.data.value<350?n("img",{attrs:{src:a.$addonAssetsUrl+"card-icon-glass.svg"}}):n("img",{attrs:{src:a.$addonAssetsUrl+"card-icon-bottle.svg"}})]),a._v(" "),n("div",{class:"vitals-element-card-value vitals-"+a.vitalsElement+"-card-value"},[a._v(a._s(t.data.value)+" "),n("sub",[a._v(a._s(a.t("vital_unit."+(t.data.unit||0))))])])])])})):a._e()],1)},staticRenderFns:[],props:{addon:String,vitalsElement:String},data:function data(){return{data:null,settings:null}},mounted:function mounted(){var e=this;e.$f7route.query.actor_id?(c.actorId=parseInt(e.actorId,10),e.$api.getContact(e.actorId).then(function(t){c.actor=t})):(c.actorId=null,c.actor=null),e.getData(),e.$events.$on(e.addon+":updateRecords",e.getData),c.getSettings(e.addon).then(function(t){t&&(e.settings=t)})},beforeDestroy:function beforeDestroy(){var t=this;t.$events.$off(t.addon+":updateRecords",t.getData)},computed:{todayValue:function todayValue(){if(!this.data)return null;var e=0,a=new Date;return a.setHours(0,0,0,0),this.data.forEach(function(t){new Date(t.data.date).getTime()===a.getTime()&&(e+=t.data.value)}),e}},methods:{t:function t(e,a){return this.$t(this.addon+".index."+e,a)},getData:function getData(){var e=this;c.getRecords(e.addon,e.vitalsElement,e.$root.user).then(function(t){e.data=t.filter(function(t){return t.data&&t.data.value}).sort(function(t,e){var a=new Date(t.data.date),n=t.data.time.split(":"),i=n[0],s=n[1];a.setHours(parseInt(i,10),parseInt(s,10));var l=new Date(e.data.date),r=e.data.time.split(":"),o=r[0],d=r[1];return l.setHours(parseInt(o,10),parseInt(d,10)),l-a})})},onPageScroll:function onPageScroll(t){var e=this,a=e.$$(t.target).closest(".page-content");a.length&&(100<a[0].scrollTop?e.$f7router.view.$navbarEl.removeClass("vitals-element-index-navbar vitals-"+e.vitalsElement+"-index-navbar"):e.$f7router.view.$navbarEl.addClass("vitals-element-index-navbar vitals-"+e.vitalsElement+"-index-navbar"))},onPageBeforeIn:function onPageBeforeIn(){this.$f7router.view.$navbarEl.addClass("vitals-element-index-navbar vitals-"+this.vitalsElement+"-index-navbar")},onPageBeforeOut:function onPageBeforeOut(){this.$f7router.view.$navbarEl.removeClass("vitals-element-index-navbar vitals-"+this.vitalsElement+"-index-navbar")}}},e={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{class:"vitals-element-manual-add-page vitals-"+e.vitalsElement+"-manual-add-page",attrs:{id:"vitals_element__add"}},[a("f7-navbar",[a("tommy-nav-back"),e._v(" "),a("f7-nav-title",[e._v(e._s(e.t("title")))])],1),e._v(" "),a("f7-list",{attrs:{"no-chevron":"","no-hairlines":"","no-hairlines-between":""}},[a("f7-list-item",{attrs:{link:"",title:""+e.t("option_a_label")+e.t("vital_unit.5")},on:{click:function(t){e.addValue(150)}}},[a("img",{attrs:{slot:"media",src:e.$addonAssetsUrl+"card-icon-cup.svg"},slot:"media"})]),e._v(" "),a("f7-list-item",{attrs:{link:"",title:""+e.t("option_b_label")+e.t("vital_unit.5")},on:{click:function(t){e.addValue(220)}}},[a("img",{attrs:{slot:"media",src:e.$addonAssetsUrl+"card-icon-glass.svg"},slot:"media"})]),e._v(" "),a("f7-list-item",{attrs:{link:"",title:""+e.t("option_c_label")+e.t("vital_unit.5")},on:{click:function(t){e.addValue(350)}}},[a("img",{attrs:{slot:"media",src:e.$addonAssetsUrl+"card-icon-bottle.svg"},slot:"media"})]),e._v(" "),a("f7-list-item",{attrs:{link:"",title:""+e.t("option_d_label")+e.t("vital_unit.5")},on:{click:function(t){e.addValue(400)}}},[a("img",{attrs:{slot:"media",src:e.$addonAssetsUrl+"card-icon-bottle.svg"},slot:"media"})]),e._v(" "),a("f7-list-item",{class:"vitals-"+e.vitalsElement+"-manual-add-custom-button",attrs:{link:"",title:""+e.t("custom_button")},on:{click:e.addCustom}})],1)],1)},staticRenderFns:[],props:{addon:String,vitalsElement:String},data:function data(){return{}},computed:{allowSave:function allowSave(){return this.value&&0<this.value}},mounted:function mounted(){},methods:{t:function t(e,a){return this.$t(this.addon+".manual_enter."+e,a)},addCustom:function addCustom(){var n=this;n.$f7.dialog.create({text:n.$t("vitals_water_tracker.custom_amount.text"),content:'<div class="dialog-input-field item-input"><div class="item-input-wrap"><input type="number" class="dialog-input"></div></div>',buttons:[{text:n.$t("vitals_water_tracker.custom_amount.cancel_button"),keyCodes:[27]},{text:n.$t("vitals_water_tracker.custom_amount.confirm_button"),bold:!0,color:"red",keyCodes:[13]}],onClick:function onClick(t,e){var a=t.$el.find(".dialog-input").val();1===e&&a&&n.addValue(parseFloat(a))},destroyOnClose:!0}).open()},addValue:function addValue(t){var e=this,a=new Date,n=(new Date).getHours();n<10&&(n="0"+n);var i=(new Date).getMinutes();i<10&&(i="0"+i);var s=n+":"+i;a.setHours(0,0,0,0),c.addRecord(e.addon,e.vitalsElement,e.$root.user,{value:t,date:new Date(a).toJSON(),time:s,unit:5}).then(function(){e.$events.$emit(e.addon+":updateRecords"),e.$f7router.back()})}}},a={receiveMessage:!1,goal_value:0,goal_start_time:"08:00",goal_end_time:"22:00",goal_time_interval:60,goal_unit:5},n=[{path:"/vitals_water_tracker/",component:t},{path:"/vitals_water_tracker/add/",component:e},{path:"/vitals_water_tracker/settings/",component:{render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("f7-page",{class:"vitals-element-settings-page vitals-"+t.vitalsElement+"-settings-page",attrs:{id:"vitals_element__settings"}},[a("f7-navbar",[a("tommy-nav-back"),t._v(" "),a("f7-nav-title",[t._v(t._s(t.t("title")))])],1),t._v(" "),a("div",{class:"vitals-element-settings-header vitals-"+t.vitalsElement+"-settings-header"},[a("div",{class:"vitals-element-settings-icon vitals-"+t.vitalsElement+"-settings-icon"}),t._v(" "),a("div",{class:"vitals-element-settings-center-icon vitals-"+t.vitalsElement+"-settings-center-icon"})]),t._v(" "),a("div",{class:"vitals-element-settings-text vitals-"+t.vitalsElement+"-settings-text"},[a("p",[t._v(t._s(t.t("vital_text")))])]),t._v(" "),a("f7-list",{staticClass:"no-hairlines"},[a("f7-list-item",{attrs:{title:t.t("chat_label")}},[a("f7-toggle",{attrs:{slot:"after",checked:t.settings.receiveMessage},on:{"toggle:change":t.onMessagesChanges},slot:"after"})],1),t._v(" "),a("f7-list-item",{attrs:{title:t.t("plan_label"),link:"/vitals_water_tracker/plan/",after:t.settings.goal_value?""+t.settings.goal_value+t.t("vital_unit."+t.settings.goal_unit):"","route-props":{settings:t.settings}}})],1)],1)},staticRenderFns:[],props:{addon:String,vitalsElement:String},data:function data(){return{settings:a}},mounted:function mounted(){var e=this;c.getSettings(e.addon).then(function(t){t&&(e.settings=t,a=e.settings)}),e.$events.$on(e.addon+":updateGoal",e.updateGoal)},beforeDestroy:function beforeDestroy(){this.$events.$off(this.addon+":updateGoal",this.updateGoal)},methods:{t:function t(e,a){return this.$t(this.addon+".settings."+e,a)},updateGoal:function updateGoal(t){var e=this;e.settings.goal_value=t.value,e.settings.goal_start_time=t.start_time,e.settings.goal_end_time=t.end_time,e.settings.goal_time_interval=t.time_interval,e.settings.goal_unit=t.unit,a=e.settings,c.saveSettings(e.addon,e.settings)},onMessagesChanges:function onMessagesChanges(t){this.settings.receiveMessage=t,a=this.settings,c.saveSettings(this.addon,this.settings)}}}},{path:"/vitals_water_tracker/history/",component:{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{class:"vitals-element-history-page vitals-"+e.vitalsElement+"-history-page",attrs:{id:"vitals_element__history"}},[a("f7-navbar",[a("tommy-nav-back"),e._v(" "),a("f7-nav-title",[e._v(e._s(e.t("title")))])],1),e._v(" "),a("f7-block",[a("f7-segmented",[a("f7-button",{attrs:{active:"day"===e.range},on:{click:function(t){e.range="day"}}},[e._v(e._s(e.t("date_options.0")))]),e._v(" "),a("f7-button",{attrs:{active:"week"===e.range},on:{click:function(t){e.range="week"}}},[e._v(e._s(e.t("date_options.1")))]),e._v(" "),a("f7-button",{attrs:{active:"month"===e.range},on:{click:function(t){e.range="month"}}},[e._v(e._s(e.t("date_options.2")))])],1)],1),e._v(" "),a("div",{class:"vitals-element-chart-clicked vitals-"+e.vitalsElement+"-chart-clicked"},[a("span",[e._v(e._s(e.clickedDate))]),e._v(" "),a("span",[e._v(e._s(e.clickedValue))])]),e._v(" "),e.data&&e.data.length?["day"===e.range?a("div",{key:"chart-day",class:"vitals-element-chart vitals-"+e.vitalsElement+"-chart"},[a("div",{ref:"chartDay"})]):e._e(),e._v(" "),"week"===e.range?a("div",{key:"chart-week",class:"vitals-element-chart vitals-"+e.vitalsElement+"-chart"},[a("div",{ref:"chartWeek"})]):e._e(),e._v(" "),"month"===e.range?a("div",{key:"chart-month",class:"vitals-element-chart vitals-"+e.vitalsElement+"-chart"},[a("div",{ref:"chartMonth"})]):e._e()]:e._e()],2)},staticRenderFns:[],props:{addon:String,vitalsElement:String,goalValue:Number},data:function data(){return{data:null,clicked:null,range:"day"}},mounted:function mounted(){var i=this,t=(new Date).setMonth((new Date).getMonth()-1),e=new Date;c.getRecords(i.addon,i.vitalsElement,i.$root.user,{dateFrom:t,dateTo:e}).then(function(t){i.data=(t||[]).sort(function(t,e){var a=i.itemDate(t),n=i.itemDate(e);return a.getTime()-n.getTime()}),i.$nextTick(function(){i.initChart()})})},watch:{range:function range(){var t=this;t.clicked=null,t.$nextTick(function(){t.initChart()})}},computed:{clickedDate:function clickedDate(){return this.clicked?this.$moment(this.clicked.x).format("DD MMM YYYY"):""},clickedValue:function clickedValue(){var t=this;if(!t.clicked)return"";var e=t.data[t.clicked.id];return t.clicked.y+" "+t.t("vital_unit."+e.data.unit)},todayValues:function todayValues(){var e=this;if(!e.data)return null;var a=new Date;a.setHours(0,0,0,0);var t=e.data.filter(function(t){return e.itemDate(t).getTime()>a.getTime()});return e.sumValuesByDay(t)},weekValues:function weekValues(){var e=this;if(!e.data)return null;var a=new Date;a.setHours(0,0,0,0),a.setMonth(a.getMonth(),a.getDate()-7);var t=e.data.filter(function(t){return e.itemDate(t).getTime()>a.getTime()});return e.sumValuesByDay(t)},monthValues:function monthValues(){var e=this;if(!e.data)return null;var a=new Date;a.setHours(0,0,0,0),a.setMonth(a.getMonth()-1,a.getDate());var t=e.data.filter(function(t){return e.itemDate(t).getTime()>a.getTime()});return e.sumValuesByDay(t)}},methods:{sumValuesByDay:function sumValuesByDay(t){var a=this,n=[],i=a.itemDate(t[0]);i.setHours(0,0,0,0);var s=0;return t.forEach(function(t){var e=a.itemDate(t);e.setHours(0,0,0,0),e.getTime()!==i.getTime()&&(s+=1,i=e),n[s]||(n[s]={x:i,y:0,id:a.data.indexOf(t)}),n[s].y+=parseInt(t.data.value,10)}),n},itemDate:function itemDate(t){var e=new Date(t.data.date),a=parseInt(t.data.time.split(":")[0],10),n=parseInt(t.data.time.split(":")[1],10);return e.setHours(a,n),e},t:function t(e,a){return this.$t(this.addon+".history."+e,a)},initChart:function initChart(){var t=this,e=t.range;if(t.data&&t.data.length){var a={chart:{type:"column"},credits:{enabled:!1},legend:{enabled:!1},title:null,tooltip:{enabled:!1},xAxis:{type:"datetime"},yAxis:Object.assign({},{title:null},t.goalValue?{plotLines:[{color:"#71A7E7",width:2,value:t.goalValue}]}:{}),time:{timezoneOffset:(new Date).getTimezoneOffset()}},n={color:"#71A7E7",cursor:"pointer",point:{events:{click:function click(){t.clicked=this},select:function select(){t.clicked=this}}}};"day"===e&&t.$highcharts.chart(t.$refs.chartDay,Object.assign({},a,{series:[Object.assign({},n,{data:t.todayValues})]})),"week"===e&&t.$highcharts.chart(t.$refs.chartWeek,Object.assign({},a,{series:[Object.assign({},n,{data:t.weekValues})]})),"month"===e&&t.$highcharts.chart(t.$refs.chartMonth,Object.assign({},a,{series:[Object.assign({},n,{data:t.monthValues})]}))}}}}},{path:"/vitals_water_tracker/plan/",component:{render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("f7-page",{class:"vitals-"+e.vitalsElement+"-plan-page"},[a("f7-navbar",[a("tommy-nav-back"),e._v(" "),a("f7-nav-title",[e._v(e._s(e.t("title")))]),e._v(" "),a("f7-nav-right",[e.allowSave?a("f7-link",{attrs:{href:"#","icon-only":""},on:{click:e.save}},[a("i",{staticClass:"icon f7-icons"},[e._v("check")])]):e._e()],1)],1),e._v(" "),a("f7-list",{staticClass:"no-hairlines"},[a("f7-list-input",{attrs:{type:"number","inline-label":"",value:e.value,min:"1",label:e.t("vital_label")},on:{input:function(t){e.updateGoalValue("value",parseFloat(t.target.value))}}},[a("span",{staticClass:"vitals-element-input-unit",attrs:{slot:"inner"},slot:"inner"},[e._v(e._s(e.t("vital_unit."+e.unit)))])])],1),e._v(" "),a("f7-block-title",[e._v(e._s(e.t("reminder_label")))]),e._v(" "),a("f7-list",{staticClass:"no-hairlines"},[a("f7-list-item",{attrs:{title:e.t("start_label"),after:e.start_time,link:""},on:{click:function(t){e.openTimePicker("start_time",e.t("start_label"))}}}),e._v(" "),a("f7-list-item",{attrs:{title:e.t("end_label"),after:e.end_time,link:""},on:{click:function(t){e.openTimePicker("end_time",e.t("end_label"))}}}),e._v(" "),a("f7-list-item",{attrs:{title:e.t("interval_label"),after:e.formatTimeInterval(e.time_interval),link:""},on:{click:function(t){e.openTimePicker("time_interval",e.t("interval_label"))}}})],1)],1)},staticRenderFns:[],props:{addon:String,vitalsElement:String,settings:Object},data:function data(){var t=this.settings;return{value:t.goal_value,start_time:t.goal_start_time,end_time:t.goal_end_time,time_interval:t.goal_time_interval,unit:t.goal_unit,allowSave:!1}},mounted:function mounted(){},methods:{t:function t(e,a){return this.$t(this.addon+".drinking_plan."+e,a)},formatTimeInterval:function formatTimeInterval(t){var e=Math.floor(t/60),a=t-60*Math.floor(t/60);return e<10&&(e="0"+e),a<10&&(a="0"+a),e+":"+a},updateGoalValue:function updateGoalValue(t,e){this[t]=e,this.allowSave=!0},openTimePicker:function openTimePicker(e,t){var a,n=this,i=n[e],s=!1;"number"==typeof i&&(s=!0,i=n.formatTimeInterval(i)),n.$f7.dialog.create({title:t,text:'<div class="vitals-water_tracker-dialog-time-picker"></div>',buttons:[{text:n.$t("label.ok"),bold:!0,color:"red",onClick:function onClick(){var t=a.value[0]+":"+a.value[1];s&&(t=60*a.value[0]+parseInt(a.value[1],10)),n.updateGoalValue(e,t)}}],on:{open:function open(){a=n.$f7.picker.create({toolbar:!1,value:[i.split(":")[0],i.split(":")[1]],containerEl:".vitals-water_tracker-dialog-time-picker",cols:[{values:function(){for(var t=[],e=0;e<24;e+=1)e<10?t.push("0"+e):t.push(e.toString());return t}()},{divider:!0,content:":"},{values:function(){for(var t=[],e=0;e<60;e+=1)e<10?t.push("0"+e):t.push(e.toString());return t}()}]})},close:function close(){a.destroy()}}}).open()},save:function save(){var t=this;t.$events.$emit(t.addon+":updateGoal",{value:t.value,start_time:t.start_time,end_time:t.end_time,time_interval:t.time_interval,unit:t.unit}),t.$f7router.back()}}}}];return n.forEach(function(t){t.options={props:{addon:"vitals_water_tracker",vitalsElement:"water_tracker"}}}),n}();